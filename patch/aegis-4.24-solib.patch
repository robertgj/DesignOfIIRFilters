--- aegis-4.24.orig/aefind/cmdline.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/aefind/cmdline.y	2020-11-24 20:29:12.960149558 +1100
@@ -71,6 +71,17 @@
 
 %}
 
+%union
+{
+    struct string_ty *lv_string;
+    struct string_list_ty *lv_string_list;
+    tree::pointer *lv_tree;
+    class tree_list *lv_tree_list;
+    long lv_number;
+    double lv_real;
+    diadic_t comparator;
+}
+
 %token AMIN
 %token ANDAND
 %token ATIME
@@ -112,7 +123,7 @@
 %token NEWER
 %token NOT
 %token NOW
-%token NUMBER
+%token <lv_number> NUMBER
 %token OROR
 %token PATH
 %token PERM
@@ -120,7 +131,7 @@
 %token PRINT
 %token PROJECT
 %token QUESTION
-%token REAL
+%token <lv_real> REAL
 %token RESOLVE
 %token RESOLVE_NOT
 %token RPAREN
@@ -128,9 +139,9 @@
 %token SHIFT_LEFT
 %token SHIFT_RIGHT
 %token SSIZE
-%token STRING
+%token <lv_string> STRING
 %token STRINGIZE
-%token THIS
+%token <lv_number> THIS
 %token TILDE
 %token TRACE
 %token TRUE_keyword
@@ -138,21 +149,7 @@
 %token TYPE
 %token VERSION
 
-%union
-{
-    struct string_ty *lv_string;
-    struct string_list_ty *lv_string_list;
-    tree::pointer *lv_tree;
-    class tree_list *lv_tree_list;
-    long lv_number;
-    double lv_real;
-    diadic_t comparator;
-}
-
 %type <comparator>  comparator
-%type <lv_number>   NUMBER THIS
-%type <lv_real>     REAL
-%type <lv_string>   STRING
 %type <lv_string>   number_or_string
 %type <lv_string_list> strings strings_or_dot
 %type <lv_tree>     tree1 tree2 tree3 tree4 tree5 tree6 tree7
--- aegis-4.24.orig/aeimport/format/rcs/gram.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/aeimport/format/rcs/gram.y	2020-11-24 20:29:12.960149558 +1100
@@ -32,6 +32,12 @@
 
 %}
 
+%union
+{
+    string_ty       *lv_string;
+    string_list_ty  *lv_string_list;
+}
+
 %token ACCESS
 %token AUTHOR
 %token BRANCH
@@ -41,27 +47,21 @@
 %token DESC
 %token EXPAND
 %token HEAD
-%token IDENTIFIER
+%token <lv_string> IDENTIFIER
 %token JUNK
 %token LOCKS
 %token LOG
 %token NEXT
-%token NUMBER
+%token <lv_string> NUMBER
 %token SEMI
 %token STATE
 %token STRICT
-%token STRING
+%token <lv_string> STRING
 %token SUFFIX
 %token SYMBOLS
 %token TEXT
 
-%union
-{
-    string_ty       *lv_string;
-    string_list_ty  *lv_string_list;
-}
-
-%type <lv_string> NUMBER STRING IDENTIFIER date author next log state
+%type <lv_string> date author next log state
 %type <lv_string_list> strings_opt branch branch_opt identifiers_opt numbers_opt
 
 %{
--- aegis-4.24.orig/aeimport/format/sccs/gram.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/aeimport/format/sccs/gram.y	2020-11-24 20:29:12.960149558 +1100
@@ -39,7 +39,12 @@
 
 %}
 
-%token COMMENT
+%union {
+    string_ty       *lv_string;
+    long            lv_long;
+}
+
+%token <lv_string> COMMENT
 %token DELTA_BEGIN
 %token DELTA_END
 %token D_KEYWORD
@@ -52,21 +57,15 @@
 %token MR_EXCLUDE
 %token MR_IGNORE
 %token MR_INCLUDE
-%token STRING
+%token <lv_string> STRING
 %token SUMMARY
-%token TEXTLINE
+%token <lv_string> TEXTLINE
 %token TITLE_BEGIN
 %token TITLE_END
 %token USERS_BEGIN
 %token USERS_END
 
-%union {
-    string_ty       *lv_string;
-    long            lv_long;
-}
-
 %type <lv_long> date_and_time number
-%type <lv_string> COMMENT STRING TEXTLINE
 
 %{
 
--- aegis-4.24.orig/libaegis/http.cc	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/http.cc	2020-11-24 20:29:12.960149558 +1100
@@ -404,7 +404,7 @@
 emit_change_href(change::pointer cp, const char *modifier)
 {
     if (cp->bogus)
-        emit_project_href(cp->pp, modifier);
+        emit_project_href(cp->pp,"%s", modifier);
     else
         emit_change_href_n(cp->pp, magic_zero_decode(cp->number), modifier);
 }
--- aegis-4.24.orig/libaegis/sub/plural_gram.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/sub/plural_gram.y	2020-11-24 20:29:12.961149544 +1100
@@ -38,6 +38,11 @@
 
 %}
 
+%union
+{
+    unsigned        lv_number;
+}
+
 %token ANDAND
 %token BITAND
 %token BITOR
@@ -48,7 +53,7 @@
 %token EQU
 %token GE
 %token GT
-%token INTEGER
+%token <lv_number> INTEGER
 %token JUNK
 %token LE
 %token LP
@@ -67,12 +72,7 @@
 %token RP
 %token SEMI
 
-%union
-{
-    unsigned        lv_number;
-}
-
-%type <lv_number> INTEGER expr
+%type <lv_number> expr
 
 %right EQU
 %right QUEST COLON
--- aegis-4.24.orig/libaegis/sub/expr_gram.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/sub/expr_gram.y	2020-11-24 20:29:12.961149544 +1100
@@ -38,6 +38,13 @@
 
 %}
 
+%union
+{
+	long	lv_number;
+}
+
+%type <lv_number> expr
+
 %token DIV
 %token EQ
 %token GE
@@ -51,17 +58,10 @@
 %token MUL
 %token NE
 %token NOT
-%token NUMBER
+%token <lv_number> NUMBER
 %token PLUS
 %token RP
 
-%union
-{
-	long	lv_number;
-}
-
-%type <lv_number> NUMBER expr
-
 %left NE EQ
 %left LT LE GT GE
 %left PLUS MINUS
--- aegis-4.24.orig/libaegis/project/file/roll_forward.cc	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/project/file/roll_forward.cc	2020-11-24 20:29:12.961149544 +1100
@@ -1045,17 +1045,19 @@
                 //
                 file_event_list::pointer felp2 =
                     uuid_to_felp.get(nstring(filename));
-                assert(felp2);
-                felp2->push_back(*result);
+                if (felp2)
+                {
+                    felp2->push_back(*result);
 
-                //
-                // Make sure the by-uuid and by-filename lookups will
-                // both be the same from now on.
-                //
-                uuid_to_felp.assign(uuid, felp2);
-                result = uuid_to_felp.get(uuid);
-                assert(result);
-                assert(result == felp2);
+                    //
+                    // Make sure the by-uuid and by-filename lookups will
+                    // both be the same from now on.
+                    //
+                    uuid_to_felp.assign(uuid, felp2);
+                    result = uuid_to_felp.get(uuid);
+                    assert(result);
+                    assert(result == felp2);
+                }
             }
         }
 
--- aegis-4.24.orig/libaegis/aer/report.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/aer/report.y	2020-11-24 20:29:12.961149544 +1100
@@ -120,6 +120,15 @@
 
 %}
 
+%union
+{
+    long lv_number;
+    nstring *lv_string;
+    rpt_value::pointer *lv_value;
+    rpt_stmt::pointer *lv_stmt;
+    rpt_expr::pointer *lv_expr;
+}
+
 %token AND_BIT
 %token AND_LOGICAL
 %token ASSIGN
@@ -141,7 +150,7 @@
 %token CATCH
 %token COLON
 %token COMMA
-%token CONSTANT
+%token <lv_value> CONSTANT
 %token CONTINUE
 %token DECR
 %token DEFAULT
@@ -170,7 +179,7 @@
 %token MINUS
 %token MOD
 %token MUL
-%token NAME
+%token <lv_string> NAME
 %token NE
 %token NMATCH
 %token NOT_BIT
@@ -192,19 +201,8 @@
 %token WHILE
 %token XOR_BIT
 
-%union
-{
-    long lv_number;
-    nstring *lv_string;
-    rpt_value::pointer *lv_value;
-    rpt_stmt::pointer *lv_stmt;
-    rpt_expr::pointer *lv_expr;
-}
-
 %type <lv_expr> expr
-%type <lv_value> CONSTANT
 %type <lv_stmt> stmt stmt_list compound_stmt
-%type <lv_string> NAME
 %type <lv_expr> expr_list struct_list expr_list_opt struct_assign
 %type <lv_stmt> declaration decl_name_list decl_name
 
--- aegis-4.24.orig/libaegis/change/file/name_check.cc	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/change/file/name_check.cc	2020-11-24 20:29:12.961149544 +1100
@@ -279,17 +279,12 @@
 	    }
 	}
     }
-    else
-    {
-	//
-	// exclude control characters, space characters
-	// and high-bit-on characters
-	// (This is a "C" locale test.)
-	//
-	for (s = fn->str_text; *s; ++s)
-	    if (!isgraph((unsigned char)*s))
-		return 0;
-    }
+    //
+    // Avoid doing more checks using isgraph/isprint or similar
+    // functions, since they can be too strict with respect to other
+    // option selected by the user: allow_white_space_in_filenames,
+    // allow_non_ascii_filenames.
+    //
     return 1;
 }
 
--- aegis-4.24.orig/libaegis/gram.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/libaegis/gram.y	2020-11-24 20:29:12.962149530 +1100
@@ -34,11 +34,6 @@
 
 %}
 
-%token INTEGER
-%token NAME
-%token REAL
-%token STRING
-
 %union
 {
 	string_ty	*lv_string;
@@ -46,9 +41,14 @@
 	double		lv_real;
 }
 
-%type <lv_string> NAME STRING string
-%type <lv_integer> INTEGER integer
-%type <lv_real> REAL real
+%token <lv_integer> INTEGER
+%token <lv_string> NAME
+%token <lv_real> REAL
+%token <lv_string> STRING
+
+%type <lv_string> string
+%type <lv_integer> integer
+%type <lv_real> real
 
 %%
 
--- aegis-4.24.orig/aeget/get/project/integr_histo.cc	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/aeget/get/project/integr_histo.cc	2020-11-24 20:29:12.962149530 +1100
@@ -189,14 +189,14 @@
     if (recursive)
     {
 	printf("faster ");
-	emit_project_href(pp, ref.c_str());
+	emit_project_href(pp,"%s", ref.c_str());
 	printf("non-");
     }
     else
     {
 	printf("slower ");
 	ref += "+recursive";
-	emit_project_href(pp, ref.c_str());
+	emit_project_href(pp,"%s", ref.c_str());
     }
     printf("recursive</a> listing available.</p>\n");
 
--- aegis-4.24.orig/common/config.messy.h	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/common/config.messy.h	2020-11-24 20:29:12.962149530 +1100
@@ -99,6 +99,7 @@
 #endif
 #ifndef _BSD_SOURCE
 #define _BSD_SOURCE
+#define _DEFAULT_SOURCE
 #endif
 #endif
 
--- aegis-4.24.orig/common/mem.h	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/common/mem.h	2020-11-24 20:29:12.962149530 +1100
@@ -124,11 +124,7 @@
    dmem_copy_string(__FILE__, __LINE__, (p), ## __VA_ARGS__)
 #endif
 
-#if HAVE_HEADER_NEW || HAVE_NEW_H
-#define THROW_BAD_ALLOC throw(std::bad_alloc)
-#else
 #define THROW_BAD_ALLOC
-#endif
 
 #ifndef DMALLOC
 void *operator new(size_t nbytes) THROW_BAD_ALLOC;
--- aegis-4.24.orig/common/stack.cc	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/common/stack.cc	2020-11-24 20:29:12.962149530 +1100
@@ -24,7 +24,7 @@
 find_stack_direction ()
 {
     static char *addr = 0;
-    auto char dummy;
+    char dummy;
     if (addr == 0)
     {
 	addr = &dummy;
@@ -47,7 +47,7 @@
 	return false;
     if (stack_direction == 0)
 	stack_direction = find_stack_direction();
-    auto char dummy = 0;
+    char dummy = 0;
     char *cp = (char *)p;
     return (stack_direction < 0 ?  (&dummy < cp) : (&dummy > cp));
 }
--- aegis-4.24.orig/common/ac/unistd.h	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/common/ac/unistd.h	2020-11-24 20:29:12.962149530 +1100
@@ -29,6 +29,7 @@
 #ifdef __linux__
 #ifndef _BSD_SOURCE
 #define _BSD_SOURCE
+#define _DEFAULT_SOURCE
 #endif
 #ifndef __USE_BSD
 #define __USE_BSD
--- aegis-4.24.orig/common/ac/string/memmem.cc	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/common/ac/string/memmem.cc	2020-11-24 20:29:12.962149530 +1100
@@ -182,7 +182,7 @@
 
     // Use optimizations in memchr when possible.
     if (needle_len == 1)
-        return memchr(haystack, *needle, haystack_len);
+      return (void *)memchr(haystack, *needle, haystack_len);
 
     // Minimizing the worst-case complexity:
     // Let n = haystack_len, m = needle_len.
--- aegis-4.24.orig/fmtgen/parse.y	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/fmtgen/parse.y	2020-11-24 20:29:12.962149530 +1100
@@ -54,30 +54,29 @@
 
 %}
 
+%union
+{
+    string_ty       *lv_string;
+    long            lv_integer;
+    type *lv_type;
+}
+
 %token	BOOLEAN
 %token	BOOLEAN_CONSTANT
 %token	HIDE_IF_DEFAULT
 %token	INCLUDE
 %token	INTEGER
-%token	INTEGER_CONSTANT
-%token	NAME
+%token	<lv_integer> INTEGER_CONSTANT
+%token	<lv_string> NAME
 %token	REAL
 %token	REDEFINITION_OK
 %token	SHOW_IF_DEFAULT
 %token	STRING
-%token	STRING_CONSTANT
+%token	<lv_string> STRING_CONSTANT
 %token	TIME
 %token	TYPE
 
-%union
-{
-    string_ty       *lv_string;
-    long            lv_integer;
-    type *lv_type;
-}
-
-%type <lv_string> NAME STRING_CONSTANT
-%type <lv_integer> INTEGER_CONSTANT attributes
+%type <lv_integer> attributes
 %type <lv_type> type structure list enumeration enum_list_begin
 
 %{
--- aegis-4.24.orig/Makefile.in	2008-03-10 09:08:17.000000000 +1100
+++ aegis-4.24/Makefile.in	2020-11-24 20:29:17.880082174 +1100
@@ -228,6 +228,7 @@
 # This is the file extension of library files.  NO DOT.
 #
 LIBEXT = a
+SOLIBEXT = so
 
 #
 # For some installations of Groff, -mm is installed as -mm, but some
@@ -4007,12 +4008,16 @@
 aefind/cmdline.gen.cc aefind/cmdline.gen.h: aefind/cmdline.y
 	@echo Expect 5 shift/reduce, 23 reduce/reduce conflicts.
 	$(YACC) -d aefind/cmdline.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/cmdline_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		aefind/cmdline.gen.cc
 	sed -e 's/[yY][yY]/cmdline_/g' -e 's/Y_TAB_H/cmdline_TAB_H/g' \
 		y.tab.h > aefind/cmdline.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' aefind/cmdline.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' aefind/cmdline.gen.h
 
 aefind/descend.$(OBJEXT): aefind/descend.cc common/ac/errno.h \
 		common/config.h common/config.messy.h \
@@ -7378,6 +7383,8 @@
 		aeimport/format/rcs/gram.y
 	@echo Expect no conflicts.
 	$(YACC) -d aeimport/format/rcs/gram.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/format_rcs_gram_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		aeimport/format/rcs/gram.gen.cc
@@ -7385,6 +7392,8 @@
 		's/Y_TAB_H/format_rcs_gram_TAB_H/g' y.tab.h > \
 		aeimport/format/rcs/gram.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' aeimport/format/rcs/gram.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' aeimport/format/rcs/gram.gen.h
 
 aeimport/format/rcs/lex.$(OBJEXT): aeimport/format/rcs/lex.cc \
 		aeimport/format/rcs/lex.h common/str.h common/ac/stddef.h \
@@ -7435,6 +7444,8 @@
 		aeimport/format/sccs/gram.y
 	@echo Expect no conflicts.
 	$(YACC) -d aeimport/format/sccs/gram.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/format_sccs_gram_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		aeimport/format/sccs/gram.gen.cc
@@ -7442,6 +7453,8 @@
 		's/Y_TAB_H/format_sccs_gram_TAB_H/g' y.tab.h > \
 		aeimport/format/sccs/gram.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' aeimport/format/sccs/gram.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' aeimport/format/sccs/gram.gen.h
 
 aeimport/format/sccs/lex.$(OBJEXT): aeimport/format/sccs/lex.cc \
 		common/ac/ctype.h common/config.h common/config.messy.h \
@@ -8992,12 +9005,16 @@
 common/gettime.gen.cc common/gettime.gen.h: common/gettime.y
 	@echo Expect 8 shift/reduce conflicts.
 	$(YACC) -d common/gettime.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/gettime_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		common/gettime.gen.cc
 	sed -e 's/[yY][yY]/gettime_/g' -e 's/Y_TAB_H/gettime_TAB_H/g' \
 		y.tab.h > common/gettime.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' common/gettime.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' common/gettime.gen.h
 
 common/gmatch.$(OBJEXT): common/gmatch.cc common/ac/string.h \
 		common/config.h common/config.messy.h common/gmatch.h \
@@ -9576,13 +9593,6 @@
 	$(CXX) -I. $(CXXFLAGS) -c common/str/trail_suffix.cc
 	mv trail_suffix.$(OBJEXT) $@
 
-common/str/traili_suffi.$(OBJEXT): common/str/traili_suffi.cc \
-		common/ac/string.h common/config.h common/config.messy.h \
-		common/str.h common/ac/stddef.h common/ac/stdarg.h \
-		common/main.h
-	$(CXX) -I. $(CXXFLAGS) -c common/str/traili_suffi.cc
-	mv traili_suffi.$(OBJEXT) $@
-
 common/str/trim.$(OBJEXT): common/str/trim.cc common/ac/ctype.h \
 		common/config.h common/config.messy.h common/language.h \
 		common/main.h common/str.h common/ac/stddef.h \
@@ -10087,11 +10097,15 @@
 fmtgen/parse.gen.cc fmtgen/parse.gen.h: fmtgen/parse.y
 	@echo Expect no conflicts.
 	$(YACC) -d fmtgen/parse.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/parse_/g' -e '/<stdio.h>/d' -e '/<stdlib.h>/d' \
 		-e '/<stddef.h>/d' y.tab.c > fmtgen/parse.gen.cc
 	sed -e 's/[yY][yY]/parse_/g' -e 's/Y_TAB_H/parse_TAB_H/g' y.tab.h \
 		> fmtgen/parse.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' fmtgen/parse.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' fmtgen/parse.gen.h
 
 fmtgen/type.$(OBJEXT): fmtgen/type.cc common/error.h common/main.h \
 		common/mem.h common/ac/stddef.h common/config.h \
@@ -16642,6 +16656,8 @@
 		libaegis/aer/report.y
 	@echo Expect 2 reduce/reduce conflicts.
 	$(YACC) -d libaegis/aer/report.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/aer_report_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		libaegis/aer/report.gen.cc
@@ -16649,6 +16665,9 @@
 		's/Y_TAB_H/aer_report_TAB_H/g' y.tab.h > \
 		libaegis/aer/report.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/aer/report.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/aer/report.gen.h
+
 
 libaegis/aer/stmt.$(OBJEXT): libaegis/aer/stmt.cc common/error.h \
 		common/main.h common/mem.h common/ac/stddef.h \
@@ -23743,11 +23762,15 @@
 libaegis/gram.gen.cc libaegis/gram.gen.h: libaegis/gram.y
 	@echo Expect no conflicts.
 	$(YACC) -d libaegis/gram.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/gram_/g' -e '/<stdio.h>/d' -e '/<stdlib.h>/d' \
 		-e '/<stddef.h>/d' y.tab.c > libaegis/gram.gen.cc
 	sed -e 's/[yY][yY]/gram_/g' -e 's/Y_TAB_H/gram_TAB_H/g' y.tab.h > \
 		libaegis/gram.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/gram.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/gram.gen.h
 
 libaegis/gstate.$(OBJEXT): libaegis/gstate.cc common/ac/stddef.h \
 		common/config.h common/config.messy.h common/ac/stdio.h \
@@ -28731,6 +28754,8 @@
 		libaegis/sub/expr_gram.y
 	@echo Expect no conflicts.
 	$(YACC) -d libaegis/sub/expr_gram.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/sub_expr_gram_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		libaegis/sub/expr_gram.gen.cc
@@ -28738,6 +28763,8 @@
 		's/Y_TAB_H/sub_expr_gram_TAB_H/g' y.tab.h > \
 		libaegis/sub/expr_gram.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/sub/expr_gram.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/sub/expr_gram.gen.h
 
 libaegis/sub/expr_lex.$(OBJEXT): libaegis/sub/expr_lex.cc \
 		common/nstring.h common/str.h common/ac/stddef.h \
@@ -29045,6 +29072,8 @@
 		libaegis/sub/plural_gram.y
 	@echo Expect no conflicts.
 	$(YACC) -d libaegis/sub/plural_gram.y
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.c
+	sed -i -e 's/YYerror/yacc_error_tmp/g' y.tab.h
 	sed -e 's/[yY][yY]/sub_plural_gram_/g' -e '/<stdio.h>/d' -e \
 		'/<stdlib.h>/d' -e '/<stddef.h>/d' y.tab.c > \
 		libaegis/sub/plural_gram.gen.cc
@@ -29052,6 +29081,8 @@
 		's/Y_TAB_H/sub_plural_gram_TAB_H/g' y.tab.h > \
 		libaegis/sub/plural_gram.gen.h
 	rm -f y.tab.c y.tab.h
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/sub/plural_gram.gen.cc
+	sed -i -e 's/yacc_error_tmp/YYerror/g' libaegis/sub/plural_gram.gen.h
 
 libaegis/sub/plural_lex.$(OBJEXT): libaegis/sub/plural_lex.cc \
 		common/ac/string.h common/config.h common/config.messy.h \
@@ -32081,6 +32112,10 @@
 	CXX="$(CXX)" $(SH) etc/test.sh -shell $(SH) -run \
 		test/02/t0266a-walt.sh test/02/t0266a-walt.ES
 
+test/02/t0289a-walt.ES: test/02/t0289a-walt.sh all-bin etc/test.sh
+	CXX="$(CXX)" $(SH) etc/test.sh -shell $(SH) -run \
+		test/02/t0289a-walt.sh test/02/t0289a-walt.ES
+
 test_base64/main.$(OBJEXT): test_base64/main.cc common/ac/stdio.h \
 		common/config.h common/config.messy.h common/ac/stdlib.h \
 		common/arglex.h common/main.h common/error.h \
@@ -32492,11 +32527,11 @@
 		ae-repo-ci/repository/rename.$(OBJEXT) \
 		ae-repo-ci/repository/subversion.$(OBJEXT)
 
-bin/ae-repo-ci$(EXEEXT): $(ae-repo-ci_files) libaegis/libaegis.$(LIBEXT) \
+bin/ae-repo-ci$(EXEEXT): $(ae-repo-ci_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(ae-repo-ci_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)ae-repo-ci$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32508,11 +32543,11 @@
 		aeannotate/line_list.$(OBJEXT) aeannotate/list.$(OBJEXT) \
 		aeannotate/main.$(OBJEXT) aeannotate/usage.$(OBJEXT)
 
-bin/aeannotate$(EXEEXT): $(aeannotate_files) libaegis/libaegis.$(LIBEXT) \
+bin/aeannotate$(EXEEXT): $(aeannotate_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aeannotate_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aeannotate$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32595,11 +32630,11 @@
 		aecomplete/shell/private.$(OBJEXT) \
 		aecomplete/shell/zsh.$(OBJEXT)
 
-bin/aecomplete$(EXEEXT): $(aecomplete_files) libaegis/libaegis.$(LIBEXT) \
+bin/aecomplete$(EXEEXT): $(aecomplete_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aecomplete_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aecomplete$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32677,10 +32712,10 @@
 		aecvsserver/server/simple.$(OBJEXT)
 
 bin/aecvsserver$(EXEEXT): $(aecvsserver_files) \
-		libaegis/libaegis.$(LIBEXT) .bin
+		libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aecvsserver_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aecvsserver$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32711,10 +32746,10 @@
 		aede-policy/validation/was_download.$(OBJEXT)
 
 bin/aede-policy$(EXEEXT): $(aede-policy_files) \
-		libaegis/libaegis.$(LIBEXT) .bin
+		libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aede-policy_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aede-policy$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32724,10 +32759,10 @@
 aediff_files = aediff/arglex3.$(OBJEXT) aediff/diff.$(OBJEXT) \
 		aediff/main.$(OBJEXT)
 
-bin/aediff$(EXEEXT): $(aediff_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aediff$(EXEEXT): $(aediff_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aediff_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aediff$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32746,10 +32781,10 @@
 		aedist/replay/line.$(OBJEXT) aedist/send.$(OBJEXT) \
 		aedist/usage.$(OBJEXT)
 
-bin/aedist$(EXEEXT): $(aedist_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aedist$(EXEEXT): $(aedist_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aedist_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aedist$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32775,10 +32810,10 @@
 		aefind/tree/monadic.$(OBJEXT) aefind/tree/now.$(OBJEXT) \
 		aefind/tree/relative.$(OBJEXT) aefind/tree/this.$(OBJEXT)
 
-bin/aefind$(EXEEXT): $(aefind_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aefind$(EXEEXT): $(aefind_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aefind_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aefind$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32787,10 +32822,10 @@
 
 aefinish_files = aefinish/finish.$(OBJEXT) aefinish/main.$(OBJEXT)
 
-bin/aefinish$(EXEEXT): $(aefinish_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aefinish$(EXEEXT): $(aefinish_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aefinish_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aefinish$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32799,10 +32834,10 @@
 
 aefp_files = aefp/main.$(OBJEXT)
 
-bin/aefp$(EXEEXT): $(aefp_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aefp$(EXEEXT): $(aefp_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
-	$(CXX) $(LDFLAGS) -o $@ $(aefp_files) libaegis/libaegis.$(LIBEXT) \
-		$(LIBS)
+	$(CXX) $(LDFLAGS) -o $@ $(aefp_files) \
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aefp$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32849,10 +32884,10 @@
 		aeget/get/rect.$(OBJEXT) aeget/get/rss.$(OBJEXT) \
 		aeget/main.$(OBJEXT) aeget/rect.$(OBJEXT)
 
-bin/aeget$(EXEEXT): $(aeget_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aeget$(EXEEXT): $(aeget_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aeget_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aeget$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32889,10 +32924,10 @@
 		aegis/aet.$(OBJEXT) aegis/configured.$(OBJEXT) \
 		aegis/main.$(OBJEXT)
 
-bin/aegis$(EXEEXT): $(aegis_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aegis$(EXEEXT): $(aegis_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aegis_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	-chown root $@ && chmod 4755 $@
 	@sleep 1
 
@@ -32923,10 +32958,10 @@
 		aeimport/reconstruct.$(OBJEXT) \
 		aeimport/synthesize.$(OBJEXT)
 
-bin/aeimport$(EXEEXT): $(aeimport_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aeimport$(EXEEXT): $(aeimport_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aeimport_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	-chown root $@ && chmod 4755 $@
 	@sleep 1
 
@@ -32937,10 +32972,10 @@
 
 aelcf_files = aelcf/main.$(OBJEXT)
 
-bin/aelcf$(EXEEXT): $(aelcf_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aelcf$(EXEEXT): $(aelcf_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aelcf_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aelcf$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32950,10 +32985,10 @@
 aelock_files = aelock/list.$(OBJEXT) aelock/lock.$(OBJEXT) \
 		aelock/main.$(OBJEXT) aelock/usage.$(OBJEXT)
 
-bin/aelock$(EXEEXT): $(aelock_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aelock$(EXEEXT): $(aelock_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aelock_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	-chown root $@ && chmod 4755 $@
 	@sleep 1
 
@@ -32964,10 +32999,10 @@
 
 aelpf_files = aelpf/main.$(OBJEXT)
 
-bin/aelpf$(EXEEXT): $(aelpf_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aelpf$(EXEEXT): $(aelpf_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aelpf_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aelpf$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -32976,10 +33011,10 @@
 
 aels_files = aels/list.$(OBJEXT) aels/main.$(OBJEXT) aels/stack.$(OBJEXT)
 
-bin/aels$(EXEEXT): $(aels_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aels$(EXEEXT): $(aels_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
-	$(CXX) $(LDFLAGS) -o $@ $(aels_files) libaegis/libaegis.$(LIBEXT) \
-		$(LIBS)
+	$(CXX) $(LDFLAGS) -o $@ $(aels_files) \
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aels$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33008,11 +33043,11 @@
 		aemakegen/target/factory.$(OBJEXT) \
 		aemakegen/target/makefile.$(OBJEXT)
 
-bin/aemakegen$(EXEEXT): $(aemakegen_files) libaegis/libaegis.$(LIBEXT) \
+bin/aemakegen$(EXEEXT): $(aemakegen_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aemakegen_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aemakegen$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33021,11 +33056,11 @@
 
 aemanifest_files = aemanifest/main.$(OBJEXT)
 
-bin/aemanifest$(EXEEXT): $(aemanifest_files) libaegis/libaegis.$(LIBEXT) \
+bin/aemanifest$(EXEEXT): $(aemanifest_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aemanifest_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aemanifest$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33052,10 +33087,10 @@
 		aepatch/main.$(OBJEXT) aepatch/receive.$(OBJEXT) \
 		aepatch/send.$(OBJEXT) aepatch/slurp.$(OBJEXT)
 
-bin/aepatch$(EXEEXT): $(aepatch_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aepatch$(EXEEXT): $(aepatch_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aepatch_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aepatch$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33065,10 +33100,10 @@
 aepromptcmd_files = aepromptcmd/main.$(OBJEXT)
 
 bin/aepromptcmd$(EXEEXT): $(aepromptcmd_files) \
-		libaegis/libaegis.$(LIBEXT) .bin
+		libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aepromptcmd_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aepromptcmd$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33077,10 +33112,10 @@
 
 aerect_files = aerect/main.$(OBJEXT) aerect/rect.$(OBJEXT)
 
-bin/aerect$(EXEEXT): $(aerect_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aerect$(EXEEXT): $(aerect_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aerect_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aerect$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33089,10 +33124,10 @@
 
 aereport_files = aereport/main.$(OBJEXT)
 
-bin/aereport$(EXEEXT): $(aereport_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aereport$(EXEEXT): $(aereport_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aereport_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aereport$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33103,10 +33138,10 @@
 		aerevml/output/revml_encode.$(OBJEXT) \
 		aerevml/send.$(OBJEXT) aerevml/usage.$(OBJEXT)
 
-bin/aerevml$(EXEEXT): $(aerevml_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aerevml$(EXEEXT): $(aerevml_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aerevml_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aerevml$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33115,10 +33150,10 @@
 
 aesub_files = aesub/main.$(OBJEXT)
 
-bin/aesub$(EXEEXT): $(aesub_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aesub$(EXEEXT): $(aesub_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aesub_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aesub$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33128,11 +33163,11 @@
 aesubunit_files = aesubunit/arglex3.$(OBJEXT) aesubunit/main.$(OBJEXT) \
 		aesubunit/subunit.$(OBJEXT)
 
-bin/aesubunit$(EXEEXT): $(aesubunit_files) libaegis/libaegis.$(LIBEXT) \
+bin/aesubunit$(EXEEXT): $(aesubunit_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aesubunit_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aesubunit$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33141,10 +33176,10 @@
 
 aesvt_files = aesvt/main.$(OBJEXT)
 
-bin/aesvt$(EXEEXT): $(aesvt_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aesvt$(EXEEXT): $(aesvt_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aesvt_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aesvt$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33157,10 +33192,10 @@
 		aetar/output/tar_child.$(OBJEXT) aetar/receive.$(OBJEXT) \
 		aetar/send.$(OBJEXT)
 
-bin/aetar$(EXEEXT): $(aetar_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aetar$(EXEEXT): $(aetar_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aetar_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aetar$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33176,10 +33211,10 @@
 		aexml/xml/project/state.$(OBJEXT) \
 		aexml/xml/user/uconf.$(OBJEXT)
 
-bin/aexml$(EXEEXT): $(aexml_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/aexml$(EXEEXT): $(aexml_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(aexml_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)aexml$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33188,10 +33223,10 @@
 
 cklinlen_files = cklinlen/check.$(OBJEXT) cklinlen/main.$(OBJEXT)
 
-bin/cklinlen$(EXEEXT): $(cklinlen_files) libaegis/libaegis.$(LIBEXT) .bin
+bin/cklinlen$(EXEEXT): $(cklinlen_files) libaegis/libaegis.$(SOLIBEXT) .bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(cklinlen_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)cklinlen$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33200,11 +33235,11 @@
 
 find_sizes_files = find_sizes/main.$(OBJEXT)
 
-bin/find_sizes$(EXEEXT): $(find_sizes_files) libaegis/libaegis.$(LIBEXT) \
+bin/find_sizes$(EXEEXT): $(find_sizes_files) libaegis/libaegis.$(SOLIBEXT) \
 		.bin
 	@sleep 1
 	$(CXX) $(LDFLAGS) -o $@ $(find_sizes_files) \
-		libaegis/libaegis.$(LIBEXT) $(LIBS)
+		-Llibaegis -Wl,-rpath,$(libdir) -laegis $(LIBS)
 	@sleep 1
 
 $(RPM_BUILD_ROOT)$(bindir)/$(PROGRAM_PREFIX)find_sizes$(PROGRAM_SUFFIX)$(EXEEXT): \
@@ -33456,7 +33491,6 @@
 		common/str/quote.$(OBJEXT) common/str/replace.$(OBJEXT) \
 		common/str/snip.$(OBJEXT) \
 		common/str/trail_suffix.$(OBJEXT) \
-		common/str/traili_suffi.$(OBJEXT) \
 		common/str/trim.$(OBJEXT) common/str/upcase.$(OBJEXT) \
 		common/str_list/appelistuniq.$(OBJEXT) \
 		common/str_list/append.$(OBJEXT) \
@@ -34460,7 +34494,6 @@
 		common/str/quote.$(OBJEXT) common/str/replace.$(OBJEXT) \
 		common/str/snip.$(OBJEXT) \
 		common/str/trail_suffix.$(OBJEXT) \
-		common/str/traili_suffi.$(OBJEXT) \
 		common/str/trim.$(OBJEXT) common/str/upcase.$(OBJEXT) \
 		common/str_list/appelistuniq.$(OBJEXT) \
 		common/str_list/append.$(OBJEXT) \
@@ -34514,7 +34547,7 @@
 		common/wstring/to_nstring.$(OBJEXT) \
 		common/yyyymmdd_wk.$(OBJEXT)
 
-LibFiles =
+LibFiles = libaegis/libaegis.$(SOLIBEXT)
 
 DataFiles = $(RPM_BUILD_ROOT)$(sysconfdir)/profile.d/aegis.sh \
 		$(RPM_BUILD_ROOT)$(sysconfdir)/profile.d/aegis.csh \
@@ -35931,7 +35964,6 @@
 	rm -f common/str/replace.$(OBJEXT)
 	rm -f common/str/snip.$(OBJEXT)
 	rm -f common/str/trail_suffix.$(OBJEXT)
-	rm -f common/str/traili_suffi.$(OBJEXT)
 	rm -f common/str/trim.$(OBJEXT)
 	rm -f common/str/upcase.$(OBJEXT)
 	rm -f common/str_list/appelistuniq.$(OBJEXT)
@@ -36652,7 +36684,7 @@
 	rm -f libaegis/interrupt.$(OBJEXT)
 	rm -f libaegis/interval.$(OBJEXT)
 	rm -f libaegis/io.$(OBJEXT)
-	rm -f libaegis/libaegis.$(LIBEXT)
+	rm -f libaegis/libaegis.$(SOLIBEXT)
 	rm -f libaegis/lock.$(OBJEXT)
 	rm -f libaegis/log.$(OBJEXT)
 	rm -f libaegis/meta_lex.$(OBJEXT)
@@ -37493,7 +37525,6 @@
 	-$(INSTALL) -m 0755 -d $(RPM_BUILD_ROOT)$(comdir)
 	-chown $(AEGIS_UID) $(RPM_BUILD_ROOT)$(comdir) && chgrp \
 		$(AEGIS_GID) $(RPM_BUILD_ROOT)$(comdir)
-	$(SH) etc/compat.2.3
 	-@touch $@
 	@sleep 1
 
@@ -37519,9 +37550,15 @@
 
 libaegis/libaegis.$(LIBEXT): $(LibAegisFiles)
 	rm -f $@
-	$(AR) qc $@ $(LibAegisFiles)
+	$(AR) qc $@ $^
 	$(RANLIB) $@
 
+$(LibAegisFiles) : CXXFLAGS+= -fPIC
+
+libaegis/libaegis.$(SOLIBEXT): $(LibAegisFiles)
+	rm -f $@
+	$(CXX) -shared -Wl,-rpath,$(libdir) -o $@ $^
+
 sure: $(TestFiles) etc/test.sh
 	@$(SH) etc/test.sh -summary $(TestFiles)
 
@@ -37534,10 +37571,11 @@
 	-chown root bin/aeimport$(EXEEXT) && chmod 4755 \
 		bin/aeimport$(EXEEXT)
 
-install-lib: $(LibFiles) $(DataFiles) .comdir
+install-lib: $(LibFiles) $(DataFiles)
+	cp -f libaegis/libaegis.$(SOLIBEXT) $(libdir)/libaegis.so
 
 uninstall-lib:
-	rm -f $(LibFiles) $(DataFiles)
+	rm -f $(libdir)/libaegis.$(SOLIBEXT)
 
 install-po: install-po-$(HAVE_MSGFMT)
 
@@ -37545,7 +37583,7 @@
 
 install-doc: install-doc-$(HAVE_GROFF)
 
-install: install-bin install-lib install-po install-man install-doc
+install: install-bin install-po install-lib install-man install-doc
 
 uninstall: uninstall-bin uninstall-lib uninstall-po uninstall-man \
 		uninstall-doc
