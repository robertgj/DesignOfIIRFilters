#!/bin/sh

prog=selesnickFIRsymmetric_bandpass_test.m

depends="selesnickFIRsymmetric_bandpass_test.m test_common.m \
selesnickFIRsymmetric_bandpass.m lagrange_interp.m print_polynomial.m \
local_max.m local_peak.m xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hMa.ok << 'EOF'
hMa = [  0.000006784191, -0.000006885401, -0.000000595665,  0.000018482369, ... 
        -0.000008626541, -0.000020504510,  0.000016791266,  0.000010044192, ... 
        -0.000010480459,  0.000001086530, -0.000010044666,  0.000001196441, ... 
         0.000025194935, -0.000012351251, -0.000017495702,  0.000010428904, ... 
        -0.000003972086,  0.000014343553,  0.000012262209, -0.000038754081, ... 
         0.000000498164,  0.000030047984, -0.000007991511,  0.000009190217, ... 
        -0.000014483894, -0.000036942390,  0.000046628688,  0.000024152169, ... 
        -0.000039186358,  0.000003070446, -0.000018767443,  0.000002718719, ... 
         0.000071329604, -0.000037222788, -0.000058995084,  0.000037857240, ... 
        -0.000000514374,  0.000029886551,  0.000030023500, -0.000105286565, ... 
         0.000000309034,  0.000093443908, -0.000023181541,  0.000007553629, ... 
        -0.000032101072, -0.000088511943,  0.000119435649,  0.000066238749, ... 
        -0.000111439170,  0.000000799344, -0.000027954272,  0.000007729639, ... 
         0.000165398802, -0.000090047306, -0.000150208930,  0.000098858325, ... 
         0.000014563627,  0.000054319546,  0.000061572656, -0.000235537853, ... 
        -0.000000021998,  0.000224217592, -0.000053596113, -0.000005418045, ... 
        -0.000063142429, -0.000182198432,  0.000257763578,  0.000147780152, ... 
        -0.000253827841, -0.000007248672, -0.000035596619,  0.000018305512, ... 
         0.000334489946, -0.000187642925, -0.000321012613,  0.000214015869, ... 
         0.000049670991,  0.000091528163,  0.000113704697, -0.000465488138, ... 
        -0.000000440824,  0.000461523183, -0.000107580445, -0.000038135829, ... 
        -0.000114857913, -0.000339617605,  0.000497104448,  0.000290209454, ... 
        -0.000504658025, -0.000025274094, -0.000039271700,  0.000038185862, ... 
         0.000616321579, -0.000353172842, -0.000612387295,  0.000410865905, ... 
         0.000116408436,  0.000147292958,  0.000195311567, -0.000843569022, ... 
        -0.000000832916,  0.000857298216, -0.000195871943, -0.000101263182, ... 
        -0.000197502199, -0.000589709697,  0.000884755945,  0.000521851811, ... 
        -0.000914067142, -0.000058844784, -0.000036818978,  0.000072608272, ... 
         0.001061417042, -0.000617405048, -0.001078335135,  0.000725225143, ... 
         0.000229517565,  0.000230489950,  0.000318508470, -0.001434857548, ... 
        -0.000001068000,  0.001480202097, -0.000332418976, -0.000207727795, ... 
        -0.000325699240, -0.000972229717,  0.001484849828,  0.000880893504, ... 
        -0.001549028042, -0.000115229794, -0.000027059590,  0.000128851025, ... 
         0.001740123255, -0.001022736200, -0.001792983723,  0.001205865370, ... 
         0.000408303473,  0.000355131936,  0.000501031870, -0.002332004487, ... 
        -0.000001046553,  0.002427101928, -0.000536880996, -0.000374179352, ... 
        -0.000521450798, -0.001546308873,  0.002391640083,  0.001423446724, ... 
        -0.002507662404, -0.000204598021, -0.000010312575,  0.000217680984, ... 
         0.002760779340, -0.001634101939, -0.002870210139,  0.001927876549, ... 
         0.000681410320,  0.000544802597,  0.000772239172, -0.003684543456, ... 
        -0.000000738372,  0.003855237791, -0.000841721551, -0.000626305371, ... 
        -0.000821917858, -0.002413342360,  0.003766204415,  0.002246078846, ... 
        -0.003959957408, -0.000343778866,  0.000011435734,  0.000357584598, ... 
         0.004320426897, -0.002570063492, -0.004520025112,  0.003031487914, ... 
         0.001101507313,  0.000844646239,  0.001189939971, -0.005784202593, ... 
        -0.000000200323,  0.006077925127, -0.001313320614, -0.001015851259, ... 
        -0.001302697600, -0.003785742435,  0.005948609367,  0.003555289420, ... 
        -0.006274640182, -0.000568546989,  0.000034797440,  0.000588629322, ... 
         0.006867255039, -0.004103754121, -0.007233484308,  0.004850586053, ... 
         0.001795116550,  0.001361732821,  0.001897333395, -0.009359882164, ... 
         0.000000434495,  0.009904012818, -0.002127408803, -0.001682987837, ... 
        -0.002164235674, -0.006244094428,  0.009884547443,  0.005935843770, ... 
        -0.010516828272, -0.000983201954,  0.000055652041,  0.001030491062, ... 
         0.011784909105, -0.007096481821, -0.012592654456,  0.008486744228, ... 
         0.003190402964,  0.002455173688,  0.003395250091, -0.017025275935, ... 
         0.000000994324,  0.018391357869, -0.003968716793, -0.003196012000, ... 
        -0.004221056964, -0.012235125292,  0.019694573022,  0.012024081475, ... 
        -0.021666617745, -0.002094629803,  0.000070063775,  0.002309080349, ... 
         0.026649138276, -0.016496888270, -0.030161816131,  0.020976657852, ... 
         0.008196414560,  0.006688989312,  0.009539538256, -0.050529082047, ... 
         0.000001321267,  0.061980051203, -0.014421696968, -0.012702693216, ... 
        -0.019186190847, -0.063529773139,  0.122320954368,  0.095106078290, ... 
        -0.244897960827, -0.045219194282,  0.300075209403 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMa.ok"; fail; fi

cat > test_hMb.ok << 'EOF'
hMb = [  0.000010584482, -0.000002640616, -0.000010974063,  0.000007236045, ... 
         0.000006329512, -0.000006427781,  0.000003175847, -0.000003887436, ... 
        -0.000008816755,  0.000017911211,  0.000005399056, -0.000023365911, ... 
         0.000001055461,  0.000014585227,  0.000000877556, -0.000000376260, ... 
        -0.000013105080, -0.000005049312,  0.000022461801, -0.000000668511, ... 
        -0.000014610418,  0.000004410308, -0.000007146030,  0.000005086749, ... 
         0.000022666689, -0.000019372640, -0.000017982302,  0.000017190997, ... 
         0.000003212960,  0.000008236438, -0.000000348532, -0.000035443270, ... 
         0.000013224317,  0.000036352596, -0.000018881390, -0.000010487246, ... 
        -0.000003596364, -0.000012280805,  0.000040459772,  0.000008590620, ... 
        -0.000052261039,  0.000006788399,  0.000020304280,  0.000001079090, ... 
         0.000026005219, -0.000037459438, -0.000040768989,  0.000061383349, ... 
         0.000017905791, -0.000032032205,  0.000000462620, -0.000034771469, ... 
         0.000019456289,  0.000075703576, -0.000051667466, -0.000052781547, ... 
         0.000036986694,  0.000001337069,  0.000036843793,  0.000013589394, ... 
        -0.000104338549,  0.000016574553,  0.000091868130, -0.000028176779, ... 
        -0.000009293626, -0.000029448758, -0.000055633534,  0.000112752505, ... 
         0.000043679424, -0.000121307790,  0.000000297995,  0.000021701541, ... 
         0.000012738208,  0.000097185392, -0.000088661805, -0.000120984695, ... 
         0.000124257553,  0.000048134483, -0.000033625708,  0.000008994418, ... 
        -0.000125168963,  0.000026670034,  0.000196799178, -0.000085918039, ... 
        -0.000110236701,  0.000037266560, -0.000029449080,  0.000126582049, ... 
         0.000068542861, -0.000244961140, -0.000001004178,  0.000169848481, ... 
        -0.000023410851,  0.000042013261, -0.000093347880, -0.000179797809, ... 
         0.000238220088,  0.000129913315, -0.000203643393, -0.000014499620, ... 
        -0.000042254569,  0.000025833928,  0.000278809433, -0.000156697320, ... 
        -0.000276857588,  0.000186273846,  0.000075963638,  0.000030515333, ... 
         0.000065202473, -0.000332007629, -0.000002866863,  0.000402085778, ... 
        -0.000098799900, -0.000150099441, -0.000012787752, -0.000159531820, ... 
         0.000309468522,  0.000220296165, -0.000457325589, -0.000061799156, ... 
         0.000214834270, -0.000000671508,  0.000231798146, -0.000195169925, ... 
        -0.000450781891,  0.000398503494,  0.000275164909, -0.000240230221, ... 
        -0.000001012441, -0.000258319556, -0.000004347514,  0.000631128652, ... 
        -0.000201406643, -0.000495309871,  0.000196289357,  0.000024153415, ... 
         0.000224586305,  0.000256154351, -0.000693562314, -0.000124038235, ... 
         0.000656180255, -0.000063963427, -0.000065563084, -0.000131165905, ... 
        -0.000504208715,  0.000584832566,  0.000525838867, -0.000685787797, ... 
        -0.000153403075,  0.000110043111, -0.000004238844,  0.000680284999, ... 
        -0.000286029625, -0.000912702595,  0.000526980240,  0.000422103606, ... 
        -0.000132166503,  0.000149889890, -0.000720876312, -0.000172749695, ... 
         0.001169634109, -0.000160214054, -0.000677571632,  0.000103125992, ... 
        -0.000268050747,  0.000586202382,  0.000708522483, -0.001185040305, ... 
        -0.000378274283,  0.000834051615, -0.000001704939,  0.000326049761, ... 
        -0.000276092503, -0.001195976517,  0.000884164201,  0.000989892838, ... 
        -0.000804574658, -0.000173454117, -0.000307116137, -0.000162478321, ... 
         0.001492592306, -0.000260516530, -0.001523982074,  0.000528039284, ... 
         0.000394480363,  0.000217286278,  0.000639839463, -0.001474213431, ... 
        -0.000604376076,  0.001806461236,  0.000003020506, -0.000602266476, ... 
        -0.000085425470, -0.001040767721,  0.001073114341,  0.001541347568, ... 
        -0.001683205782, -0.000722427451,  0.000715055277, -0.000044706289, ... 
         0.001251441240, -0.000308395433, -0.002318570132,  0.001069311168, ... 
         0.001486477172, -0.000648175274,  0.000128844562, -0.001190067404, ... 
        -0.000701153036,  0.002689573782,  0.000008375051, -0.002091880712, ... 
         0.000341888008, -0.000139063562,  0.000833143065,  0.001748426222, ... 
        -0.002456014244, -0.001389004130,  0.002316232846,  0.000209231101, ... 
         0.000077485449, -0.000229484626, -0.002574813374,  0.001531256177, ... 
         0.002786593977, -0.001975348983, -0.000934302050,  0.000018707252, ... 
        -0.000503367249,  0.002926976981,  0.000011939957, -0.003834587413, ... 
         0.000985696787,  0.001680604482, -0.000084630134,  0.001201468563, ... 
        -0.002622036914, -0.001925053501,  0.004162010916,  0.000583922375, ... 
        -0.002230982780,  0.000047647564, -0.001691541751,  0.001605797434, ... 
         0.003808600915, -0.003488082385, -0.002487779170,  0.002345602909, ... 
         0.000144021432,  0.001834338381,  0.000011537603, -0.005178971292, ... 
         0.001715063635,  0.004318198248, -0.001822918988, -0.000491633204, ... 
        -0.001563298334, -0.001953855232,  0.005567808369,  0.001003681762, ... 
        -0.005564768801,  0.000568330523,  0.000924699347,  0.000907798364, ... 
         0.003816230919, -0.004635258662, -0.004240728450,  0.005712132447, ... 
         0.001345302195, -0.001297056292,  0.000006437527, -0.005135902043, ... 
         0.002272978414,  0.007328654680, -0.004360378536, -0.003641718758, ... 
         0.001405617384, -0.000981620221,  0.005483627980,  0.001326967983, ... 
        -0.009450408707,  0.001344592018,  0.005842281264, -0.001031631114, ... 
         0.001792242055, -0.004555808586, -0.005654495996,  0.009770763846, ... 
         0.003171903297, -0.007307597221, -0.000002004487, -0.002239218990, ... 
         0.002245863543,  0.009919569755, -0.007580013146, -0.008650540563, ... 
         0.007310432377,  0.001768881356,  0.002200362348,  0.001323770915, ... 
        -0.013131970859,  0.002409516001,  0.014181619855, -0.005112789200, ... 
        -0.004185850150, -0.001663981350, -0.005821404040,  0.014181892270, ... 
         0.005934981462, -0.018513949927, -0.000010719003,  0.006976953781, ... 
         0.000736237640,  0.010784786203, -0.011824088724, -0.017517614063, ... 
         0.020009399097,  0.008949216859, -0.009643876483,  0.000380636983, ... 
        -0.015777356027,  0.004262554258,  0.032896516632, -0.016127461148, ... 
        -0.023693836395,  0.011349913157, -0.001434658588,  0.020761746296, ... 
         0.013228725197, -0.055998604485, -0.000016221150,  0.052942905860, ... 
        -0.009954510820,  0.002183844255, -0.028313161434, -0.071411187148, ... 
         0.125883618732,  0.093657838664, -0.235187752812, -0.042869697305, ... 
         0.283259711398 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMb.ok"; fail; fi

cat > test_hMc.ok << 'EOF'
hMc = [  0.000006348104, -0.000004299772,  0.000002791447,  0.000009838670, ... 
        -0.000016340858, -0.000006019899,  0.000025662821, -0.000004340389, ... 
        -0.000017844362,  0.000005442330, -0.000000992472,  0.000010620744, ... 
         0.000009883327, -0.000026480225, -0.000001831907,  0.000017373474, ... 
        -0.000003349623,  0.000012615043, -0.000011740680, -0.000029515055, ... 
         0.000028860412,  0.000014647020, -0.000013259780,  0.000006121987, ... 
        -0.000031307438,  0.000000332339,  0.000054063278, -0.000018940638, ... 
        -0.000022538967,  0.000002793994, -0.000025938125,  0.000048995871, ... 
         0.000031811923, -0.000069723386, -0.000001577563,  0.000012750729, ... 
         0.000000678249,  0.000068211551, -0.000046261348, -0.000078387345, ... 
         0.000061313076,  0.000014458111,  0.000016790759,  0.000026596959, ... 
        -0.000119252699,  0.000005987478,  0.000114357621, -0.000029943763, ... 
         0.000006871030, -0.000043830112, -0.000100158101,  0.000144616338, ... 
         0.000065528880, -0.000109425488,  0.000005994184, -0.000073179582, ... 
         0.000025111674,  0.000203530237, -0.000109736461, -0.000127839115, ... 
         0.000058072923, -0.000038930719,  0.000154180099,  0.000074480824, ... 
        -0.000281837312,  0.000015800669,  0.000125310194, -0.000004544061, ... 
         0.000158816666, -0.000179119834, -0.000240950249,  0.000271665592, ... 
         0.000077747785, -0.000035352918,  0.000032436155, -0.000331854462, ... 
         0.000079587394,  0.000394072083, -0.000158990504, -0.000076345160, ... 
        -0.000086038884, -0.000207397887,  0.000452335822,  0.000143609536, ... 
        -0.000426326002,  0.000022739249, -0.000077028971,  0.000109437010, ... 
         0.000503163159, -0.000400473835, -0.000382749070,  0.000291151099, ... 
        -0.000012161800,  0.000323835672,  0.000088649247, -0.000774652256, ... 
         0.000145648260,  0.000467739505, -0.000080985809,  0.000244152034, ... 
        -0.000479622050, -0.000509464746,  0.000828988281,  0.000180599990, ... 
        -0.000292953384,  0.000014956067, -0.000677404552,  0.000335717600, ... 
         0.000970443325, -0.000576311941, -0.000325873837, -0.000052388245, ... 
        -0.000303245387,  0.001069921512,  0.000167657619, -0.001182030229, ... 
         0.000158324623,  0.000088528999,  0.000269223481,  0.000955378153, ... 
        -0.001097703840, -0.000822697082,  0.000956012790,  0.000073060567, ... 
         0.000477728662, -0.000014682912, -0.001681103433,  0.000598828660, ... 
         0.001220846125, -0.000415350313,  0.000226819785, -0.000995399707, ... 
        -0.000821376128,  0.002011891804,  0.000221179920, -0.001024157901, ... 
         0.000019981883, -0.001092279214,  0.000947864329,  0.001927345428, ... 
        -0.001626655970, -0.000818722074,  0.000286464723, -0.000311781241, ... 
         0.002088481356, -0.000057364181, -0.002667194802,  0.000679818328, ... 
         0.000642939327,  0.000433504005,  0.001489401469, -0.002489129321, ... 
        -0.001393945169,  0.002490125792,  0.000147918304,  0.000400273138, ... 
        -0.000341599756, -0.003110668101,  0.001765115869,  0.002592858165, ... 
        -0.001421579178, -0.000020733734, -0.001692847084, -0.001027079861, ... 
         0.004218162369, -0.000087089567, -0.002675389246,  0.000255453314, ... 
        -0.001417978704,  0.002143317472,  0.003312427574, -0.003932530802, ... 
        -0.001568142489,  0.001420158804, -0.000186277188,  0.003577490038, ... 
        -0.000893678505, -0.005331272168,  0.002189310348,  0.001928673924, ... 
         0.000335233479,  0.001990922832, -0.005051516167, -0.001919733998, ... 
         0.005741697967, -0.000075708622, -0.000351537519, -0.000977590569, ... 
        -0.005264439891,  0.004440765253,  0.004937878811, -0.004060464754, ... 
        -0.000627352283, -0.002432662289, -0.000898037335,  0.008325472917, ... 
        -0.001444328528, -0.006231467990,  0.001358817120, -0.001405661833, ... 
         0.004381690294,  0.005342739239, -0.009073023135, -0.002529165721, ... 
         0.004614325789, -0.000015944569,  0.005858413528, -0.003204388672, ... 
        -0.010557126060,  0.006446445303,  0.004827569264, -0.000855351079, ... 
         0.002440692451, -0.010399991588, -0.002063264984,  0.013596114575, ... 
        -0.001623396236, -0.003074055783, -0.002074581181, -0.009388956865, ... 
         0.011599299771,  0.009934250972, -0.012126719485, -0.001901334082, ... 
        -0.003005749719,  0.000066580740,  0.018918858005, -0.006808261837, ... 
        -0.016649742979,  0.006401117119, -0.000447227938,  0.010471622183, ... 
         0.010345118848, -0.026778344016, -0.004019801453,  0.017767910595, ... 
        -0.000568212557,  0.012696374655, -0.013150834662, -0.031170881014, ... 
         0.028120772493,  0.017739615313, -0.010212181979,  0.004206187305, ... 
        -0.039328008739,  0.000125788500,  0.068164616995, -0.018850625782, ... 
        -0.029191308541, -0.008185528095, -0.053154143451,  0.116687783855, ... 
         0.095961593836, -0.255252526630, -0.047822580790,  0.319358331526 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMc.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave-cli -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hMa.ok selesnickFIRsymmetric_bandpass_test_hMa_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMa.ok"; fail; fi

diff -Bb test_hMb.ok selesnickFIRsymmetric_bandpass_test_hMb_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMb.ok"; fail; fi

diff -Bb test_hMc.ok selesnickFIRsymmetric_bandpass_test_hMc_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMc.ok"; fail; fi

#
# this much worked
#
pass

