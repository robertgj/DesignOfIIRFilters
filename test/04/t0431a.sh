#!/bin/sh

prog=vaidyanathan_trick_test.m

depends="test/vaidyanathan_trick_test.m test_common.m print_polynomial.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test.ok << 'EOF'
h = [  -0.0001328048,   0.0000000000,   0.0000659852,   0.0000000000, ... 
       -0.0000819813,   0.0000000000,   0.0001001583,   0.0000000000, ... 
       -0.0001206022,   0.0000000000,   0.0001434523,   0.0000000000, ... 
       -0.0001689076,   0.0000000000,   0.0001971195,   0.0000000000, ... 
       -0.0002280982,   0.0000000000,   0.0002618441,   0.0000000000, ... 
       -0.0002985774,   0.0000000000,   0.0003384474,   0.0000000000, ... 
       -0.0003809982,   0.0000000000,   0.0004267988,   0.0000000000, ... 
       -0.0004754732,   0.0000000000,   0.0005271173,   0.0000000000, ... 
       -0.0005815954,   0.0000000000,   0.0006388276,   0.0000000000, ... 
       -0.0006986774,   0.0000000000,   0.0007609237,   0.0000000000, ... 
       -0.0008253373,   0.0000000000,   0.0008917220,   0.0000000000, ... 
       -0.0009597632,   0.0000000000,   0.0010290550,   0.0000000000, ... 
       -0.0010993649,   0.0000000000,   0.0011701606,   0.0000000000, ... 
       -0.0012410568,   0.0000000000,   0.0013115048,   0.0000000000, ... 
       -0.0013809921,   0.0000000000,   0.0014489282,   0.0000000000, ... 
       -0.0015146645,   0.0000000000,   0.0015775414,   0.0000000000, ... 
       -0.0016368769,   0.0000000000,   0.0016918998,   0.0000000000, ... 
       -0.0017418159,   0.0000000000,   0.0017858505,   0.0000000000, ... 
       -0.0018230906,   0.0000000000,   0.0018526786,   0.0000000000, ... 
       -0.0018736473,   0.0000000000,   0.0018850595,   0.0000000000, ... 
       -0.0018859034,   0.0000000000,   0.0018751384,   0.0000000000, ... 
       -0.0018517138,   0.0000000000,   0.0018145430,   0.0000000000, ... 
       -0.0017624804,   0.0000000000,   0.0016943655,   0.0000000000, ... 
       -0.0016090105,   0.0000000000,   0.0015051415,   0.0000000000, ... 
       -0.0013814780,   0.0000000000,   0.0012366384,   0.0000000000, ... 
       -0.0010692184,   0.0000000000,   0.0008776896,   0.0000000000, ... 
       -0.0006604381,   0.0000000000,   0.0004157380,   0.0000000000, ... 
       -0.0001417008,   0.0000000000,  -0.0001637609,   0.0000000000, ... 
        0.0005029567,   0.0000000000,  -0.0008784910,   0.0000000000, ... 
        0.0012933618,   0.0000000000,  -0.0017510193,   0.0000000000, ... 
        0.0022555374,   0.0000000000,  -0.0028117346,   0.0000000000, ... 
        0.0034254642,   0.0000000000,  -0.0041038634,   0.0000000000, ... 
        0.0048557890,   0.0000000000,  -0.0056924059,   0.0000000000, ... 
        0.0066279962,   0.0000000000,  -0.0076811297,   0.0000000000, ... 
        0.0088764147,   0.0000000000,  -0.0102471710,   0.0000000000, ... 
        0.0118395745,   0.0000000000,  -0.0137194872,   0.0000000000, ... 
        0.0159840441,   0.0000000000,  -0.0187825901,   0.0000000000, ... 
        0.0223568170,   0.0000000000,  -0.0271248034,   0.0000000000, ... 
        0.0338770445,   0.0000000000,  -0.0443085165,   0.0000000000, ... 
        0.0628276969,   0.0000000000,  -0.1056016726,   0.0000000000, ... 
        0.3181425033,   0.5000000000,   0.3181425033,   0.0000000000, ... 
       -0.1056016726,   0.0000000000,   0.0628276969,   0.0000000000, ... 
       -0.0443085165,   0.0000000000,   0.0338770445,   0.0000000000, ... 
       -0.0271248034,   0.0000000000,   0.0223568170,   0.0000000000, ... 
       -0.0187825901,   0.0000000000,   0.0159840441,   0.0000000000, ... 
       -0.0137194872,   0.0000000000,   0.0118395745,   0.0000000000, ... 
       -0.0102471710,   0.0000000000,   0.0088764147,   0.0000000000, ... 
       -0.0076811297,   0.0000000000,   0.0066279962,   0.0000000000, ... 
       -0.0056924059,   0.0000000000,   0.0048557890,   0.0000000000, ... 
       -0.0041038634,   0.0000000000,   0.0034254642,   0.0000000000, ... 
       -0.0028117346,   0.0000000000,   0.0022555374,   0.0000000000, ... 
       -0.0017510193,   0.0000000000,   0.0012933618,   0.0000000000, ... 
       -0.0008784910,   0.0000000000,   0.0005029567,   0.0000000000, ... 
       -0.0001637609,   0.0000000000,  -0.0001417008,   0.0000000000, ... 
        0.0004157380,   0.0000000000,  -0.0006604381,   0.0000000000, ... 
        0.0008776896,   0.0000000000,  -0.0010692184,   0.0000000000, ... 
        0.0012366384,   0.0000000000,  -0.0013814780,   0.0000000000, ... 
        0.0015051415,   0.0000000000,  -0.0016090105,   0.0000000000, ... 
        0.0016943655,   0.0000000000,  -0.0017624804,   0.0000000000, ... 
        0.0018145430,   0.0000000000,  -0.0018517138,   0.0000000000, ... 
        0.0018751384,   0.0000000000,  -0.0018859034,   0.0000000000, ... 
        0.0018850595,   0.0000000000,  -0.0018736473,   0.0000000000, ... 
        0.0018526786,   0.0000000000,  -0.0018230906,   0.0000000000, ... 
        0.0017858505,   0.0000000000,  -0.0017418159,   0.0000000000, ... 
        0.0016918998,   0.0000000000,  -0.0016368769,   0.0000000000, ... 
        0.0015775414,   0.0000000000,  -0.0015146645,   0.0000000000, ... 
        0.0014489282,   0.0000000000,  -0.0013809921,   0.0000000000, ... 
        0.0013115048,   0.0000000000,  -0.0012410568,   0.0000000000, ... 
        0.0011701606,   0.0000000000,  -0.0010993649,   0.0000000000, ... 
        0.0010290550,   0.0000000000,  -0.0009597632,   0.0000000000, ... 
        0.0008917220,   0.0000000000,  -0.0008253373,   0.0000000000, ... 
        0.0007609237,   0.0000000000,  -0.0006986774,   0.0000000000, ... 
        0.0006388276,   0.0000000000,  -0.0005815954,   0.0000000000, ... 
        0.0005271173,   0.0000000000,  -0.0004754732,   0.0000000000, ... 
        0.0004267988,   0.0000000000,  -0.0003809982,   0.0000000000, ... 
        0.0003384474,   0.0000000000,  -0.0002985774,   0.0000000000, ... 
        0.0002618441,   0.0000000000,  -0.0002280982,   0.0000000000, ... 
        0.0001971195,   0.0000000000,  -0.0001689076,   0.0000000000, ... 
        0.0001434523,   0.0000000000,  -0.0001206022,   0.0000000000, ... 
        0.0001001583,   0.0000000000,  -0.0000819813,   0.0000000000, ... 
        0.0000659852,   0.0000000000,  -0.0001328048 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed cat test.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test.ok vaidyanathan_trick_test_coef.m 
if [ $? -ne 0 ]; then echo "Failed diff -Bb test.ok"; fail; fi

#
# this much worked
#
pass

