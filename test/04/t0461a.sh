#!/bin/sh

prog=selesnickFIRsymmetric_lowpass_test.m

depends="selesnickFIRsymmetric_lowpass_test.m test_common.m \
selesnickFIRsymmetric_lowpass.m lagrange_interp.m print_polynomial.m \
local_max.m local_peak.m xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hMa.ok << 'EOF'
hMa = [ -0.000000014562, -0.000000090689, -0.000000213766, -0.000000307226, ... 
        -0.000000232952,  0.000000062431,  0.000000415888,  0.000000489795, ... 
         0.000000063787, -0.000000636911, -0.000000961898, -0.000000372575, ... 
         0.000000882856,  0.000001692094,  0.000000968907, -0.000001099790, ... 
        -0.000002746124, -0.000001993370,  0.000001202385,  0.000004191795, ... 
         0.000003626827, -0.000001059223, -0.000006088830, -0.000006093249, ... 
         0.000000479828,  0.000008477666,  0.000009661078,  0.000000798958, ... 
        -0.000011365537, -0.000014642270, -0.000003127023,  0.000014709473, ... 
         0.000021388278,  0.000006954902, -0.000018396168, -0.000030282312, ... 
        -0.000012846805,  0.000022218865,  0.000041727277,  0.000021491924, ... 
        -0.000025851603, -0.000056128891, -0.000033713096,  0.000028821309, ... 
         0.000073873589,  0.000050471877, -0.000030478460, -0.000095301017, ... 
        -0.000072869062,  0.000029967127,  0.000120671090,  0.000102139783, ... 
        -0.000026195392, -0.000150125794, -0.000139642391,  0.000017807208, ... 
         0.000183646158,  0.000186840513, -0.000003156775, -0.000221004996, ... 
        -0.000245277920, -0.000019713504,  0.000261716242,  0.000316546057, ... 
         0.000053090566, -0.000304981823, -0.000402244458, -0.000099603040, ... 
         0.000349637075,  0.000503934574,  0.000162228040, -0.000394095720, ... 
        -0.000623087906, -0.000244292511,  0.000436295219,  0.000761029692, ... 
         0.000349469839, -0.000473643038, -0.000918879739, -0.000481773221, ... 
         0.000502963820,  0.001097492269,  0.000645548263, -0.000520446658, ... 
        -0.001297396930, -0.000845468523,  0.000521590514,  0.001518743244, ... 
         0.001086539341, -0.000501144184, -0.001761250890, -0.001374117367, ... 
         0.000453034894,  0.002024168198,  0.001713956157, -0.000370276282, ... 
        -0.002306241089, -0.002112292263,  0.000244841692,  0.002605694512, ... 
         0.002575992328, -0.000067481433, -0.002920228060, -0.003112790990, ... 
        -0.000172548517,  0.003247027060,  0.003731664141,  0.000487896761, ... 
        -0.003582789902, -0.004443406472, -0.000893745562,  0.003923771801, ... 
         0.005261523690,  0.001408789311, -0.004265844595, -0.006203623423, ... 
        -0.002056783323,  0.004604571531,  0.007293624576,  0.002869052777, ... 
        -0.004935295387, -0.008565367331, -0.003888682919,  0.005253237681, ... 
         0.010068741467,  0.005177800620, -0.005553606227, -0.011880615287, ... 
        -0.006830891865,  0.005831707865,  0.014125585195,  0.009000814962, ... 
        -0.006083062864, -0.017018653010, -0.011954154422,  0.006303517361, ... 
         0.020962694375,  0.016203284823, -0.006489350114, -0.026805286837, ... 
        -0.022876195676,  0.006637369988,  0.036673178628,  0.035037299030, ... 
        -0.006745000837, -0.057810442045, -0.064951769346,  0.006810350830, ... 
         0.140958922716,  0.272107164111,  0.326501069527 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMa.ok"; fail; fi

cat > test_hMb.ok << 'EOF'
hMb = [ -0.000000028465, -0.000000153959, -0.000000403711, -0.000000727906, ... 
        -0.000000892973, -0.000000546298,  0.000000570241,  0.000002265611, ... 
         0.000003664744,  0.000003400696,  0.000000401586, -0.000004991701, ... 
        -0.000010311779, -0.000011528425, -0.000005231464,  0.000008360603, ... 
         0.000023488811,  0.000030146069,  0.000019275279, -0.000010100860, ... 
        -0.000046245181, -0.000067204350, -0.000051859590,  0.000004763823, ... 
         0.000081191523,  0.000133669182,  0.000117644664,  0.000018117501, ... 
        -0.000129093667, -0.000243323164, -0.000237847082, -0.000076164705, ... 
         0.000186850060,  0.000411913208,  0.000441094358,  0.000196406772, ... 
        -0.000244907152, -0.000655562897, -0.000763744247, -0.000417472960, ... 
         0.000284238787,  0.000988506441,  0.001249667321,  0.000791673370, ... 
        -0.000273011971, -0.001420365493, -0.001949797402, -0.001387242580, ... 
         0.000162895094,  0.001953346945,  0.002922263490,  0.002291701766, ... 
         0.000115518649, -0.002579849868, -0.004234794298, -0.003618669995, ... 
        -0.000659833993,  0.003280997828,  0.005972817454,  0.005523459968, ... 
         0.001609851832, -0.004026537380, -0.008260761442, -0.008240290188, ... 
        -0.003179707211,  0.004776364410,  0.011315604898,  0.012175913398, ... 
         0.005740487394, -0.005483681316, -0.015590866478, -0.018172416559, ... 
        -0.010064339127,  0.006099495094,  0.022236869278,  0.028410286054, ... 
         0.018233496955, -0.006577897538, -0.035134157920, -0.050931701453, ... 
        -0.038934677573,  0.006881382076,  0.079164410071,  0.158436702295, ... 
         0.219889962738,  0.243014607965 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMb.ok"; fail; fi

cat > test_hMc.ok << 'EOF'
hMc = [  0.001227369155, -0.000000000000, -0.002164349264,  0.000000000000, ... 
         0.003961637345,  0.000000000000, -0.006642342013, -0.000000000000, ... 
         0.010511156324,  0.000000000000, -0.016026641792, -0.000000000000, ... 
         0.023990839047,  0.000000000000, -0.036077454180, -0.000000000000, ... 
         0.056640173402,  0.000000000000, -0.101760500918,  0.000000000000, ... 
         0.316840112895,  0.500000000000 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMc.ok"; fail; fi

cat > test_hMd.ok << 'EOF'
hMd = [ -0.000000748558,  0.000000000000,  0.000000603215,  0.000000000000, ... 
        -0.000000843471,  0.000000000000,  0.000001144926,  0.000000000000, ... 
        -0.000001518383, -0.000000000000,  0.000001975976,  0.000000000000, ... 
        -0.000002531273, -0.000000000000,  0.000003199387,  0.000000000000, ... 
        -0.000003997086, -0.000000000000,  0.000004942909,  0.000000000000, ... 
        -0.000006057285, -0.000000000000,  0.000007362648,  0.000000000000, ... 
        -0.000008883565, -0.000000000000,  0.000010646856,  0.000000000000, ... 
        -0.000012681718, -0.000000000000,  0.000015019857,  0.000000000000, ... 
        -0.000017695606, -0.000000000000,  0.000020746059,  0.000000000000, ... 
        -0.000024211195, -0.000000000000,  0.000028134007,  0.000000000000, ... 
        -0.000032560623, -0.000000000000,  0.000037540439,  0.000000000000, ... 
        -0.000043126237, -0.000000000000,  0.000049374311,  0.000000000000, ... 
        -0.000056344588, -0.000000000000,  0.000064100749,  0.000000000000, ... 
        -0.000072710348, -0.000000000000,  0.000082244931,  0.000000000000, ... 
        -0.000092780151, -0.000000000000,  0.000104395888,  0.000000000000, ... 
        -0.000117176362, -0.000000000000,  0.000131210254,  0.000000000000, ... 
        -0.000146590824, -0.000000000000,  0.000163416029,  0.000000000000, ... 
        -0.000181788657, -0.000000000000,  0.000201816450,  0.000000000000, ... 
        -0.000223612244, -0.000000000000,  0.000247294122,  0.000000000000, ... 
        -0.000272985565, -0.000000000000,  0.000300815635,  0.000000000000, ... 
        -0.000330919162, -0.000000000000,  0.000363436959,  0.000000000000, ... 
        -0.000398516066, -0.000000000000,  0.000436310020,  0.000000000000, ... 
        -0.000476979166, -0.000000000000,  0.000520691015,  0.000000000000, ... 
        -0.000567620643, -0.000000000000,  0.000617951169,  0.000000000000, ... 
        -0.000671874287, -0.000000000000,  0.000729590893,  0.000000000000, ... 
        -0.000791311804, -0.000000000000,  0.000857258593,  0.000000000000, ... 
        -0.000927664555, -0.000000000000,  0.001002775826,  0.000000000000, ... 
        -0.001082852685, -0.000000000000,  0.001168171059,  0.000000000000, ... 
        -0.001259024280, -0.000000000000,  0.001355725119,  0.000000000000, ... 
        -0.001458608168, -0.000000000000,  0.001568032601,  0.000000000000, ... 
        -0.001684385417, -0.000000000000,  0.001808085218,  0.000000000000, ... 
        -0.001939586653, -0.000000000000,  0.002079385630,  0.000000000000, ... 
        -0.002228025473,  0.000000000000,  0.002386104185,  0.000000000000, ... 
        -0.002554283079,  0.000000000000,  0.002733297041, -0.000000000000, ... 
        -0.002923966807,  0.000000000000,  0.003127213709, -0.000000000000, ... 
        -0.003344077459,  0.000000000000,  0.003575737742, -0.000000000000, ... 
        -0.003823540551,  0.000000000000,  0.004089030545, -0.000000000000, ... 
        -0.004373991051,  0.000000000000,  0.004680493905, -0.000000000000, ... 
        -0.005010962059,  0.000000000000,  0.005368248902, -0.000000000000, ... 
        -0.005755739754,  0.000000000000,  0.006177483074, -0.000000000000, ... 
        -0.006638362059,  0.000000000000,  0.007144321892, -0.000000000000, ... 
        -0.007702674910,  0.000000000000,  0.008322516718, -0.000000000000, ... 
        -0.009015303348,  0.000000000000,  0.009795667219, -0.000000000000, ... 
        -0.010682595676,  0.000000000000,  0.011701175158, -0.000000000000, ... 
        -0.012885245283,  0.000000000000,  0.014281569434, -0.000000000000, ... 
        -0.015956639253,  0.000000000000,  0.018008282147, -0.000000000000, ... 
        -0.020586554565,  0.000000000000,  0.023933921137, -0.000000000000, ... 
        -0.028469265238,  0.000000000000,  0.034983913239, -0.000000000000, ... 
        -0.045173699724,  0.000000000000,  0.063447988407, -0.000000000000, ... 
        -0.105974775276,  0.000000000000,  0.318267024988,  0.500000000000 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hMd.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave-cli -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hMa.ok selesnickFIRsymmetric_lowpass_test_hMa_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMa.ok"; fail; fi

diff -Bb test_hMb.ok selesnickFIRsymmetric_lowpass_test_hMb_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMb.ok"; fail; fi

diff -Bb test_hMc.ok selesnickFIRsymmetric_lowpass_test_hMc_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMc.ok"; fail; fi

diff -Bb test_hMd.ok selesnickFIRsymmetric_lowpass_test_hMd_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMd.ok"; fail; fi

#
# this much worked
#
pass

