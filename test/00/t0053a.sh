#!/bin/sh

prog=goldfarb_idnani_fir_minimum_phase_test.m

depends="goldfarb_idnani_fir_minimum_phase_test.m \
test_common.m goldfarb_idnani.m iirE.m iirA.m iirP.m iirT.m \
xConstraints.m tf2x.m zp2x.m fixResultNaN.m updateWchol.m 
armijo_kim.m invSVD.m sqp_bfgs.m updateWbfgs.m qroots.m qzsolve.oct"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test.ok << 'EOF'
maxiter = 2500
tol = 1.0000e-03
fapl = 0.1000
fapu = 0.2000
dBap = 3
Wap = 1
fasl = 0.050000
fasu = 0.2500
dBas = 20
Wasl = 1
Wasu = 1
N = 41
R = 1
Initial x0 = [ -0.000553 -1.823326 -0.548448 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 0.264871 0.788032 0.787381 1.268984 1.270032 1.000000 1.000000 1.000000 3.775417 3.042980 2.849519 2.663426 2.484143 2.309947 2.140277 1.975570 1.818770 1.679377 1.584821 0.761172 1.106564 0.779415 1.106564 0.779415 0.300219 0.207264 0.072378 0.761172 ]
ans = 0
Active constraints are [  ]
Step 1: Trying constraint 77 at g(77) = [ -2.775417 ]
Step 2a: step direction in primal space d = [ 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 -1.123477 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 ]
Step 2b)ii): full step length t2 = 2.470382
Step 2b)iii): selecting step length t = 2.470382
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000553 -1.823326 -0.548448 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 0.264871 0.788032 0.787381 1.268984 1.270032 1.000000 1.000000 1.000000 1.000000 3.042980 2.849519 2.663426 2.484143 2.309947 2.140277 1.975570 1.818770 1.679377 1.584821 0.761172 1.106564 0.779415 1.106564 0.779415 0.300219 0.207264 0.072378 0.761172 ]
f(x) =0.662508
Adding constraint 77
Active constraints are [ 77 ]
Step 1: Trying constraint 16 at g(16) = [ -0.823326 ]
Step 2a: step direction in primal space d = [ -0.000047 4.449903 -0.071789 0.037449 0.036689 0.035270 0.033204 0.030487 0.027112 0.023114 0.018656 0.014229 0.011010 -0.066485 -0.018270 -0.017862 0.014374 0.014098 0.008928 0.010942 0.012671 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.628015 0.114690 0.062700 0.045052 0.018602 0.005811 -0.002290 0.005811 -0.002290 -0.000000 -0.000000 -0.000000 0.022324 ]
Step 2a: step direction in dual space r = [ -0.063493 ]
Step 2b)ii): full step length t2 = 0.185021
Step 2b)iii): selecting step length t = 0.185021
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000562 -1.000000 -0.561731 1.006929 1.006788 1.006526 1.006144 1.005641 1.005016 1.004277 1.003452 1.002633 1.002037 0.252570 0.784652 0.784077 1.271643 1.272641 1.001652 1.002025 1.002344 1.000000 3.042980 2.849519 2.663426 2.484143 2.309947 2.140277 2.091766 1.839990 1.690978 1.593157 0.764614 1.107639 0.778991 1.107639 0.778991 0.300219 0.207264 0.072378 0.765303 ]
f(x) =0.660183
Adding constraint 16
Active constraints are [ 77 16 ]
Step 1: Trying constraint 3 at g(3) = [ -0.730256 ]
Step 2a: step direction in primal space d = [ 0.000002 -0.000000 0.002531 -0.001309 -0.001284 -0.001237 -0.001169 -0.001078 -0.000964 -0.000823 -0.000670 -0.000514 -0.000399 0.002365 0.001165 0.000875 -0.000690 -0.000585 -0.000324 -0.000397 -0.000459 0.000000 -0.000000 -0.000000 -0.000000 -0.000000 -0.000000 -0.000000 -0.000792 -0.002745 -0.001483 -0.000956 -0.000306 -0.000886 0.001097 -0.000906 0.001120 -0.000000 0.000000 0.000000 0.131777 ]
Step 2a: step direction in dual space r = [ 0.011345 0.003726 ]
Step 2b)i): partial step length t1 = 49.662250
Step 2b)ii): full step length t2 = 45.140099
Step 2b)iii): selecting step length t = 45.140099
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000493 -1.000000 -0.447499 0.947824 0.948812 0.950665 0.953380 0.956987 0.961523 0.967146 0.973195 0.979423 0.984022 0.359335 0.837251 0.823553 1.240484 1.246218 0.987031 0.984117 0.981628 1.000000 3.042980 2.849519 2.663426 2.484143 2.309947 2.140276 2.056016 1.716083 1.624020 1.550023 0.750816 1.067659 0.828493 1.066727 0.829564 0.300219 0.207264 0.072378 6.713731 ]
f(x) =0.639777
Adding constraint 3
Active constraints are [ 77 16 3 ]
Step 1: Trying constraint 4 at g(4) = [ -0.010746 ]
Step 2a: step direction in primal space d = [ -0.000002 0.000000 -0.004561 0.001493 0.001471 0.001431 0.001374 0.001299 0.001207 0.001049 0.001242 0.001196 0.001361 -0.008548 -0.002793 -0.003302 0.001240 0.001512 0.000344 0.000422 0.000489 -0.000000 0.000000 0.000000 -0.000000 -0.000000 -0.000000 -0.000000 -0.008621 -0.014526 -0.010976 -0.012302 0.004815 0.001956 -0.000002 0.001745 0.000073 -0.000000 -0.000000 -0.000000 0.004340 ]
Step 2a: step direction in dual space r = [ -0.000259 -0.001038 0.670955 ]
Step 2b)i): partial step length t1 = 67.277363
Step 2b)ii): full step length t2 = 5.282717
Step 2b)iii): selecting step length t = 5.282717
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000501 -1.000000 -0.471593 0.955708 0.956583 0.958226 0.960637 0.963848 0.967899 0.972686 0.979757 0.985743 0.991213 0.314178 0.822495 0.806111 1.247034 1.254204 0.988848 0.986345 0.984209 1.000000 3.042980 2.849519 2.663426 2.484143 2.309947 2.140276 2.010471 1.639347 1.566037 1.485036 0.776253 1.077992 0.828485 1.075943 0.829948 0.300219 0.207264 0.072378 6.736655 ]
f(x) =0.638124
Adding constraint 4
Active constraints are [ 77 16 3 4 ]
Step 1: Trying constraint 5 at g(5) = [ -0.008434 ]
Step 2a: step direction in primal space d = [ -0.000006 -0.000000 -0.014939 0.005353 0.005274 0.005135 0.004954 0.004792 0.004925 0.006420 0.003420 0.002533 0.002282 -0.020689 -0.005539 -0.005763 0.003051 0.003203 0.001251 0.001533 0.001774 0.000000 0.000000 0.000000 0.000000 -0.000000 -0.000000 -0.000000 -0.260061 0.044028 0.015670 0.004052 0.008497 0.002419 -0.000066 0.002317 -0.000033 -0.000000 -0.000000 -0.000000 0.024204 ]
Step 2a: step direction in dual space r = [ -0.004567 -0.005418 0.122968 -0.740234 ]
Step 2b)i): partial step length t1 = 338.264988
Step 2b)ii): full step length t2 = 0.466004
Step 2b)iii): selecting step length t = 0.466004
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000504 -1.000000 -0.478555 0.958203 0.959041 0.960619 0.962946 0.966081 0.970194 0.975678 0.981351 0.986923 0.992276 0.304537 0.819913 0.803425 1.248455 1.255696 0.989431 0.987059 0.985036 1.000000 3.042980 2.849519 2.663426 2.484143 2.309947 2.140276 1.889282 1.659865 1.573339 1.486924 0.780212 1.079119 0.828454 1.077023 0.829932 0.300219 0.207264 0.072378 6.747935 ]
f(x) =0.637884
Adding constraint 5
Active constraints are [ 77 16 3 4 5 ]
Step 1: Trying constraint 6 at g(6) = [ -0.001892 ]
Step 2a: step direction in primal space d = [ 0.000002 0.000000 0.000503 -0.001352 -0.001282 -0.001078 0.000016 0.004587 -0.000719 0.001867 -0.000683 -0.000521 -0.000378 -0.000133 0.000165 0.000144 -0.000357 -0.000334 -0.000341 -0.000419 -0.000485 -0.000000 -0.000000 -0.000000 -0.000000 -0.000000 0.000000 0.000000 0.011440 0.000223 -0.000572 -0.001087 0.000311 -0.000017 0.000097 -0.000021 0.000098 0.000000 0.000000 0.000000 0.000528 ]
Step 2a: step direction in dual space r = [ 0.003126 0.001687 0.036465 -0.133314 -0.212410 ]
Step 2b)i): partial step length t1 = 14.736563
Step 2b)ii): full step length t2 = 12.683205
Step 2b)iii): selecting step length t = 12.683205
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000480 -1.000000 -0.472181 0.941061 0.942785 0.946951 0.963150 1.024263 0.961079 0.999355 0.972693 0.980315 0.987480 0.302848 0.822002 0.805252 1.243927 1.251457 0.985101 0.981749 0.978885 1.000000 3.042980 2.849519 2.663426 2.484143 2.309947 2.140276 2.034373 1.662693 1.566082 1.473136 0.784161 1.078901 0.829684 1.076751 0.831170 0.300219 0.207264 0.072378 6.754637 ]
f(x) =0.637824
Adding constraint 6
Active constraints are [ 77 16 3 4 5 6 ]
Step 1: Trying constraint 73 at g(73) = [ -0.251457 ]
Step 2a: step direction in primal space d = [ 0.000002 -0.000000 -0.010563 -0.000973 -0.000716 0.000147 0.005236 0.019810 0.001137 0.011129 -0.000011 0.000081 0.001501 -0.015767 -0.003607 -0.003900 0.001004 -0.042089 -0.000365 -0.000449 -0.000521 0.000000 -0.000000 -0.000000 -0.000000 -0.000000 0.000000 0.000000 0.022881 0.028651 0.005974 -0.010185 0.006764 0.001892 -0.000061 0.001786 -0.000039 -0.000000 -0.000000 -0.000000 -0.010033 ]
Step 2a: step direction in dual space r = [ -0.006512 -0.004316 1.044024 -1.918045 -0.306009 -1.270793 ]
Step 2b)i): partial step length t1 = 39.343749
Step 2b)ii): full step length t2 = 5.974448
Step 2b)iii): selecting step length t = 5.974448
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000466 -1.000000 -0.535288 0.935249 0.938510 0.947828 0.994433 1.142615 0.967873 1.065842 0.972627 0.980796 0.996445 0.208646 0.800451 0.781953 1.249923 1.000000 0.982919 0.979066 0.975772 1.000000 3.042980 2.849519 2.663426 2.484142 2.309948 2.140277 2.171074 1.833867 1.601773 1.412289 0.824573 1.090206 0.829320 1.087424 0.830936 0.300219 0.207264 0.072378 6.694697 ]
f(x) =0.637701
Adding constraint 73
Active constraints are [ 77 16 3 4 5 6 73 ]
Step 1: Trying constraint 72 at g(72) = [ -0.249923 ]
Step 2a: step direction in primal space d = [ 0.000002 0.000000 -0.004326 -0.001929 -0.001766 -0.001135 0.006090 0.044339 -0.000463 0.018804 -0.003282 -0.001256 -0.002943 -0.002414 0.000387 0.000641 -0.046414 -0.000000 -0.000513 -0.000629 -0.000729 0.000000 -0.000000 -0.000000 -0.000000 -0.000000 0.000000 0.000000 0.046347 0.009439 0.013162 0.008588 0.000272 -0.000661 -0.000047 -0.000517 -0.001494 0.000000 0.000000 0.000000 -0.010482 ]
Step 2a: step direction in dual space r = [ -0.018137 -0.010324 0.677504 0.174560 0.349995 4.671509 -0.022573 ]
Step 2b)i): partial step length t1 = 4.340245
Step 2b)ii): full step length t2 = 5.384689
Step 2b)iii): selecting step length t = 4.340245
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000455 -1.000000 -0.554065 0.926877 0.930844 0.942901 1.020867 1.335057 0.965862 1.147456 0.958381 0.975343 0.983671 0.198170 0.802131 0.784735 1.048476 1.000000 0.980693 0.976335 0.972606 1.000000 3.042980 2.849519 2.663426 2.484142 2.309949 2.140277 2.372232 1.874835 1.658899 1.449563 0.825754 1.087335 0.829118 1.085181 0.824452 0.300219 0.207264 0.072378 6.649204 ]
f(x) =0.635835
Dropping constraint 6
Step 2a: step direction in primal space d = [ 0.000017 0.000000 -0.027586 -0.012021 -0.010960 -0.007223 0.027388 0.202391 -0.002388 0.086940 0.006520 -0.005023 -0.002754 -0.035289 -0.005864 -0.005712 -0.218342 -0.000000 -0.003274 -0.004019 -0.004658 0.000000 -0.000000 -0.000000 -0.000000 -0.000000 0.000001 0.000000 0.253528 0.051656 0.040113 -0.020959 0.014612 0.002345 0.000121 0.004288 -0.007931 0.000000 0.000000 0.000000 -0.045652 ]
Step 2a: step direction in dual space r = [ -0.003009 -0.002193 1.459238 -1.086442 -1.294471 0.028938 ]
Step 2b)i): partial step length t1 = 21.859245
Step 2b)ii): full step length t2 = 0.222020
Step 2b)iii): selecting step length t = 0.222020
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000452 -1.000000 -0.560190 0.924208 0.928411 0.941297 1.026947 1.379992 0.965332 1.166758 0.959829 0.974228 0.983060 0.190335 0.800829 0.783467 1.000000 1.000000 0.979966 0.975442 0.971572 1.000000 3.042980 2.849519 2.663426 2.484142 2.309949 2.140277 2.428520 1.886304 1.667804 1.444909 0.828998 1.087856 0.829144 1.086133 0.822691 0.300219 0.207264 0.072378 6.639069 ]
f(x) =0.635438
Adding constraint 72
Active constraints are [ 77 16 3 4 5 73 72 ]
Step 1: Trying constraint 2 at g(2) = [ -0.002189 ]
Step 2a: step direction in primal space d = [ -0.000002 -0.000000 -0.002079 0.001269 0.001226 0.001127 0.000823 -0.000304 0.000852 0.000494 -0.002590 0.000481 0.000202 -0.001841 -0.001490 -0.001434 -0.000000 0.000000 0.000397 0.000417 0.000449 0.000000 0.000000 0.000000 0.000000 0.000000 -0.000000 -0.000000 -0.043674 0.004642 0.000357 0.001259 0.000628 0.000411 -0.000345 0.001650 -0.002562 0.000000 0.000000 0.000000 0.042178 ]
Step 2a: step direction in dual space r = [ -0.002944 -0.001147 1.220595 0.027326 0.187597 0.004926 0.008018 ]
Step 2b)i): partial step length t1 = 20.024889
Step 2b)ii): full step length t2 = 3.112168
Step 2b)iii): selecting step length t = 3.112168
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000458 -1.000000 -0.566659 0.928157 0.932226 0.944806 1.029507 1.379045 0.967983 1.168297 0.951768 0.975726 0.983688 0.184607 0.796192 0.779005 1.000000 1.000000 0.981201 0.976739 0.972970 1.000000 3.042980 2.849519 2.663426 2.484142 2.309949 2.140277 2.292600 1.900750 1.668916 1.448827 0.830954 1.089135 0.828069 1.091268 0.814718 0.300219 0.207264 0.072378 6.770335 ]
f(x) =0.634157
Adding constraint 2
Active constraints are [ 77 16 3 4 5 73 72 2 ]
Step 1: Trying constraint 65 at g(65) = [ -0.168297 ]
Step 2a: step direction in primal space d = [ -0.000063 0.000000 -0.000668 0.042712 0.040328 0.033390 -0.003757 -0.159896 0.019383 -0.285358 -0.005656 0.015036 0.015986 0.035935 0.002259 0.002912 -0.000000 -0.000000 0.010790 0.013237 0.015343 -0.000000 0.000000 0.000000 0.000000 0.000001 -0.000001 -0.000000 0.221372 -0.033291 -0.017239 0.010694 -0.024512 -0.002943 -0.003415 -0.000004 -0.006930 -0.000000 -0.000000 -0.000000 0.001544 ]
Step 2a: step direction in dual space r = [ -0.020110 -0.009981 2.289071 -0.741210 1.950151 -0.186690 -0.353650 1.183992 ]
Step 2b)i): partial step length t1 = 1.626939
Step 2b)ii): full step length t2 = 0.589777
Step 2b)iii): selecting step length t = 0.589777
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000495 -1.000000 -0.567053 0.953347 0.956011 0.964499 1.027292 1.284741 0.979414 1.000000 0.948432 0.984594 0.993116 0.205800 0.797524 0.780723 1.000000 1.000000 0.987564 0.984545 0.982019 1.000000 3.042980 2.849519 2.663426 2.484142 2.309949 2.140277 2.423160 1.881116 1.658749 1.455134 0.816497 1.087399 0.826055 1.091266 0.810631 0.300219 0.207264 0.072378 6.771246 ]
f(x) =0.633978
Adding constraint 65
Active constraints are [ 77 16 3 4 5 73 72 2 65 ]
Step 1: Trying constraint 63 at g(63) = [ -0.284741 ]
Step 2a: step direction in primal space d = [ -0.000123 0.000000 -0.020767 0.086379 0.081842 0.068653 -0.001775 -0.581078 0.043068 -0.000000 0.001810 0.032759 0.026283 0.032618 -0.004439 -0.003581 0.000000 -0.000000 0.021860 0.026804 0.031055 0.000000 0.000000 0.000000 0.000000 0.000001 -0.000002 -0.000000 0.035162 -0.129096 -0.028682 0.016989 -0.029349 -0.001105 -0.005826 -0.002427 -0.002956 -0.000000 -0.000000 -0.000000 0.000647 ]
Step 2a: step direction in dual space r = [ -0.016591 -0.009908 -1.750688 -0.764955 2.780641 -0.368420 -0.704648 -0.511728 0.579722 ]
Step 2b)i): partial step length t1 = 0.727395
Step 2b)ii): full step length t2 = 0.490022
Step 2b)iii): selecting step length t = 0.490022
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000556 -1.000000 -0.577229 0.995674 0.996115 0.998141 1.026422 1.000000 1.000518 1.000000 0.949319 1.000647 1.005996 0.221783 0.795349 0.778968 1.000000 1.000000 0.998276 0.997680 0.997236 1.000000 3.042980 2.849519 2.663426 2.484143 2.309948 2.140277 2.440390 1.817856 1.644695 1.463459 0.802116 1.086857 0.823201 1.090077 0.809183 0.300219 0.207264 0.072378 6.771563 ]
f(x) =0.633823
Adding constraint 63
Active constraints are [ 77 16 3 4 5 73 72 2 65 63 ]
Step 1: Trying constraint 68 at g(68) = [ -0.005996 ]
Step 2a: step direction in primal space d = [ 0.000004 0.000000 0.004597 -0.003092 -0.002947 -0.002493 0.000145 -0.000000 -0.002173 0.000000 -0.006011 -0.002244 -0.105838 0.011130 0.002801 0.003256 0.000000 -0.000000 -0.000704 -0.000908 -0.001073 -0.000000 -0.000000 -0.000000 -0.000000 -0.000000 0.000000 0.000000 0.144624 0.006318 0.009643 0.011271 -0.006287 -0.001916 -0.000549 0.002200 -0.006114 0.000000 0.000000 0.000000 0.001518 ]
Step 2a: step direction in dual space r = [ -0.013878 -0.006508 3.160168 -0.307811 0.101656 -0.005775 -0.006622 1.159034 -0.030565 -0.045062 ]
Step 2b)i): partial step length t1 = 2.299013
Step 2b)ii): full step length t2 = 0.056650
Step 2b)iii): selecting step length t = 0.056650
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000555 -1.000000 -0.576969 0.995499 0.995948 0.997999 1.026430 1.000000 1.000395 1.000000 0.948979 1.000519 1.000000 0.222414 0.795508 0.779152 1.000000 1.000000 0.998236 0.997629 0.997176 1.000000 3.042980 2.849519 2.663426 2.484143 2.309948 2.140277 2.448583 1.818214 1.645241 1.464097 0.801760 1.086749 0.823170 1.090201 0.808836 0.300219 0.207264 0.072378 6.771649 ]
f(x) =0.633814
Adding constraint 68
Active constraints are [ 77 16 3 4 5 73 72 2 65 63 68 ]
Step 1: Trying constraint 62 at g(62) = [ -0.026430 ]
Step 2a: step direction in primal space d = [ -0.000009 0.000000 -0.007259 0.006336 0.006159 0.005775 -0.304335 0.000000 0.003689 0.000000 0.000736 0.001764 -0.000000 -0.000336 -0.001749 -0.001654 -0.000000 -0.000000 0.001554 0.001883 0.002171 -0.000000 0.000000 0.000000 0.000000 0.000000 -0.000000 0.000000 0.238110 0.001082 0.006792 0.003387 -0.002595 0.000445 -0.001286 0.006580 -0.009597 -0.000000 -0.000000 -0.000000 0.002893 ]
Step 2a: step direction in dual space r = [ -0.028183 -0.013700 5.632514 -0.490345 0.074075 -0.040667 -0.070184 2.298424 0.004232 -0.000001 -0.008130 ]
Step 2b)i): partial step length t1 = 1.130765
Step 2b)ii): full step length t2 = 0.086845
Step 2b)iii): selecting step length t = 0.086845
Step 2c)iii): Step in primal and dual space.
Next x = [ -0.000556 -1.000000 -0.577599 0.996050 0.996483 0.998501 1.000000 1.000000 1.000716 1.000000 0.949043 1.000673 1.000000 0.222385 0.795356 0.779009 1.000000 1.000000 0.998371 0.997792 0.997364 1.000000 3.042980 2.849519 2.663426 2.484143 2.309948 2.140277 2.469262 1.818308 1.645831 1.464391 0.801534 1.086788 0.823058 1.090773 0.808003 0.300219 0.207264 0.072378 6.771900 ]
f(x) =0.633765
Adding constraint 62
Active constraints are [ 77 16 3 4 5 73 72 2 65 63 68 62 ]
All constraints satisfied. Feasible solution found.
EOF
if [ $? -ne 0 ]; then echo "Failed output cat"; fail; fi

#
# run and see if the results match
#
echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test.ok test.out
if [ $? -ne 0 ]; then echo "Failed diff -Bb"; fail; fi


#
# this much worked
#
pass
