#!/bin/sh

prog=tarczynski_frm_hilbert_test.m

depends="tarczynski_frm_hilbert_test.m test_common.m print_polynomial.m"
tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test.q1.ok << 'EOF'
q1 = [    -0.0002683377,     0.0000000000,    -0.0003806134,     0.0000000000, ... 
          -0.0005862656,     0.0000000000,    -0.0008203264,     0.0000000000, ... 
          -0.0010345482,     0.0000000000,    -0.0013889911,     0.0000000000, ... 
          -0.0020529695,     0.0000000000,    -0.0024535900,     0.0000000000, ... 
          -0.0029023514,     0.0000000000,    -0.0029204338,     0.0000000000, ... 
          -0.0032575329,     0.0000000000,    -0.0029081167,     0.0000000000, ... 
          -0.0030741361,     0.0000000000,    -0.0038348970,     0.0000000000, ... 
          -0.0042615777,     0.0000000000,    -0.0047452081,     0.0000000000, ... 
          -0.0047150267,     0.0000000000,    -0.0050048988,     0.0000000000, ... 
          -0.0045496745,     0.0000000000,    -0.0048891842,     0.0000000000, ... 
          -0.0061856087,     0.0000000000,    -0.0066357367,     0.0000000000, ... 
          -0.0073480152,     0.0000000000,    -0.0070904598,     0.0000000000, ... 
          -0.0073588980,     0.0000000000,    -0.0063688687,     0.0000000000, ... 
          -0.0065363085,     0.0000000000,    -0.0079412020,     0.0000000000, ... 
          -0.0076015206,     0.0000000000,    -0.0080129633,     0.0000000000, ... 
          -0.0070778819,     0.0000000000,    -0.0065900949,     0.0000000000, ... 
          -0.0067850536,     0.0000000000,    -0.0056414030,     0.0000000000, ... 
          -0.0009756359,     0.0000000000,    -0.0088493544,     0.0000000000, ... 
          -0.0217048595,     0.0000000000,    -0.0609118878,     0.0000000000, ... 
          -0.1435319753,     0.0000000000,    -0.5800878668,     0.0000000000, ... 
           0.6896409962,     0.0000000000,     0.2732942919,     0.0000000000, ... 
           0.1799736542,     0.0000000000,     0.1442879952,     0.0000000000, ... 
           0.1137719122,     0.0000000000,     0.0943949951,     0.0000000000, ... 
           0.0761430411,     0.0000000000,     0.0389735171,     0.0000000000, ... 
           0.0344658867,     0.0000000000,     0.0266222037,     0.0000000000, ... 
           0.0191649391,     0.0000000000,     0.0174201767,     0.0000000000, ... 
           0.0113806286,     0.0000000000,     0.0395962706,     0.0000000000, ... 
          -0.0394703757,     0.0000000000,    -0.0114882110,     0.0000000000, ... 
          -0.0044471139,     0.0000000000,    -0.0003727946,     0.0000000000, ... 
           0.0033847828,     0.0000000000,     0.0096726338,     0.0000000000, ... 
           0.0330430072,     0.0000000000,    -0.0331523332,     0.0000000000, ... 
          -0.0095792102,     0.0000000000,    -0.0039411473,     0.0000000000, ... 
          -0.0007558977,     0.0000000000,     0.0017871094,     0.0000000000, ... 
           0.0058978515,     0.0000000000,     0.0199798233,     0.0000000000, ... 
          -0.0200888429,     0.0000000000,    -0.0058046897,     0.0000000000, ... 
          -0.0023419149,     0.0000000000,    -0.0003696320,     0.0000000000, ... 
           0.0012885959,     0.0000000000,     0.0040045147,     0.0000000000, ... 
           0.0135838799,     0.0000000000,    -0.0136961200,     0.0000000000, ... 
          -0.0039086010,     0.0000000000,    -0.0018597903,     0.0000000000, ... 
          -0.0007891456,     0.0000000000,    -0.0003889923,     0.0000000000, ... 
           0.0000653188,     0.0000000000,    -0.0000339492,     0.0000000000, ... 
          -0.0000424880,     0.0000000000 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test.q1.ok"; fail; fi

cat > test.r2M1.ok << 'EOF'
r2M1 = [     1.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,    -0.0169550560,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
            -0.0630714869,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,    -0.0527925721,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
            -0.0319505096,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,     0.0000000000,     0.0000000000, ... 
             0.0000000000,     0.0000000000,    -0.0217587945 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test.r2M1.ok"; fail; fi

cat > test.r1.ok << 'EOF'
r1 = [     1.0000000000,     0.0169550560,    -0.0630714869,     0.0527925721, ... 
          -0.0319505096,     0.0217587945 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test.r1.ok"; fail; fi

cat > test.u1.ok << 'EOF'
u1 = [    -0.0061661892,     0.0087461967,    -0.0134719225,     0.0188504571, ... 
          -0.0237731038,     0.0319179244,    -0.0471756262,     0.0473271666, ... 
           0.4461491183 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test.u1.ok"; fail; fi

cat > test.v1.ok << 'EOF'
v1 = [    -0.0009763415,     0.0007801263,     0.0015009738,     0.0089387375, ... 
          -0.0181339461,     0.0427365209,    -0.0898165794,     0.3132924210 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test.v1.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test.q1.ok tarczynski_frm_hilbert_test_q1_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test.q1.ok"; fail; fi
diff -Bb test.r2M1.ok tarczynski_frm_hilbert_test_r2M1_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test.r2M1.ok"; fail; fi
diff -Bb test.r1.ok tarczynski_frm_hilbert_test_r1_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test.r1.ok"; fail; fi
diff -Bb test.u1.ok tarczynski_frm_hilbert_test_u1_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test.u1.ok"; fail; fi
diff -Bb test.v1.ok tarczynski_frm_hilbert_test_v1_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test.v1.ok"; fail; fi


#
# this much worked
#
pass

