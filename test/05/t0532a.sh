#!/bin/sh

prog=selesnickFIRsymmetric_lowpass_alternate_test.m

depends="test/selesnickFIRsymmetric_lowpass_alternate_test.m test_common.m \
selesnickFIRsymmetric_lowpass.m lagrange_interp.m print_polynomial.m \
local_max.m local_peak.m xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM.ok << 'EOF'
hM = [  -0.0000076432,  -0.0000221582,  -0.0000489632,  -0.0000892910, ... 
        -0.0001407437,  -0.0001952357,  -0.0002383412,  -0.0002504267, ... 
        -0.0002099216,  -0.0000984775,   0.0000929377,   0.0003585636, ... 
         0.0006747924,   0.0010010740,   0.0012854986,   0.0014745471, ... 
         0.0015251655,   0.0014162935,   0.0011566280,   0.0007859670, ... 
         0.0003689163,  -0.0000182578,  -0.0003048134,  -0.0004425027, ... 
        -0.0004177330,  -0.0002552986,  -0.0000121940,   0.0002372498, ... 
         0.0004211046,   0.0004890703,   0.0004257277,   0.0002539196, ... 
         0.0000271682,  -0.0001867314,  -0.0003261095,  -0.0003537037, ... 
        -0.0002672960,  -0.0000994838,   0.0000932793,   0.0002488767, ... 
         0.0003191785,   0.0002849060,   0.0001610154,  -0.0000090259, ... 
        -0.0001680866,  -0.0002643915,  -0.0002684190,  -0.0001821271, ... 
        -0.0000375444,   0.0001146631,   0.0002226765,   0.0002510799, ... 
         0.0001925333,   0.0000696653,  -0.0000733336,  -0.0001863921, ... 
        -0.0002310086,  -0.0001934008,  -0.0000888359,   0.0000442611, ... 
         0.0001582328,   0.0002131565,   0.0001908328,   0.0001008800, ... 
        -0.0000231425,  -0.0001360930,  -0.0001975874,  -0.0001864293, ... 
        -0.0001079687,   0.0000081930,   0.0001192344,   0.0001848146, ... 
         0.0001817105,   0.0001120792,   0.0000023865,  -0.0001065395, ... 
        -0.0001746287,  -0.0001772862,  -0.0001143057,  -0.0000097317, ... 
         0.0000972260,   0.0001668262,   0.0001735374,   0.0001154241, ... 
         0.0000147166,  -0.0000906160,  -0.0001611206,  -0.0001706122, ... 
        -0.0001159131,  -0.0000179490,   0.0000861924,   0.0001572492, ... 
         0.0001685622,   0.0001160863,   0.0000198709,  -0.0000835468, ... 
        -0.0001549699,  -0.0001673741,  -0.0001161380,  -0.0000207957, ... 
         0.0000823654,   0.0001540749,   0.0001670049,   0.0001161871, ... 
         0.0000209472,  -0.0000824063,  -0.0001543875,  -0.0001673963, ... 
        -0.0001163016,  -0.0000204833,   0.0000834842,   0.0001557606, ... 
         0.0001684855,   0.0001165154,   0.0000195142,  -0.0000854576, ... 
        -0.0001580725,  -0.0001702096,  -0.0001168404,  -0.0000181149, ... 
         0.0000882193,   0.0001612231,   0.0001725088,   0.0001172735, ... 
         0.0000163352,  -0.0000916886,  -0.0001651302,  -0.0001753273, ... 
        -0.0001178017,  -0.0000142054,   0.0000958051,   0.0001697267, ... 
         0.0001786140,   0.0001184056,   0.0000117420,  -0.0001005250, ... 
        -0.0001749575,  -0.0001823219,  -0.0001190615,  -0.0000089509, ... 
         0.0001058166,   0.0001807774,   0.0001864080,   0.0001197428, ... 
         0.0000058300,  -0.0001116582,  -0.0001871492,  -0.0001908330, ... 
        -0.0001204212,  -0.0000023709,   0.0001180357,   0.0001940422, ... 
         0.0001955601,   0.0001210670,  -0.0000014391,  -0.0001249411, ... 
        -0.0002014307,  -0.0002005555,  -0.0001216496,   0.0000056164, ... 
         0.0001323712,   0.0002092930,   0.0002057867,   0.0001221377, ... 
        -0.0000101802,  -0.0001403263,  -0.0002176107,  -0.0002112231, ... 
        -0.0001224996,   0.0000151521,   0.0001488096,   0.0002263674, ... 
         0.0002168350,   0.0001227027,  -0.0000205551,  -0.0001578266, ... 
        -0.0002355489,  -0.0002225935,  -0.0001227142,   0.0000264138, ... 
         0.0001673843,   0.0002451418,   0.0002284697,   0.0001225008, ... 
        -0.0000327540,  -0.0001774909,  -0.0002551339,  -0.0002344354, ... 
        -0.0001220283,   0.0000396023,   0.0001881557,   0.0002655132, ... 
         0.0002404616,   0.0001212623,  -0.0000469861,  -0.0001993882, ... 
        -0.0002762677,  -0.0002465194,  -0.0001201672,   0.0000549334, ... 
         0.0002111985,   0.0002873853,   0.0002525791,   0.0001187073, ... 
        -0.0000634728,  -0.0002235966,  -0.0002988537,  -0.0002586103, ... 
        -0.0001168457,   0.0000726333,   0.0002365924,   0.0003106596, ... 
         0.0002645816,   0.0001145448,  -0.0000824441,  -0.0002501955, ... 
        -0.0003227891,  -0.0002704608,  -0.0001117664,   0.0000929348, ... 
         0.0002644154,   0.0003352275,   0.0002762144,   0.0001084711, ... 
        -0.0001041353,  -0.0002792605,  -0.0003479585,  -0.0002818076, ... 
        -0.0001046190,   0.0001160754,   0.0002947389,   0.0003609651, ... 
         0.0002872046,   0.0001001690,  -0.0001287852,  -0.0003108578, ... 
        -0.0003742286,  -0.0002923676,  -0.0000950792,   0.0001422948, ... 
         0.0003276237,   0.0003877289,   0.0002972580,   0.0000893067, ... 
        -0.0001566341,  -0.0003450418,  -0.0004014445,  -0.0003018350, ... 
        -0.0000828079,   0.0001718332,   0.0003631166,   0.0004153519, ... 
         0.0003060566,   0.0000755378,  -0.0001879220,  -0.0003818513, ... 
        -0.0004294262,  -0.0003098789,  -0.0000674510,   0.0002049302, ... 
         0.0004012478,   0.0004436405,   0.0003132565,   0.0000585006, ... 
        -0.0002228874,  -0.0004213069,  -0.0004579661,  -0.0003161420, ... 
        -0.0000486390,   0.0002418229,   0.0004420279,   0.0004723724, ... 
         0.0003184862,   0.0000378177,  -0.0002617660,  -0.0004634090, ... 
        -0.0004868265,  -0.0003202381,  -0.0000259868,   0.0002827454, ... 
         0.0004854466,   0.0005012937,   0.0003213448,   0.0000130959, ... 
        -0.0003047898,  -0.0005081358,  -0.0005157370,  -0.0003217512, ... 
         0.0000009070,   0.0003279273,   0.0005314701,   0.0005301172, ... 
         0.0003214004,  -0.0000160745,  -0.0003521861,  -0.0005554414, ... 
        -0.0005443929,  -0.0003202333,   0.0000324607,   0.0003775938, ... 
         0.0005800400,   0.0005585203,   0.0003181886,  -0.0000501205, ... 
        -0.0004041777,  -0.0006052546,  -0.0005724532,  -0.0003152028, ... 
         0.0000691104,   0.0004319650,   0.0006310721,   0.0005861429, ... 
         0.0003112102,  -0.0000894879,  -0.0004609825,  -0.0006574777, ... 
        -0.0005995382,  -0.0003061423,   0.0001113120,   0.0004912569, ... 
         0.0006844550,   0.0006125854,   0.0002999285,  -0.0001346433, ... 
        -0.0005228149,  -0.0007119859,  -0.0006252278,  -0.0002924953, ... 
         0.0001595439,   0.0005556828,   0.0007400503,   0.0006374062, ... 
         0.0002837665,  -0.0001860775,  -0.0005898871,  -0.0007686265, ... 
        -0.0006490584,  -0.0002736627,   0.0002143101,   0.0006254547, ... 
         0.0007976913,   0.0006601191,   0.0002621016,  -0.0002443097, ... 
        -0.0006624124,  -0.0008272195,  -0.0006705201,  -0.0002489973, ... 
         0.0002761465,   0.0007007878,   0.0008571842,   0.0006801896, ... 
         0.0002342604,  -0.0003098938,  -0.0007406089,  -0.0008875570, ... 
        -0.0006890527,  -0.0002177973,   0.0003456276,   0.0007819048, ... 
         0.0009183078,   0.0006970304,   0.0001995103,  -0.0003834274, ... 
        -0.0008247056,  -0.0009494046,  -0.0007040403,  -0.0001792966, ... 
         0.0004233766,   0.0008690430,   0.0009808143,   0.0007099955, ... 
         0.0001570484,  -0.0004655631,  -0.0009149504,  -0.0010125020, ... 
        -0.0007148048,  -0.0001326520,   0.0005100797,   0.0009624638, ... 
         0.0010444313,   0.0007183722,   0.0001059873,  -0.0005570249, ... 
        -0.0010116214,  -0.0010765644,  -0.0007205962,  -0.0000769269, ... 
         0.0006065039,   0.0010624653,   0.0011088623,   0.0007213699, ... 
         0.0000453352,  -0.0006586293,  -0.0011150413,  -0.0011412846, ... 
        -0.0007205799,  -0.0000110675,   0.0007135223,   0.0011693997, ... 
         0.0011737897,   0.0007181059,  -0.0000260312,  -0.0007713143, ... 
        -0.0012255969,  -0.0012063348,  -0.0007138197,   0.0000661280, ... 
         0.0008321477,   0.0012836956,   0.0012388762,   0.0007075843, ... 
        -0.0001094031,  -0.0008961785,  -0.0013437664,  -0.0012713692, ... 
        -0.0006992532,   0.0001560523,   0.0009635778,   0.0014058890, ... 
         0.0013037681,   0.0006886684,  -0.0002062891,  -0.0010345345, ... 
        -0.0014701541,  -0.0013360267,  -0.0006756592,   0.0002603474, ... 
         0.0011092582,   0.0015366649,   0.0013680980,   0.0006600404, ... 
        -0.0003184848,  -0.0011879823,  -0.0016055397,  -0.0013999343, ... 
        -0.0006416100,   0.0003809865,   0.0012709684,   0.0016769143, ... 
         0.0014314877,   0.0006201466,  -0.0004481696,  -0.0013585108, ... 
        -0.0017509453,  -0.0014627099,  -0.0005954058,   0.0005203887, ... 
         0.0014509427,   0.0018278138,   0.0014935524,   0.0005671170, ... 
        -0.0005980430,  -0.0015486428,  -0.0019077302,  -0.0015239665, ... 
        -0.0005349781,   0.0006815836,   0.0016520437,   0.0019909391, ... 
         0.0015539036,   0.0004986501,  -0.0007715237,  -0.0017616425, ... 
        -0.0020777266,  -0.0015833153,  -0.0004577499,   0.0008684509, ... 
         0.0018780134,   0.0021684284,   0.0016121533,   0.0004118415, ... 
        -0.0009730415,  -0.0020018229,  -0.0022634397,  -0.0016403700, ... 
        -0.0003604253,   0.0010860794,   0.0021338498,   0.0023632280, ... 
         0.0016679180,   0.0003029242,  -0.0012084795,  -0.0022750093, ... 
        -0.0024683490,  -0.0016947506,  -0.0002386668,   0.0013413166, ... 
         0.0024263840,   0.0025794668,   0.0017208221,   0.0001668647, ... 
        -0.0014858635,  -0.0025892638,  -0.0026973799,  -0.0017460875, ... 
        -0.0000865845,   0.0016436396,   0.0027651968,   0.0028230543, ... 
         0.0017705027,  -0.0000032894,  -0.0018164741,  -0.0029560569, ... 
        -0.0029576678,  -0.0017940250,   0.0001041036,   0.0020065903, ... 
         0.0031641324,   0.0031026682,   0.0018166128,  -0.0002175017, ... 
        -0.0022167178,  -0.0033922461,  -0.0032598522,  -0.0018382258, ... 
         0.0003455124,   0.0024502465,   0.0036439184,   0.0034314730, ... 
         0.0018588252,  -0.0004906730,  -0.0027114382,  -0.0039235949, ... 
        -0.0036203906,  -0.0018783740,   0.0006562014,   0.0030057264, ... 
         0.0042369676,   0.0038302861,   0.0018968366,  -0.0008462436, ... 
        -0.0033401484,  -0.0045914412,  -0.0040659718,  -0.0019141793, ... 
         0.0010662375,   0.0037239817,   0.0049968238,   0.0043338557, ... 
         0.0019303704,  -0.0013234607,  -0.0041697115,  -0.0054663819, ... 
        -0.0046426531,  -0.0019453798,   0.0016278841,   0.0046945445, ... 
         0.0060185033,   0.0050045181,   0.0019591800,  -0.0019935470, ... 
        -0.0053228691,  -0.0066794225,  -0.0054369114,  -0.0019717451, ... 
         0.0024408698,   0.0060904322,   0.0074878911,   0.0059658362, ... 
         0.0019830519,  -0.0030007468,  -0.0070518131,  -0.0085036362, ... 
        -0.0066317700,  -0.0019930790,   0.0037222487,   0.0082946922, ... 
         0.0098237478,   0.0075013362,   0.0020018078,  -0.0046882948, ... 
        -0.0099694072,  -0.0116172748,  -0.0086924434,  -0.0020092217, ... 
         0.0060509138,   0.0123570603,   0.0142069967,   0.0104353377, ... 
         0.0020153069,  -0.0081221815,  -0.0160511386,  -0.0182954980, ... 
        -0.0132481284,  -0.0020200518,   0.0116600229,   0.0225582565, ... 
         0.0257564287,   0.0185910176,   0.0020234474,  -0.0191066885, ... 
        -0.0371516836,  -0.0438168807,  -0.0327916821,  -0.0020254874, ... 
         0.0451158051,   0.1002601479,   0.1519754063,   0.1887320865, ... 
         0.2020261678 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM.ok"; fail; fi


#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM.ok selesnickFIRsymmetric_lowpass_alternate_test_hM_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMa.ok"; fail; fi

#
# this much worked
#
pass

