#!/bin/sh

prog=selesnickFIRsymmetric_lowpass_alternate_test.m

depends="selesnickFIRsymmetric_lowpass_alternate_test.m test_common.m \
selesnickFIRsymmetric_lowpass.m lagrange_interp.m print_polynomial.m \
local_max.m local_peak.m xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM.ok << 'EOF'
hM = [  -0.0000003725,  -0.0000008833,  -0.0000016650,  -0.0000025401, ... 
        -0.0000031845,  -0.0000031168,  -0.0000017832,   0.0000012930, ... 
         0.0000063261,   0.0000130990,   0.0000208752,   0.0000284431, ... 
         0.0000343170,   0.0000370674,   0.0000357099,   0.0000300414, ... 
         0.0000208125,   0.0000096573,  -0.0000012377,  -0.0000096570, ... 
        -0.0000139396,  -0.0000134504,  -0.0000087888,  -0.0000016475, ... 
         0.0000056565,   0.0000108549,   0.0000124035,   0.0000099473, ... 
         0.0000044189,  -0.0000022736,  -0.0000078771,  -0.0000105429, ... 
        -0.0000094452,  -0.0000050576,   0.0000010144,   0.0000065931, ... 
         0.0000096932,   0.0000092257,   0.0000053887,  -0.0000003985, ... 
        -0.0000060030,  -0.0000093522,  -0.0000091957,  -0.0000055765, ... 
         0.0000001693,   0.0000058933,   0.0000094276,   0.0000094012, ... 
         0.0000057720,  -0.0000001309,  -0.0000060848,  -0.0000098020, ... 
        -0.0000098036,  -0.0000060066,   0.0000002091,   0.0000064941, ... 
         0.0000104109,   0.0000103736,   0.0000062878,  -0.0000003695, ... 
        -0.0000070760,  -0.0000112137,  -0.0000110860,  -0.0000066095, ... 
         0.0000006015,   0.0000078093,   0.0000121868,   0.0000119217, ... 
         0.0000069612,  -0.0000009057,  -0.0000086864,  -0.0000133174, ... 
        -0.0000128659,  -0.0000073303,   0.0000012897,   0.0000097079, ... 
         0.0000145990,   0.0000139073,   0.0000077036,  -0.0000017646, ... 
        -0.0000108793,  -0.0000160294,  -0.0000150361,  -0.0000080667, ... 
         0.0000023443,   0.0000122092,   0.0000176085,   0.0000162433, ... 
         0.0000084048,  -0.0000030447,  -0.0000137083,  -0.0000193377, ... 
        -0.0000175201,  -0.0000087016,   0.0000038831,   0.0000153886, ... 
         0.0000212188,   0.0000188570,   0.0000089399,  -0.0000048780, ... 
        -0.0000172627,  -0.0000232534,  -0.0000202436,  -0.0000091011, ... 
         0.0000060494,   0.0000193438,   0.0000254425,   0.0000216681, ... 
         0.0000091647,  -0.0000074182,  -0.0000216451,  -0.0000277861, ... 
        -0.0000231168,  -0.0000091087,   0.0000090062,   0.0000241797, ... 
         0.0000302828,   0.0000245744,   0.0000089093,  -0.0000108364, ... 
        -0.0000269599,  -0.0000329297,  -0.0000260230,  -0.0000085408, ... 
         0.0000129321,   0.0000299977,   0.0000357217,   0.0000274424, ... 
         0.0000079756,  -0.0000153175,  -0.0000333037,  -0.0000386516, ... 
        -0.0000288098,  -0.0000071841,   0.0000180170,   0.0000368874, ... 
         0.0000417095,   0.0000300997,   0.0000061349,  -0.0000210554, ... 
        -0.0000407566,  -0.0000448828,  -0.0000312835,  -0.0000047948, ... 
         0.0000244573,   0.0000449172,   0.0000481558,   0.0000323297, ... 
         0.0000031288,  -0.0000282470,  -0.0000493727,  -0.0000515092, ... 
        -0.0000332036,  -0.0000011005,   0.0000324481,   0.0000541240, ... 
         0.0000549205,   0.0000338676,  -0.0000013281,  -0.0000370834, ... 
        -0.0000591693,  -0.0000583630,  -0.0000342805,   0.0000041962, ... 
         0.0000421744,   0.0000645030,   0.0000618060,   0.0000343984, ... 
        -0.0000075438,  -0.0000477408,  -0.0000701161,  -0.0000652148, ... 
        -0.0000341738,   0.0000114118,   0.0000538002,   0.0000759955, ... 
         0.0000685497,   0.0000335566,  -0.0000158411,  -0.0000603676, ... 
        -0.0000821233,  -0.0000717669,  -0.0000324935,   0.0000208730, ... 
         0.0000674552,   0.0000884773,   0.0000748176,   0.0000309286, ... 
        -0.0000265479,  -0.0000750716,  -0.0000950296,  -0.0000776481, ... 
        -0.0000288036,   0.0000329057,   0.0000832213,   0.0001017471, ... 
         0.0000802002,   0.0000260577,  -0.0000399848,  -0.0000919044, ... 
        -0.0001085908,  -0.0000824104,  -0.0000226284,   0.0000478215, ... 
         0.0001011160,   0.0001155153,   0.0000842105,   0.0000184517, ... 
        -0.0000564500,  -0.0001108457,  -0.0001224690,  -0.0000855276, ... 
        -0.0000134624,   0.0000659012,   0.0001210769,   0.0001293935, ... 
         0.0000862843,   0.0000075946,  -0.0000762023,  -0.0001317865, ... 
        -0.0001362236,  -0.0000863984,  -0.0000007824,   0.0000873763, ... 
         0.0001429443,   0.0001428869,   0.0000857839,  -0.0000070397, ... 
        -0.0000994411,  -0.0001545125,  -0.0001493040,  -0.0000843509, ... 
         0.0000159359,   0.0001124089,   0.0001664451,   0.0001553881, ... 
         0.0000820060,  -0.0000259688,  -0.0001262856,  -0.0001786877, ... 
        -0.0001610453,  -0.0000786528,   0.0000371983,   0.0001410697, ... 
         0.0001911769,   0.0001661745,   0.0000741924,  -0.0000496812, ... 
        -0.0001567521,  -0.0002038400,  -0.0001706674,  -0.0000685240, ... 
         0.0000634701,   0.0001733150,   0.0002165948,   0.0001744091, ... 
         0.0000615457,  -0.0000786125,  -0.0001907314,  -0.0002293487, ... 
        -0.0001772779,  -0.0000531549,   0.0000951502,   0.0002089643, ... 
         0.0002419995,   0.0001791459,   0.0000432494,  -0.0001131182, ... 
        -0.0002279658,  -0.0002544344,  -0.0001798794,  -0.0000317278, ... 
         0.0001325439,   0.0002476771,   0.0002665299,   0.0001793393, ... 
         0.0000184910,  -0.0001534459,  -0.0002680272,  -0.0002781526, ... 
        -0.0001773817,  -0.0000034426,   0.0001758333,   0.0002889327, ... 
         0.0002891583,   0.0001738588,  -0.0000135096,  -0.0001997047, ... 
        -0.0003102972,  -0.0002993927,  -0.0001686192,   0.0000324532, ... 
         0.0002250472,   0.0003320109,   0.0003086913,   0.0001615089, ... 
        -0.0000534693,  -0.0002518355,  -0.0003539500,  -0.0003168799, ... 
        -0.0001523725,   0.0000766321,   0.0002800310,   0.0003759767, ... 
         0.0003237749,   0.0001410536,  -0.0001020073,  -0.0003095807, ... 
        -0.0003979384,  -0.0003291839,  -0.0001273960,   0.0001296513, ... 
         0.0003404168,   0.0004196683,   0.0003329059,   0.0001112453, ... 
        -0.0001596095,  -0.0003724555,  -0.0004409846,  -0.0003347324, ... 
        -0.0000924492,   0.0001919157,   0.0004055964,   0.0004616906, ... 
         0.0003344478,   0.0000708593,  -0.0002265904,  -0.0004397218, ... 
        -0.0004815750,  -0.0003318304,  -0.0000463320,   0.0002636401, ... 
         0.0004746960,   0.0005004121,   0.0003266530,   0.0000187300, ... 
        -0.0003030558,  -0.0005103648,  -0.0005179617,  -0.0003186842, ... 
         0.0000120767,   0.0003448120,   0.0005465549,   0.0005339694, ... 
         0.0003076892,  -0.0000462090,  -0.0003888658,  -0.0005830736, ... 
        -0.0005481673,  -0.0002934307,   0.0000837781,   0.0004351554, ... 
         0.0006197084,   0.0005602746,   0.0002756706,  -0.0001248836, ... 
        -0.0004835998,  -0.0006562265,  -0.0005699973,  -0.0002541702, ... 
         0.0001696125,   0.0005340972,   0.0006923749,   0.0005770298, ... 
         0.0002286921,  -0.0002180379,  -0.0005865244,  -0.0007278803, ... 
        -0.0005810548,  -0.0001990013,   0.0002702179,   0.0006407363, ... 
         0.0007624485,   0.0005817442,   0.0001648658,  -0.0003261942, ... 
        -0.0006965645,  -0.0007957651,  -0.0005787599,  -0.0001260581, ... 
         0.0003859911,   0.0007538175,   0.0008274947,   0.0005717543, ... 
         0.0000823563,  -0.0004496146,  -0.0008122791,  -0.0008572817, ... 
        -0.0005603709,  -0.0000335448,   0.0005170515,   0.0008717088, ... 
         0.0008847498,   0.0005442451,  -0.0000205847,  -0.0005882684, ... 
        -0.0009318406,  -0.0009095024,  -0.0005230043,   0.0000802323, ... 
         0.0006632108,   0.0009923832,   0.0009311222,   0.0004962686, ... 
        -0.0001455897,  -0.0007418033,  -0.0010530188,  -0.0009491711, ... 
        -0.0004636508,   0.0002168394,   0.0008239480,   0.0011134036, ... 
         0.0009631905,   0.0004247565,  -0.0002941548,  -0.0009095252, ... 
        -0.0011731664,  -0.0009727000,  -0.0003791834,   0.0003777004, ... 
         0.0009983925,   0.0012319089,   0.0009771974,   0.0003265210, ... 
        -0.0004676319,  -0.0010903852,  -0.0012892047,  -0.0009761573, ... 
        -0.0002663493,   0.0005640972,   0.0011853162,   0.0013445987, ... 
         0.0009690298,   0.0001982371,  -0.0006672380,  -0.0012829762, ... 
        -0.0013976060,  -0.0009552383,  -0.0001217395,   0.0007771909, ... 
         0.0013831345,   0.0014477107,   0.0009341769,   0.0000363949, ... 
        -0.0008940907,  -0.0014855393,  -0.0014943640,  -0.0009052070, ... 
         0.0000582794,   0.0010180729,   0.0015899185,   0.0015369824, ... 
         0.0008676520,  -0.0001627926,  -0.0011492784,  -0.0016959810, ... 
        -0.0015749442,  -0.0008207921,   0.0002776877,   0.0012878584, ... 
         0.0018034172,   0.0016075859,   0.0007638552,  -0.0004035501, ... 
        -0.0014339812,  -0.0019119007,  -0.0016341968,  -0.0006960081, ... 
         0.0005410198,   0.0015878405,   0.0020210898,   0.0016540125, ... 
         0.0006163421,  -0.0006908053,  -0.0017496659,  -0.0021306285, ... 
        -0.0016662057,  -0.0005238575,   0.0008537027,   0.0019197356, ... 
         0.0022401488,   0.0016698749,   0.0004174411,  -0.0010306194, ... 
        -0.0020983936,  -0.0023492722,  -0.0016640290,  -0.0002958391, ... 
         0.0012226042,   0.0022860702,   0.0024576118,   0.0016475675, ... 
         0.0001576203,  -0.0014308870,  -0.0024833088,  -0.0025647740, ... 
        -0.0016192542,  -0.0000011297,   0.0016569300,   0.0026908011, ... 
         0.0026703612,   0.0015776817,  -0.0001755744,  -0.0019024944, ... 
        -0.0029094315,  -0.0027739733,  -0.0015212252,   0.0003748031, ... 
         0.0021697299,   0.0031403376,   0.0028752105,   0.0014479783, ... 
        -0.0005993480,  -0.0024612949,  -0.0033849905,  -0.0029736755, ... 
        -0.0013556662,   0.0008526345,   0.0027805205,   0.0036453039, ... 
         0.0030689756,   0.0012415252,  -0.0011389328,  -0.0031316381, ... 
        -0.0039237866,  -0.0031607251,  -0.0011021311,   0.0014636576, ... 
         0.0035201027,   0.0042237583,   0.0032485478,   0.0009331540, ... 
        -0.0018337988,  -0.0039530589,  -0.0045496625,  -0.0033320791, ... 
        -0.0007289959,   0.0022585592,   0.0044400343,   0.0049075325, ... 
         0.0034109683,   0.0004822437,  -0.0027503211,  -0.0049939949, ... 
        -0.0053057055,  -0.0034848809,  -0.0001828173,   0.0033261608, ... 
         0.0056330105,   0.0057559562,   0.0035535005,  -0.0001834047, ... 
        -0.0040103093,  -0.0063829807,  -0.0062753672,  -0.0036165308, ... 
         0.0006368973,   0.0048383296,   0.0072823083,   0.0068895670, ... 
         0.0036736978,  -0.0012085809,  -0.0058645919,  -0.0083903589, ... 
        -0.0076386641,  -0.0037247511,   0.0019475235,   0.0071765428, ... 
         0.0098038512,   0.0085889207,   0.0037694660,  -0.0029366127, ... 
        -0.0089242631,  -0.0116914544,  -0.0098578947,  -0.0038076445, ... 
         0.0043278170,   0.0113885764,   0.0143755623,   0.0116754941, ... 
         0.0038391170,  -0.0064331226,  -0.0151626711,  -0.0185583706, ... 
        -0.0145595043,  -0.0038637429,   0.0100103370,   0.0217528441, ... 
         0.0261131388,   0.0199698203,   0.0038814122,  -0.0175015653, ... 
        -0.0364320313,  -0.0442665700,  -0.0342338301,  -0.0038920456, ... 
         0.0435602621,   0.0996286119,   0.1525168308,   0.1902332301, ... 
         0.2038955954 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM.ok"; fail; fi


#
# run and see if the results match
#
echo "Running $prog" 

octave-cli -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM.ok selesnickFIRsymmetric_lowpass_alternate_test_hM_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMa.ok"; fail; fi

#
# this much worked
#
pass

