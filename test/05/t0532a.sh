#!/bin/sh

prog=selesnickFIRsymmetric_lowpass_alternate_test.m

depends="test/selesnickFIRsymmetric_lowpass_alternate_test.m test_common.m \
selesnickFIRsymmetric_lowpass.m lagrange_interp.m print_polynomial.m \
local_max.m local_peak.m xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM.ok << 'EOF'
hM = [  -0.0000076528,  -0.0000222054,  -0.0000491016,  -0.0000896103, ... 
        -0.0001413721,  -0.0001963326,  -0.0002400763,  -0.0002529461, ... 
        -0.0002133034,  -0.0001026870,   0.0000880827,   0.0003534038, ... 
         0.0006698058,   0.0009968181,   0.0012825229,   0.0014732894, ... 
         0.0015258559,   0.0014188879,   0.0011607931,   0.0007911259, ... 
         0.0003743493,  -0.0000132750,  -0.0003008659,  -0.0004399214, ... 
        -0.0004165367,  -0.0002552101,  -0.0000127268,   0.0002366564, ... 
         0.0004209367,   0.0004896172,   0.0004270181,   0.0002557334, ... 
         0.0000291176,  -0.0001850761,  -0.0003250873,  -0.0003534634, ... 
        -0.0002677575,  -0.0001003714,   0.0000923446,   0.0002482565, ... 
         0.0003191057,   0.0002854180,   0.0001619525,  -0.0000079600, ... 
        -0.0001672217,  -0.0002639806,  -0.0002685576,  -0.0001827270, ... 
        -0.0000383693,   0.0001139131,   0.0002222624,   0.0002511365, ... 
         0.0001930284,   0.0000704164,  -0.0000725917,  -0.0001859130, ... 
        -0.0002309465,  -0.0001937600,  -0.0000894735,   0.0000435809, ... 
         0.0001577535,   0.0002130429,   0.0001911151,   0.0001014463, ... 
        -0.0000225026,  -0.0001356108,  -0.0001974316,  -0.0001866471, ... 
        -0.0001084713,   0.0000075954,   0.0001187616,   0.0001846362, ... 
         0.0001818851,   0.0001125351,   0.0000029506,  -0.0001060768, ... 
        -0.0001744357,  -0.0001774290,  -0.0001147251,  -0.0000102674, ... 
         0.0000967748,   0.0001666258,   0.0001736584,   0.0001158166, ... 
         0.0000152299,  -0.0000901755,  -0.0001609169,  -0.0001707186, ... 
        -0.0001162859,  -0.0000184449,   0.0000857615,   0.0001570450, ... 
         0.0001686596,   0.0001164455,   0.0000203538,  -0.0000831241, ... 
        -0.0001547672,  -0.0001674666,  -0.0001164885,  -0.0000212694, ... 
         0.0000819495,   0.0001538748,   0.0001670958,   0.0001165330, ... 
         0.0000214150,  -0.0000819957,  -0.0001541908,  -0.0001674882, ... 
        -0.0001166461,  -0.0000209481,   0.0000830775,   0.0001555680, ... 
         0.0001685805,   0.0001168615,   0.0000199783,  -0.0000850537, ... 
        -0.0001578842,  -0.0001703094,  -0.0001171903,  -0.0000185805, ... 
         0.0000878172,   0.0001610394,   0.0001726149,   0.0001176292, ... 
         0.0000168039,  -0.0000912872,  -0.0001649515,  -0.0001754410, ... 
        -0.0001181649,  -0.0000146789,   0.0000954038,   0.0001695531, ... 
         0.0001787363,   0.0001187779,   0.0000122216,  -0.0001001231, ... 
        -0.0001747892,  -0.0001824537,  -0.0001194441,  -0.0000094377, ... 
         0.0001054136,   0.0001806148,   0.0001865504,   0.0001201370, ... 
         0.0000063248,  -0.0001112537,  -0.0001869927,  -0.0001909868, ... 
        -0.0001208280,  -0.0000028747,   0.0001176295,   0.0001938920, ... 
         0.0001957262,   0.0001214873,  -0.0000009256,  -0.0001245331, ... 
        -0.0002012873,  -0.0002007345,  -0.0001220843,   0.0000050927, ... 
         0.0001319612,   0.0002091569,   0.0002059796,   0.0001225877, ... 
        -0.0000096458,  -0.0001399143,  -0.0002174822,  -0.0002114306, ... 
        -0.0001229654,   0.0000146066,   0.0001483958,   0.0002262472, ... 
         0.0002170579,   0.0001231851,  -0.0000199982,  -0.0001574111, ... 
        -0.0002354376,  -0.0002228325,  -0.0001232139,   0.0000258453, ... 
         0.0001669674,   0.0002450401,   0.0002287257,   0.0001230183, ... 
        -0.0000321738,  -0.0001770730,  -0.0002550424,  -0.0002347090, ... 
        -0.0001225642,   0.0000390102,   0.0001877371,   0.0002654326, ... 
         0.0002407537,   0.0001218169,  -0.0000463821,  -0.0001989694, ... 
        -0.0002761988,  -0.0002468307,  -0.0001207411,   0.0000543177, ... 
         0.0002107801,   0.0002873290,   0.0002529103,   0.0001193008, ... 
        -0.0000628454,  -0.0002231791,  -0.0002988107,  -0.0002589621, ... 
        -0.0001174592,   0.0000719943,   0.0002361765,   0.0003106308, ... 
         0.0002649549,   0.0001151787,  -0.0000817939,  -0.0002497820, ... 
        -0.0003227755,  -0.0002708562,  -0.0001124208,   0.0000922737, ... 
         0.0002640049,   0.0003352298,   0.0002766326,   0.0001091463, ... 
        -0.0001034636,  -0.0002788539,  -0.0003479779,  -0.0002822494, ... 
        -0.0001053152,   0.0001153936,   0.0002943370,   0.0003610024, ... 
         0.0002876705,   0.0001008862,  -0.0001280938,  -0.0003104616, ... 
        -0.0003742848,  -0.0002928584,  -0.0000958175,   0.0001415942, ... 
         0.0003272341,   0.0003878050,   0.0002977742,   0.0000900662, ... 
        -0.0001559251,  -0.0003446599,  -0.0004015414,  -0.0003023773, ... 
        -0.0000835884,   0.0001711164,   0.0003627434,   0.0004154707, ... 
         0.0003066255,   0.0000763393,  -0.0001871982,  -0.0003814878, ... 
        -0.0004295679,  -0.0003104750,  -0.0000682733,   0.0002042001, ... 
         0.0004008952,   0.0004438061,   0.0003138803,   0.0000593435, ... 
        -0.0002221519,  -0.0004209663,  -0.0004581566,  -0.0003167938, ... 
        -0.0000495022,   0.0002410829,   0.0004417006,   0.0004725887, ... 
         0.0003191666,   0.0000387008,  -0.0002610225,  -0.0004630961, ... 
        -0.0004870697,  -0.0003209473,  -0.0000268895,   0.0002819994, ... 
         0.0004851493,   0.0005015647,   0.0003220831,   0.0000140176, ... 
        -0.0003040423,  -0.0005078554,  -0.0005160367,  -0.0003225190, ... 
        -0.0000000333,   0.0003271796,   0.0005312079,   0.0005304467, ... 
         0.0003221978,  -0.0000151163,  -0.0003514393,  -0.0005551987, ... 
        -0.0005447529,  -0.0003210604,   0.0000314852,   0.0003768491, ... 
         0.0005798181,   0.0005589118,   0.0003190456,  -0.0000491286, ... 
        -0.0004034364,  -0.0006050548,  -0.0005728769,  -0.0003160897, ... 
         0.0000681027,   0.0004312284,   0.0006308957,   0.0005865997, ... 
         0.0003121268,  -0.0000884654,  -0.0004602520,  -0.0006573261, ... 
        -0.0006000289,  -0.0003070886,   0.0001102757,   0.0004905339, ... 
         0.0006843295,   0.0006131105,   0.0003009043,  -0.0001335941, ... 
        -0.0005221007,  -0.0007118876,  -0.0006257881,  -0.0002935003, ... 
         0.0001584829,   0.0005549790,   0.0007399807,   0.0006380023, ... 
         0.0002848004,  -0.0001850059,  -0.0005891953,  -0.0007685869, ... 
        -0.0006496908,  -0.0002747251,   0.0002132290,   0.0006247763, ... 
         0.0007976828,   0.0006607883,   0.0002631920,  -0.0002432204, ... 
        -0.0006617490,  -0.0008272434,  -0.0006712265,  -0.0002501152, ... 
         0.0002750504,   0.0007001409,   0.0008572417,   0.0006809336, ... 
         0.0002354051,  -0.0003087922,  -0.0007399802,  -0.0008876493, ... 
        -0.0006898344,  -0.0002189681,   0.0003445219,   0.0007812958, ... 
         0.0009184359,   0.0006978503,   0.0002007063,  -0.0003823192, ... 
        -0.0008241179,  -0.0009495698,  -0.0007048984,  -0.0001805171, ... 
         0.0004222674,   0.0008684782,   0.0009810175,   0.0007108918, ... 
         0.0001582923,  -0.0004644545,  -0.0009144103,  -0.0010127442, ... 
        -0.0007157394,  -0.0001339184,   0.0005089733,   0.0009619498, ... 
         0.0010447134,   0.0007193448,   0.0001072751,  -0.0005559225, ... 
        -0.0010111352,  -0.0010768874,  -0.0007216068,  -0.0000782348, ... 
         0.0006054071,   0.0010620084,   0.0011092269,   0.0007224182, ... 
         0.0000466620,  -0.0006575399,  -0.0011146152,  -0.0011416916, ... 
        -0.0007216655,  -0.0000124119,   0.0007124421,   0.0011690061, ... 
         0.0011742398,   0.0007192284,  -0.0000246707,  -0.0007702449, ... 
        -0.0012252373,  -0.0012068286,  -0.0007149785,   0.0000647527, ... 
         0.0008310911,   0.0012833714,   0.0012394142,   0.0007087789, ... 
        -0.0001080146,  -0.0008951366,  -0.0013434790,  -0.0012719518, ... 
        -0.0007004828,   0.0001546522,   0.0009625524,   0.0014056398, ... 
         0.0013043958,   0.0006899322,  -0.0002048790,  -0.0010335275, ... 
        -0.0014699445,  -0.0013366998,  -0.0006769563,   0.0002589292, ... 
         0.0011082714,   0.0015364961,   0.0013688165,   0.0006613699, ... 
        -0.0003170602,  -0.0011870176,  -0.0016054130,  -0.0014006985, ... 
        -0.0006429708,   0.0003795572,   0.0012700276,   0.0016768308, ... 
         0.0014322976,   0.0006215375,  -0.0004467375,  -0.0013575958, ... 
        -0.0017509062,  -0.0014635654,  -0.0005968257,   0.0005189558, ... 
         0.0014500554,   0.0018278201,   0.0014944532,   0.0005685645, ... 
        -0.0005966111,  -0.0015477849,  -0.0019077828,  -0.0015249125, ... 
        -0.0005364518,   0.0006801547,   0.0016512170,   0.0019910389, ... 
         0.0015548944,   0.0005001486,  -0.0007701000,  -0.0017608488, ... 
        -0.0020778746,  -0.0015843503,  -0.0004592716,   0.0008670342, ... 
         0.0018772543,   0.0021686251,   0.0016132322,   0.0004133847, ... 
        -0.0009716339,  -0.0020011002,  -0.0022636858,  -0.0016414919, ... 
        -0.0003619884,   0.0010846831,   0.0021331651,   0.0023635240, ... 
         0.0016690822,   0.0003045055,  -0.0012070964,  -0.0022743641, ... 
        -0.0024686954,  -0.0016959564,  -0.0002402644,   0.0013399488, ... 
         0.0024257799,   0.0025798639,   0.0017220685,   0.0001684767, ... 
        -0.0014845131,  -0.0025887021,  -0.0026978280,  -0.0017473733, ... 
        -0.0000882091,   0.0016423087,   0.0027646790,   0.0028235535, ... 
         0.0017718269,  -0.0000016543,  -0.0018151647,  -0.0029555843, ... 
        -0.0029582183,  -0.0017953864,   0.0001024600,   0.0020053044, ... 
         0.0031637062,   0.0031032698,   0.0018180100,  -0.0002158516, ... 
        -0.0022154575,  -0.0033918675,  -0.0032605048,  -0.0018396574, ... 
         0.0003438580,   0.0024490137,   0.0036435885,   0.0034321763, ... 
         0.0018602899,  -0.0004890164,  -0.0027102348,  -0.0039233146, ... 
        -0.0036211444,  -0.0018798700,   0.0006545448,   0.0030045544, ... 
         0.0042367379,   0.0038310897,   0.0018983624,  -0.0008445891, ... 
        -0.0033390096,  -0.0045912628,  -0.0040668248,  -0.0019157331, ... 
         0.0010645872,   0.0037228779,   0.0049966974,   0.0043347574, ... 
         0.0019319504,  -0.0013218169,  -0.0041686445,  -0.0054663081, ... 
        -0.0046436028,  -0.0019469843,   0.0016262491,   0.0046935160, ... 
         0.0060184828,   0.0050055148,   0.0019608069,  -0.0019919228, ... 
        -0.0053218806,  -0.0066794555,  -0.0054379541,  -0.0019733926, ... 
         0.0024392588,   0.0060894853,   0.0074879779,   0.0059669240, ... 
         0.0019847178,  -0.0029991511,  -0.0070509093,  -0.0085037771, ... 
        -0.0066329017,  -0.0019947614,   0.0037206704,   0.0082938330, ... 
         0.0098239428,   0.0075025104,   0.0020035045,  -0.0046867360, ... 
        -0.0099685937,  -0.0116175240,  -0.0086936588,  -0.0020109307, ... 
         0.0060493767,   0.0123562939,   0.0142072999,   0.0104365930, ... 
         0.0020170259,  -0.0081206682,  -0.0160504204,  -0.0182958550, ... 
        -0.0132494220,  -0.0020217786,   0.0116585353,   0.0225575875, ... 
         0.0257568392,   0.0185923480,   0.0020251798,  -0.0191052286, ... 
        -0.0371510649,  -0.0438173442,  -0.0327930475,  -0.0020272231, ... 
         0.0451143749,   0.1002595802,   0.1519759223,   0.1887334852, ... 
         0.2020279047 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM.ok"; fail; fi


#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM.ok selesnickFIRsymmetric_lowpass_alternate_test_hM_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMa.ok"; fail; fi

#
# this much worked
#
pass

