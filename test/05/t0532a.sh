#!/bin/sh

prog=selesnickFIRsymmetric_lowpass_alternate_test.m

depends="selesnickFIRsymmetric_lowpass_alternate_test.m test_common.m \
selesnickFIRsymmetric_lowpass.m lagrange_interp.m print_polynomial.m \
local_max.m local_peak.m xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM.ok << 'EOF'
hM = [  -0.0001467140,   0.0004837051,   0.0002040723,   0.0001333344, ... 
         0.0001151275,   0.0001074532,   0.0000989281,   0.0000864814, ... 
         0.0000694262,   0.0000478856,   0.0000223742,  -0.0000063223, ... 
        -0.0000371961,  -0.0000690554,  -0.0001005672,  -0.0001303082, ... 
        -0.0001568237,  -0.0001786910,  -0.0001945867,  -0.0002033539, ... 
        -0.0002040667,  -0.0001960887,  -0.0001791218,  -0.0001532440, ... 
        -0.0001189318,  -0.0000770668,  -0.0000289243,   0.0000238569, ... 
         0.0000793227,   0.0001352684,   0.0001893206,   0.0002390298, ... 
         0.0002819736,   0.0003158648,   0.0003386603,   0.0003486656, ... 
         0.0003446311,   0.0003258339,   0.0002921421,   0.0002440561, ... 
         0.0001827259,   0.0001099397,   0.0000280851,  -0.0000599190, ... 
        -0.0001507172,  -0.0002406364,  -0.0003258262,  -0.0004024138, ... 
        -0.0004666694,  -0.0005151742,  -0.0005449844,  -0.0005537839, ... 
        -0.0005400178,  -0.0005030011,  -0.0004429950,  -0.0003612477, ... 
        -0.0002599939,  -0.0001424131,  -0.0000125443,   0.0001248398, ... 
         0.0002643968,   0.0004004113,   0.0005270175,   0.0006384396, ... 
         0.0007292408,   0.0007945701,   0.0008303964,   0.0008337206, ... 
         0.0008027529,   0.0007370487,   0.0006375942,   0.0005068353, ... 
         0.0003486464,   0.0001682375,  -0.0000279994,  -0.0002327012, ... 
        -0.0004377955,  -0.0006348043,  -0.0008151796,  -0.0009706571, ... 
        -0.0010936150,  -0.0011774220,  -0.0012167604,  -0.0012079090, ... 
        -0.0011489721,  -0.0010400422,  -0.0008832882,  -0.0006829601, ... 
        -0.0004453070,  -0.0001784092,   0.0001080753,   0.0004032390, ... 
         0.0006953215,   0.0009721585,   0.0012216669,   0.0014323486, ... 
         0.0015937919,   0.0016971498,   0.0017355746,   0.0017045884, ... 
         0.0016023720,   0.0014299566,   0.0011913058,   0.0008932804, ... 
         0.0005454822,   0.0001599783,  -0.0002490878,  -0.0006659870, ... 
        -0.0010739823,  -0.0014559713,  -0.0017951717,  -0.0020758229, ... 
        -0.0022838753,  -0.0024076386,  -0.0024383616,  -0.0023707162, ... 
        -0.0022031616,  -0.0019381708,  -0.0015823012,  -0.0011461039, ... 
        -0.0006438651,  -0.0000931855,   0.0004855926,   0.0010700936, ... 
         0.0016367301,   0.0021616068,   0.0026214762,   0.0029947084, ... 
         0.0032622368,   0.0034084407,   0.0034219265,   0.0032961727, ... 
         0.0030300068,   0.0026278879,   0.0020999755,   0.0014619744, ... 
         0.0007347502,  -0.0000562772,  -0.0008819472,  -0.0017103574, ... 
        -0.0025080140,  -0.0032410963,  -0.0038767898,  -0.0043846383, ... 
        -0.0047378634,  -0.0049145985,  -0.0048989850,  -0.0046820836, ... 
        -0.0042625558,  -0.0036470820,  -0.0028504856,  -0.0018955497, ... 
        -0.0008125162,   0.0003617234,   0.0015847315,   0.0028098904, ... 
         0.0039879927,   0.0050690048,   0.0060039464,   0.0067468210, ... 
         0.0072565280,   0.0074986867,   0.0074473017,   0.0070862017, ... 
         0.0064101938,   0.0054258768,   0.0041520743,   0.0026198557, ... 
         0.0008721284,  -0.0010371989,  -0.0030444712,  -0.0050779300, ... 
        -0.0070597022,  -0.0089080794,  -0.0105400189,  -0.0118737906, ... 
        -0.0128316833,  -0.0133426841,  -0.0133450386,  -0.0127886047, ... 
        -0.0116369171,  -0.0098688842,  -0.0074800562,  -0.0044834082, ... 
        -0.0009096040,   0.0031932809,   0.0077605802,   0.0127123872, ... 
         0.0179554007,   0.0233852189,   0.0288890149,   0.0343485173, ... 
         0.0396432060,   0.0446536254,   0.0492647158,   0.0533690556, ... 
         0.0568699169,   0.0596840353,   0.0617440075,   0.0630002402, ... 
         0.0634223890 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM.ok"; fail; fi


#
# run and see if the results match
#
echo "Running $prog" 

octave-cli -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM.ok selesnickFIRsymmetric_lowpass_alternate_test_hM_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hMa.ok"; fail; fi

#
# this much worked
#
pass

