#!/bin/sh

prog=mcclellanFIRsymmetric_lowpass_alternate_test.m

depends="test/mcclellanFIRsymmetric_lowpass_alternate_test.m test_common.m \
print_polynomial.m mcclellanFIRsymmetric.m local_max.m lagrange_interp.m \
xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM.ok << 'EOF'
hM = [   0.0005309612,   0.0000209852,   0.0000048829,  -0.0000222511, ... 
        -0.0000606833,  -0.0001104935,  -0.0001714034,  -0.0002426690, ... 
        -0.0003230522,  -0.0004108532,  -0.0005039719,  -0.0005999688, ... 
        -0.0006961145,  -0.0007894348,  -0.0008767698,  -0.0009548628, ... 
        -0.0010204818,  -0.0010705621,  -0.0011023535,  -0.0011135550, ... 
        -0.0011024286,  -0.0010678922,  -0.0010095945,  -0.0009279730, ... 
        -0.0008242929,  -0.0007006566,  -0.0005599794,  -0.0004059270, ... 
        -0.0002428166,  -0.0000754869,   0.0000908554,   0.0002508100, ... 
         0.0003989732,   0.0005301402,   0.0006395142,   0.0007229107, ... 
         0.0007769487,   0.0007992152,   0.0007883970,   0.0007443735, ... 
         0.0006682670,   0.0005624482,   0.0004304939,   0.0002770957, ... 
         0.0001079185,  -0.0000705861,  -0.0002514065,  -0.0004272294, ... 
        -0.0005907182,  -0.0007348037,  -0.0008529749,  -0.0009395609, ... 
        -0.0009899899,  -0.0010010149,  -0.0009708928,  -0.0008995086, ... 
        -0.0007884353,  -0.0006409277,  -0.0004618469,  -0.0002575178, ... 
        -0.0000355210,   0.0001955739,   0.0004265263,   0.0006477819, ... 
         0.0008498560,   0.0010237269,   0.0011612237,   0.0012553926, ... 
         0.0013008270,   0.0012939459,   0.0012332075,   0.0011192469, ... 
         0.0009549266,   0.0007452975,   0.0004974663,   0.0002203724, ... 
        -0.0000755174,  -0.0003785894,  -0.0006765243,  -0.0009567835, ... 
        -0.0012071223,  -0.0014161093,  -0.0015736293,  -0.0016713499, ... 
        -0.0017031289,  -0.0016653456,  -0.0015571393,  -0.0013805420, ... 
        -0.0011404958,  -0.0008447506,  -0.0005036400,  -0.0001297437, ... 
         0.0002625573,   0.0006576140,   0.0010391149,   0.0013907392, ... 
         0.0016968342,   0.0019430879,   0.0021171708,   0.0022093174, ... 
         0.0022128215,   0.0021244216,   0.0019445568,   0.0016774790, ... 
         0.0013312100,   0.0009173426,   0.0004506862,  -0.0000512331, ... 
        -0.0005688030,  -0.0010810640,  -0.0015665296,  -0.0020040580, ... 
        -0.0023737389,  -0.0026577617,  -0.0028412275,  -0.0029128694, ... 
        -0.0028656498,  -0.0026972029,  -0.0024101019,  -0.0020119307, ... 
        -0.0015151531,  -0.0009367756,  -0.0002978131,   0.0003774310, ... 
         0.0010622439,   0.0017285154,   0.0023478422,   0.0028926873, ... 
         0.0033375441,   0.0036600622,   0.0038420851,   0.0038705557, ... 
         0.0037382482,   0.0034442893,   0.0029944415,   0.0024011265, ... 
         0.0016831790,   0.0008653306,  -0.0000225650,  -0.0009465439, ... 
        -0.0018697500,  -0.0027538171,  -0.0035603663,  -0.0042525644, ... 
        -0.0047966825,  -0.0051635936,  -0.0053301465,  -0.0052803578, ... 
        -0.0050063681,  -0.0045091152,  -0.0037986867,  -0.0028943272, ... 
        -0.0018240837,  -0.0006240906,   0.0006624936,   0.0019868701, ... 
         0.0032962644,   0.0045358179,   0.0056506459,   0.0065879883, ... 
         0.0072993782,   0.0077427463,   0.0078843817,   0.0077006686, ... 
         0.0071795297,   0.0063215084,   0.0051404401,   0.0036636711, ... 
         0.0019318022,  -0.0000020532,  -0.0020734849,  -0.0042084511, ... 
        -0.0063253491,  -0.0083374317,  -0.0101554984,  -0.0116907741, ... 
        -0.0128578853,  -0.0135778314,  -0.0137808530,  -0.0134090944, ... 
        -0.0124189663,  -0.0107831208,  -0.0084919617,  -0.0055546306, ... 
        -0.0019994218,   0.0021263997,   0.0067573837,   0.0118112713, ... 
         0.0171909285,   0.0227867846,   0.0284797054,   0.0341442146, ... 
         0.0396519664,   0.0448753600,   0.0496911839,   0.0539841734, ... 
         0.0576503682,   0.0606001620,   0.0627609453,   0.0640792555, ... 
         0.0645223650 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM.ok mcclellanFIRsymmetric_lowpass_alternate_test_hM_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM.ok"; fail; fi

#
# this much worked
#
pass

