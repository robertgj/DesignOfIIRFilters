#!/bin/sh

prog=mcclellanFIRsymmetric_lowpass_alternate_test.m

depends="mcclellanFIRsymmetric_lowpass_alternate_test.m test_common.m \
print_polynomial.m mcclellanFIRsymmetric.m local_max.m lagrange_interp.m \
xfr2tf.m directFIRsymmetricA.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM.ok << 'EOF'
hM = [   0.0002387704,  -0.0001917750,  -0.0001959836,  -0.0002328404, ... 
        -0.0002911423,  -0.0003645557,  -0.0004493211,  -0.0005419965, ... 
        -0.0006408942,  -0.0007422060,  -0.0008439277,  -0.0009431369, ... 
        -0.0010362261,  -0.0011200335,  -0.0011913901,  -0.0012475412, ... 
        -0.0012853318,  -0.0013024153,  -0.0012968063,  -0.0012669692, ... 
        -0.0012123229,  -0.0011328693,  -0.0010294767,  -0.0009036654, ... 
        -0.0007580435,  -0.0005959557,  -0.0004213135,  -0.0002387880, ... 
        -0.0000534373,   0.0001292777,   0.0003038123,   0.0004645853, ... 
         0.0006063200,   0.0007242607,   0.0008141505,   0.0008726341, ... 
         0.0008973276,   0.0008870023,   0.0008415906,   0.0007622865, ... 
         0.0006515869,   0.0005131260,   0.0003517442,   0.0001732459, ... 
        -0.0000157771,  -0.0002081745,  -0.0003964585,  -0.0005730554, ... 
        -0.0007307024,  -0.0008626264,  -0.0009628910,  -0.0010266392, ... 
        -0.0010503011,  -0.0010317930,  -0.0009706349,  -0.0008680843, ... 
        -0.0007270438,  -0.0005520559,  -0.0003491841,  -0.0001257966, ... 
         0.0001096657,   0.0003480217,   0.0005796533,   0.0007949370, ... 
         0.0009845817,   0.0011400169,   0.0012538056,   0.0013199543, ... 
         0.0013342195,   0.0012943073,   0.0012000771,   0.0010535921, ... 
         0.0008591090,   0.0006230078,   0.0003535629,   0.0000606925, ... 
        -0.0002444022,  -0.0005496243,  -0.0008424723,  -0.0011105441, ... 
        -0.0013420149,  -0.0015261728,  -0.0016538724,  -0.0017179761, ... 
        -0.0017137065,  -0.0016389348,  -0.0014943566,  -0.0012835325, ... 
        -0.0010128779,  -0.0006914787,  -0.0003308151,   0.0000556347, ... 
         0.0004528748,   0.0008449488,   0.0012155801,   0.0015487987, ... 
         0.0018296316,   0.0020447486,   0.0021830587,   0.0022362411, ... 
         0.0021991786,   0.0020702968,   0.0018517266,   0.0015493617, ... 
         0.0011727416,   0.0007347796,   0.0002513608,  -0.0002592100, ... 
        -0.0007768644,  -0.0012805543,  -0.0017490616,  -0.0021618617, ... 
        -0.0024999971,  -0.0027469004,  -0.0028891661,  -0.0029172020, ... 
        -0.0028257694,  -0.0026143371,  -0.0022872760,  -0.0018538681, ... 
        -0.0013280899,  -0.0007282170,  -0.0000762259,   0.0006029571, ... 
         0.0012823735,   0.0019340561,   0.0025301242,   0.0030439386, ... 
         0.0034512205,   0.0037311307,   0.0038672424,   0.0038483841, ... 
         0.0036692931,   0.0033310455,   0.0028412687,   0.0022140765, ... 
         0.0014697565,   0.0006341916,  -0.0002619637,  -0.0011843339, ... 
        -0.0020960660,  -0.0029592002,  -0.0037361634,  -0.0043912934, ... 
        -0.0048923531,  -0.0052119665,  -0.0053289201,  -0.0052292788, ... 
        -0.0049072485,  -0.0043657745,  -0.0036168063,  -0.0026812220, ... 
        -0.0015884051,  -0.0003754725,   0.0009138271,   0.0022305318, ... 
         0.0035221321,   0.0047344599,   0.0058137193,   0.0067085891, ... 
         0.0073723352,   0.0077648431,   0.0078545043,   0.0076198573, ... 
         0.0070509438,   0.0061503043,   0.0049335623,   0.0034295728, ... 
         0.0016800977,  -0.0002609832,  -0.0023289276,  -0.0044498052, ... 
        -0.0065425628,  -0.0085214260,  -0.0102985467,  -0.0117868300, ... 
        -0.0129028364,  -0.0135696773,  -0.0137197920,  -0.0132975208, ... 
        -0.0122613802,  -0.0105859422,  -0.0082632678,  -0.0053038218, ... 
        -0.0017368364,   0.0023899139,   0.0070109212,   0.0120443210, ... 
         0.0173938149,   0.0229510697,   0.0285985400,   0.0342126253, ... 
         0.0396670666,   0.0448364730,   0.0495998689,   0.0538441651, ... 
         0.0574674214,   0.0603818149,   0.0625162071,   0.0638182318, ... 
         0.0642558376 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM.ok mcclellanFIRsymmetric_lowpass_alternate_test_hM_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM.ok"; fail; fi

#
# this much worked
#
pass

