#!/bin/sh

prog=directFIRnonsymmetric_kyp_lowpass_alternate_test.m

depends="test/directFIRnonsymmetric_kyp_lowpass_alternate_test.m test_common.m \
directFIRnonsymmetricEsqPW.m print_polynomial.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_h01_coef.ok << 'EOF'
h01 = [ -0.0008739628,  0.0164442967,  0.0341368296,  0.0365351166, ... 
         0.0084233754, -0.0378224961, -0.0579627953, -0.0056519543, ... 
         0.1223672254,  0.2670300828,  0.3399958593,  0.2893246897, ... 
         0.1434323887, -0.0075528889, -0.0800716260, -0.0574366632, ... 
         0.0079436071,  0.0474642917,  0.0335721892, -0.0077203383, ... 
        -0.0322780202, -0.0213933925,  0.0069364396,  0.0226280730, ... 
         0.0139426422, -0.0057591371, -0.0160689036, -0.0099024981, ... 
         0.0033706187,  0.0105515144,  0.0110751172 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h01_coef.m "; fail; fi

cat > test_h02_coef.ok << 'EOF'
h02 = [ -0.0081109979,  0.0056262060,  0.0148839647,  0.0099514914, ... 
        -0.0083676863, -0.0223465547, -0.0123727376,  0.0182101573, ... 
         0.0376796675,  0.0148268657, -0.0408119037, -0.0715975274, ... 
        -0.0164807051,  0.1266981637,  0.2828269842,  0.3505161870, ... 
         0.2828269842,  0.1266981637, -0.0164807051, -0.0715975274, ... 
        -0.0408119037,  0.0148268657,  0.0376796675,  0.0182101573, ... 
        -0.0123727376, -0.0223465547, -0.0083676863,  0.0099514914, ... 
         0.0148839647,  0.0056262060, -0.0081109979 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h02_coef.m "; fail; fi

cat > test_h03_coef.ok << 'EOF'
h03 = [ -0.0008215530,  0.0164643025,  0.0341594420,  0.0365250252, ... 
         0.0083893825, -0.0378567982, -0.0579781190, -0.0056479828, ... 
         0.1223748514,  0.2670273343,  0.3399843249,  0.2893175095, ... 
         0.1434384098, -0.0075397920, -0.0800657074, -0.0574446099, ... 
         0.0079300540,  0.0474593959,  0.0335809710, -0.0077071873, ... 
        -0.0322738858, -0.0214020993,  0.0069241797,  0.0226243908, ... 
         0.0139505928, -0.0057477014, -0.0160646589, -0.0099096543, ... 
         0.0033525169,  0.0105461491,  0.0110625553 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h03_coef.m "; fail; fi

cat > test_h04_coef.ok << 'EOF'
h04 = [ -0.0008260238,  0.0164580343,  0.0341535848,  0.0365227628, ... 
         0.0083929058, -0.0378501644, -0.0579735145, -0.0056486859, ... 
         0.1223702374,  0.2670233360,  0.3399842015,  0.2893203276, ... 
         0.1434403969, -0.0075411088, -0.0800689434, -0.0574461855, ... 
         0.0079319232,  0.0474627052,  0.0335820950, -0.0077095994, ... 
        -0.0322774016, -0.0214029178,  0.0069274431,  0.0226293986, ... 
         0.0139535280, -0.0057488408, -0.0160687177, -0.0099137685, ... 
         0.0033508308,  0.0105458400,  0.0110629597 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h04_coef.m "; fail; fi

cat > test_h05_coef.ok << 'EOF'
h05 = [ -0.0012458538,  0.0159909717,  0.0333999150,  0.0356808155, ... 
         0.0075308834, -0.0387801027, -0.0591093605, -0.0071094231, ... 
         0.1206044560,  0.2651447729,  0.3382692277,  0.2879879755, ... 
         0.1425348630, -0.0081463807, -0.0805881737, -0.0580741872, ... 
         0.0070842731,  0.0463806897,  0.0323374748, -0.0089706299, ... 
        -0.0333627885, -0.0221368882,  0.0066004795,  0.0225906230, ... 
         0.0139439166, -0.0059907105, -0.0166523915, -0.0107338295, ... 
         0.0025475787,  0.0099755138,  0.0106960134 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h05_coef.m "; fail; fi

cat > test_h06_coef.ok << 'EOF'
h06 = [ -0.0015539353, -0.0004667959,  0.0015964705,  0.0025840695, ... 
         0.0005734787, -0.0031271187, -0.0042173216, -0.0000962734, ... 
         0.0058077724,  0.0063032412, -0.0012918466, -0.0099172900, ... 
        -0.0086722908,  0.0042024300,  0.0159755787,  0.0111148836, ... 
        -0.0096693331, -0.0250412281, -0.0133859190,  0.0199438225, ... 
         0.0400204224,  0.0152345968, -0.0423095760, -0.0729498987, ... 
        -0.0164387468,  0.1274485942,  0.2830471522,  0.3502012388, ... 
         0.2830471522,  0.1274485942, -0.0164387468, -0.0729498987, ... 
        -0.0423095760,  0.0152345968,  0.0400204224,  0.0199438225, ... 
        -0.0133859190, -0.0250412281, -0.0096693331,  0.0111148836, ... 
         0.0159755787,  0.0042024300, -0.0086722908, -0.0099172900, ... 
        -0.0012918466,  0.0063032412,  0.0058077724, -0.0000962734, ... 
        -0.0042173216, -0.0031271187,  0.0005734787,  0.0025840695, ... 
         0.0015964705, -0.0004667959, -0.0015539353 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h06_coef.m "; fail; fi

cat > test_h07_coef.ok << 'EOF'
h07 = [ -0.0051265313,  0.0016175207,  0.0105220239,  0.0112679910, ... 
        -0.0056422871, -0.0322886343, -0.0380874608,  0.0111538320, ... 
         0.1199641303,  0.2452471980,  0.3165455314,  0.2850384884, ... 
         0.1633588229,  0.0200527299, -0.0687887151, -0.0723904689, ... 
        -0.0200215485,  0.0308004929,  0.0417345318,  0.0166222328, ... 
        -0.0135490592, -0.0232108864, -0.0113637415,  0.0051353073, ... 
         0.0113227114,  0.0060895695, -0.0017159899, -0.0045556380, ... 
        -0.0022752894,  0.0007317537,  0.0013737685 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h07_coef.m "; fail; fi

cat > test_h08_coef.ok << 'EOF'
h08 = [  0.0015298144,  0.0036852025,  0.0032819780, -0.0039739136, ... 
        -0.0178626165, -0.0281001615, -0.0156400310,  0.0357832502, ... 
         0.1235878656,  0.2187063078,  0.2764647977,  0.2626253455, ... 
         0.1775731484,  0.0596506350, -0.0368554082, -0.0745812011, ... 
        -0.0535143009, -0.0054099826,  0.0314692903,  0.0372491560, ... 
         0.0179319000, -0.0060962213, -0.0180140884, -0.0146904996, ... 
        -0.0040643374,  0.0043087496,  0.0063819575,  0.0040390281, ... 
         0.0010934124, -0.0003145337, -0.0003510778 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h08_coef.m "; fail; fi

cat > test_h09_coef.ok << 'EOF'
h09 = [  0.0008656017,  0.0021695748,  0.0015407800, -0.0044624090, ... 
        -0.0158159409, -0.0238562670, -0.0115292667,  0.0369401243, ... 
         0.1209482639,  0.2146855170,  0.2753126854,  0.2671185373, ... 
         0.1864135902,  0.0680201085, -0.0338773347, -0.0783794347, ... 
        -0.0609996035, -0.0114352397,  0.0303912606,  0.0408363977, ... 
         0.0229708721, -0.0030361564, -0.0182942027, -0.0172429045, ... 
        -0.0067425014,  0.0030663057,  0.0067935868,  0.0053369554, ... 
         0.0023611112,  0.0004447108, -0.0000797844 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h09_coef.m "; fail; fi

#
# run and see if the results match
#

echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

name_str=directFIRnonsymmetric_kyp_lowpass_alternate_test

diff -Bb test_h01_coef.ok $name_str"_h01_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h01_coef.m"; fail; fi

diff -Bb test_h02_coef.ok $name_str"_h02_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h02_coef.m"; fail; fi

diff -Bb test_h03_coef.ok $name_str"_h03_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h03_coef.m"; fail; fi

diff -Bb test_h04_coef.ok $name_str"_h04_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h04_coef.m"; fail; fi

diff -Bb test_h05_coef.ok $name_str"_h05_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h05_coef.m"; fail; fi

diff -Bb test_h06_coef.ok $name_str"_h06_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h06_coef.m"; fail; fi

diff -Bb test_h07_coef.ok $name_str"_h07_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h07_coef.m"; fail; fi

diff -Bb test_h08_coef.ok $name_str"_h08_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h08_coef.m"; fail; fi

diff -Bb test_h09_coef.ok $name_str"_h09_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h09_coef.m"; fail; fi

#
# this much worked
#
pass

