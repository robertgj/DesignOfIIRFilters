#!/bin/sh

prog=directFIRnonsymmetric_kyp_lowpass_alternate_test.m

depends="test/directFIRnonsymmetric_kyp_lowpass_alternate_test.m test_common.m \
directFIRnonsymmetricEsqPW.m print_polynomial.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_h01_coef.ok << 'EOF'
h01 = [ -0.0008739276,  0.0164442882,  0.0341367694,  0.0365350349, ... 
         0.0084233139, -0.0378225020, -0.0579627433, -0.0056518581, ... 
         0.1223673481,  0.2670302513,  0.3399960650,  0.2893249030, ... 
         0.1434325420, -0.0075528416, -0.0800716777, -0.0574367175, ... 
         0.0079436085,  0.0474643687,  0.0335722577, -0.0077203498, ... 
        -0.0322781337, -0.0213935677,  0.0069362515,  0.0226279113, ... 
         0.0139424991, -0.0057592565, -0.0160689810, -0.0099025093, ... 
         0.0033706727,  0.0105515982,  0.0110751954 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h01_coef.m "; fail; fi

cat > test_h02_coef.ok << 'EOF'
h02 = [ -0.0081109754,  0.0056262082,  0.0148839622,  0.0099514881, ... 
        -0.0083676876, -0.0223465518, -0.0123727306,  0.0182101735, ... 
         0.0376796729,  0.0148268749, -0.0408119028, -0.0715975296, ... 
        -0.0164807116,  0.1266981496,  0.2828269122,  0.3505161784, ... 
         0.2828269122,  0.1266981496, -0.0164807116, -0.0715975296, ... 
        -0.0408119028,  0.0148268749,  0.0376796729,  0.0182101735, ... 
        -0.0123727306, -0.0223465518, -0.0083676876,  0.0099514881, ... 
         0.0148839622,  0.0056262082, -0.0081109754 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h02_coef.m "; fail; fi

cat > test_h03_coef.ok << 'EOF'
h03 = [ -0.0008215116,  0.0164642885,  0.0341593977,  0.0365249674, ... 
         0.0083893454, -0.0378567823, -0.0579780586, -0.0056479140, ... 
         0.1223749149,  0.2670274148,  0.3399844279,  0.2893176406, ... 
         0.1434385195, -0.0075397664, -0.0800657374, -0.0574446578, ... 
         0.0079300614,  0.0474594430,  0.0335810259, -0.0077072006, ... 
        -0.0322739706, -0.0214022030,  0.0069240830,  0.0226243185, ... 
         0.0139505249, -0.0057477815, -0.0160647277, -0.0099096737, ... 
         0.0033525510,  0.0105462118,  0.0110626312 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h03_coef.m "; fail; fi

cat > test_h04_coef.ok << 'EOF'
h04 = [ -0.0008259953,  0.0164580318,  0.0341535436,  0.0365227071, ... 
         0.0083928646, -0.0378501720, -0.0579734923, -0.0056486541, ... 
         0.1223702547,  0.2670233681,  0.3399842513,  0.2893203976, ... 
         0.1434404520, -0.0075411061, -0.0800689896, -0.0574462285, ... 
         0.0079319208,  0.0474627529,  0.0335821450, -0.0077095928, ... 
        -0.0322774426, -0.0214029725,  0.0069273944,  0.0226293754, ... 
         0.0139535000, -0.0057488775, -0.0160687451, -0.0099137646, ... 
         0.0033508750,  0.0105459043,  0.0110630199 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h04_coef.m "; fail; fi

cat > test_h05_coef.ok << 'EOF'
h05 = [ -0.0012458547,  0.0159909705,  0.0333999194,  0.0356808199, ... 
         0.0075308847, -0.0387801052, -0.0591093665, -0.0071094284, ... 
         0.1206044480,  0.2651447610,  0.3382692109,  0.2879879527, ... 
         0.1425348401, -0.0081463913, -0.0805881773, -0.0580741892, ... 
         0.0070842729,  0.0463806884,  0.0323374737, -0.0089706188, ... 
        -0.0333627690, -0.0221368680,  0.0066004968,  0.0225906365, ... 
         0.0139439254, -0.0059907014, -0.0166523838, -0.0107338249, ... 
         0.0025475787,  0.0099755087,  0.0106960112 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h05_coef.m "; fail; fi

cat > test_h06_coef.ok << 'EOF'
h06 = [ -0.0015539562, -0.0004668071,  0.0015964619,  0.0025840708, ... 
         0.0005734872, -0.0031271152, -0.0042173303, -0.0000962864, ... 
         0.0058077705,  0.0063032549, -0.0012918298, -0.0099172888, ... 
        -0.0086723086,  0.0042024114,  0.0159755796,  0.0111149059, ... 
        -0.0096693134, -0.0250412322, -0.0133859467,  0.0199438016, ... 
         0.0400204266,  0.0152346243, -0.0423095598, -0.0729499116, ... 
        -0.0164387793,  0.1274485774,  0.2830471661,  0.3502012772, ... 
         0.2830471661,  0.1274485774, -0.0164387793, -0.0729499116, ... 
        -0.0423095598,  0.0152346243,  0.0400204266,  0.0199438016, ... 
        -0.0133859467, -0.0250412322, -0.0096693134,  0.0111149059, ... 
         0.0159755796,  0.0042024114, -0.0086723086, -0.0099172888, ... 
        -0.0012918298,  0.0063032549,  0.0058077705, -0.0000962864, ... 
        -0.0042173303, -0.0031271152,  0.0005734872,  0.0025840708, ... 
         0.0015964619, -0.0004668071, -0.0015539562 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h06_coef.m "; fail; fi

cat > test_h07_coef.ok << 'EOF'
h07 = [ -0.0051265318,  0.0016175374,  0.0105220234,  0.0112679728, ... 
        -0.0056423048, -0.0322886324, -0.0380874377,  0.0111538579, ... 
         0.1199641362,  0.2452471753,  0.3165454731,  0.2850384815, ... 
         0.1633588557,  0.0200527744, -0.0687886974, -0.0723904928, ... 
        -0.0200215922,  0.0308004679,  0.0417345456,  0.0166222697, ... 
        -0.0135490342, -0.0232108909, -0.0113637694,  0.0051352854, ... 
         0.0113227128,  0.0060895869, -0.0017159758, -0.0045556385, ... 
        -0.0022752992,  0.0007317470,  0.0013737745 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h07_coef.m "; fail; fi

cat > test_h08_coef.ok << 'EOF'
h08 = [  0.0015298285,  0.0036852360,  0.0032820150, -0.0039739087, ... 
        -0.0178626701, -0.0281002552, -0.0156400976,  0.0357832794, ... 
         0.1235879937,  0.2187064503,  0.2764648389,  0.2626252369, ... 
         0.1775729622,  0.0596505157, -0.0368553609, -0.0745810188, ... 
        -0.0535141223, -0.0054099398,  0.0314691774,  0.0372489866, ... 
         0.0179318030, -0.0060961904, -0.0180139774, -0.0146904037, ... 
        -0.0040643179,  0.0043087013,  0.0063818930,  0.0040389909, ... 
         0.0010934096, -0.0003145209, -0.0003510684 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h08_coef.m "; fail; fi

cat > test_h09_coef.ok << 'EOF'
h09 = [  0.0008656017,  0.0021695748,  0.0015407800, -0.0044624090, ... 
        -0.0158159409, -0.0238562670, -0.0115292667,  0.0369401243, ... 
         0.1209482639,  0.2146855170,  0.2753126854,  0.2671185373, ... 
         0.1864135902,  0.0680201085, -0.0338773347, -0.0783794347, ... 
        -0.0609996035, -0.0114352397,  0.0303912606,  0.0408363977, ... 
         0.0229708721, -0.0030361564, -0.0182942027, -0.0172429045, ... 
        -0.0067425014,  0.0030663057,  0.0067935868,  0.0053369554, ... 
         0.0023611112,  0.0004447108, -0.0000797844 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h09_coef.m "; fail; fi

#
# run and see if the results match
#
echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

name_str=directFIRnonsymmetric_kyp_lowpass_alternate_test

diff -Bb test_h01_coef.ok $name_str"_h01_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h01_coef.m"; fail; fi

diff -Bb test_h02_coef.ok $name_str"_h02_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h02_coef.m"; fail; fi

diff -Bb test_h03_coef.ok $name_str"_h03_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h03_coef.m"; fail; fi

diff -Bb test_h04_coef.ok $name_str"_h04_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h04_coef.m"; fail; fi

diff -Bb test_h05_coef.ok $name_str"_h05_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h05_coef.m"; fail; fi

diff -Bb test_h06_coef.ok $name_str"_h06_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h06_coef.m"; fail; fi

diff -Bb test_h07_coef.ok $name_str"_h07_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h07_coef.m"; fail; fi

diff -Bb test_h08_coef.ok $name_str"_h08_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h08_coef.m"; fail; fi

diff -Bb test_h09_coef.ok $name_str"_h09_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h09_coef.m"; fail; fi

#
# this much worked
#
pass

