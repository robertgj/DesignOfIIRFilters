#!/bin/sh

prog=directFIRnonsymmetric_kyp_lowpass_alternate_test.m

depends="directFIRnonsymmetric_kyp_lowpass_alternate_test.m test_common.m \
directFIRnonsymmetricEsqPW.m print_polynomial.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_h1_coef.ok << 'EOF'
h1 = [ -0.0102419102,  0.0047969839,  0.0219730699,  0.0284875298, ... 
        0.0061036518, -0.0371278397, -0.0583180654, -0.0083135579, ... 
        0.1198359604,  0.2675512556,  0.3433129251,  0.2919754204, ... 
        0.1425119129, -0.0111461827, -0.0825218419, -0.0561355246, ... 
        0.0115735696,  0.0495435737,  0.0319654716, -0.0111794998, ... 
       -0.0338893526, -0.0195790060,  0.0100940924,  0.0237485005, ... 
        0.0119500144, -0.0086465925, -0.0167373902, -0.0073513373, ... 
        0.0075019186,  0.0142428558,  0.0112348224 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h1_coef.m "; fail; fi

cat > test_h2_coef.ok << 'EOF'
h2 = [ -0.0090173422,  0.0082329377,  0.0260769876,  0.0325926853, ... 
        0.0089357679, -0.0359418343, -0.0580526344, -0.0080354672, ... 
        0.1203722782,  0.2678696588,  0.3429702471,  0.2912450079, ... 
        0.1421371193, -0.0107445647, -0.0817419632, -0.0557891434, ... 
        0.0111293044,  0.0487876776,  0.0316928354, -0.0107084572, ... 
       -0.0332001454, -0.0194051862,  0.0095721849,  0.0230925273, ... 
        0.0118715953, -0.0079646105, -0.0157412521, -0.0066450511, ... 
        0.0076385893,  0.0139244651,  0.0112196710 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h2_coef.m "; fail; fi

cat > test_h3_coef.ok << 'EOF'
h3 = [  0.0019422473,  0.0169524230,  0.0338934624,  0.0342175992, ... 
        0.0046832482, -0.0410868495, -0.0593334683, -0.0052838860, ... 
        0.1230962039,  0.2669299233,  0.3391358537,  0.2886911881, ... 
        0.1437818943, -0.0065918301, -0.0795635546, -0.0579582245, ... 
        0.0069279931,  0.0470246398,  0.0341561934, -0.0067570238, ... 
       -0.0319700761, -0.0220656132,  0.0060295098,  0.0225055416, ... 
        0.0148463971, -0.0046559855, -0.0159734731, -0.0113914083, ... 
        0.0008966412,  0.0088607303,  0.0088974309 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h3_coef.m "; fail; fi

cat > test_h4_coef.ok << 'EOF'
h4 = [ -0.0012458722,  0.0159909228,  0.0333998685,  0.0356807812, ... 
        0.0075308813, -0.0387800802, -0.0591093434, -0.0071094374, ... 
        0.1206044040,  0.2651447101,  0.3382691773,  0.2879879552, ... 
        0.1425348637, -0.0081463648, -0.0805881510, -0.0580741642, ... 
        0.0070842928,  0.0463806875,  0.0323374443, -0.0089706701, ... 
       -0.0333628136, -0.0221368705,  0.0066005335,  0.0225906913, ... 
        0.0139439644, -0.0059906948, -0.0166523991, -0.0107338419, ... 
        0.0025475691,  0.0099755209,  0.0106960077 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h4_coef.m "; fail; fi

cat > test_h5_coef.ok << 'EOF'
h5 = [ -0.0051265235,  0.0016175517,  0.0105220052,  0.0112679380, ... 
       -0.0056423188, -0.0322885996, -0.0380873809,  0.0111538843, ... 
        0.1199641001,  0.2452470999,  0.3165454133,  0.2850385288, ... 
        0.1633589549,  0.0200528450, -0.0687887200, -0.0723905929, ... 
       -0.0200216796,  0.0308004728,  0.0417346330,  0.0166223548, ... 
       -0.0135490245, -0.0232109517, -0.0113638388,  0.0051352674, ... 
        0.0113227508,  0.0060896349, -0.0017159612, -0.0045556594, ... 
       -0.0022753273,  0.0007317396,  0.0013737933 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h5_coef.m "; fail; fi

cat > test_h6_coef.ok << 'EOF'
h6 = [  0.0008656281,  0.0021696544,  0.0015409094, -0.0044622917, ... 
       -0.0158159316, -0.0238564167, -0.0115295105,  0.0369399475, ... 
        0.1209482871,  0.2146857085,  0.2753128363,  0.2671184150, ... 
        0.1864131493,  0.0680195698, -0.0338776291, -0.0783792857, ... 
       -0.0609991209, -0.0114347624,  0.0303914254,  0.0408361994, ... 
        0.0229705268, -0.0030363605, -0.0182941274, -0.0172426361, ... 
       -0.0067422453,  0.0030663947,  0.0067934959,  0.0053367805, ... 
        0.0023609590,  0.0004446292, -0.0000798085 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h6_coef.m "; fail; fi

cat > test_h7_coef.ok << 'EOF'
h7 = [ -0.0125137362,  0.0049013873,  0.0228209096,  0.0309501150, ... 
        0.0089140820, -0.0355944936, -0.0585190272, -0.0092347140, ... 
        0.1195839647,  0.2683225684,  0.3441580669,  0.2918202254, ... 
        0.1413826312, -0.0120972677, -0.0822923221, -0.0549956644, ... 
        0.0123613209,  0.0490991336,  0.0307399908, -0.0119188612, ... 
       -0.0334334688, -0.0185109738,  0.0105699691,  0.0231726940, ... 
        0.0111252849, -0.0084460306, -0.0149987340, -0.0047714284, ... 
        0.0096871244,  0.0152678616,  0.0112573909 ];
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_h7_coef.m "; fail; fi

#
# run and see if the results match
#
echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

name_str=directFIRnonsymmetric_kyp_lowpass_alternate_test

diff -Bb test_h1_coef.ok $name_str"_h1_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h1_coef.m"; fail; fi

diff -Bb test_h2_coef.ok $name_str"_h2_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h2_coef.m"; fail; fi

diff -Bb test_h3_coef.ok $name_str"_h3_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h3_coef.m"; fail; fi

diff -Bb test_h4_coef.ok $name_str"_h4_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h4_coef.m"; fail; fi

diff -Bb test_h5_coef.ok $name_str"_h5_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h5_coef.m"; fail; fi

diff -Bb test_h6_coef.ok $name_str"_h6_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h6_coef.m"; fail; fi

diff -Bb test_h7_coef.ok $name_str"_h7_coef.m"
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_h7_coef.m"; fail; fi

#
# this much worked
#
pass

