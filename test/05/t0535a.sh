#!/bin/sh

prog=directFIRsymmetric_sdp_lowpass_test.m

depends="test/directFIRsymmetric_sdp_lowpass_test.m test_common.m \
print_polynomial.m directFIRsymmetricA.m directFIRsymmetric_sdp_basis.m \
directFIRsymmetricEsqPW.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM031.ok << 'EOF'
hM031 = [   0.0006629227,   0.0002668058,   0.0000130035,  -0.0005190849, ... 
           -0.0012980648,  -0.0021933201,  -0.0029759632,  -0.0033528188, ... 
           -0.0030331615,  -0.0018176737,   0.0003105882,   0.0031194310, ... 
            0.0061109769,   0.0085736621,   0.0097066488,   0.0088019683, ... 
            0.0054514126,  -0.0002679447,  -0.0076793370,  -0.0155044588, ... 
           -0.0219957803,  -0.0251965861,  -0.0232919261,  -0.0149881128, ... 
            0.0001557504,   0.0215188846,   0.0473885186,   0.0751312364, ... 
            0.1015487855,   0.1233619005,   0.1377364588,   0.1427540179 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM031.ok"; fail; fi

cat > test_hM200.ok << 'EOF'
hM200 = [   0.0002492127,   0.0002288454,   0.0001153795,   0.0000151901, ... 
           -0.0000338239,  -0.0000453580,  -0.0000511694,  -0.0000732637, ... 
           -0.0001139690,  -0.0001623649,  -0.0002067070,  -0.0002424699, ... 
           -0.0002720521,  -0.0002992233,  -0.0003241943,  -0.0003429908, ... 
           -0.0003504994,  -0.0003438541,  -0.0003233827,  -0.0002909566, ... 
           -0.0002477393,  -0.0001934014,  -0.0001272065,  -0.0000497026, ... 
            0.0000365521,   0.0001277140,   0.0002200011,   0.0003104453, ... 
            0.0003965597,   0.0004754683,   0.0005434571,   0.0005964083, ... 
            0.0006307411,   0.0006440780,   0.0006351959,   0.0006035015, ... 
            0.0005486563,   0.0004707493,   0.0003708549,   0.0002514509, ... 
            0.0001163226,  -0.0000299510,  -0.0001824958,  -0.0003362795, ... 
           -0.0004859312,  -0.0006256024,  -0.0007491761,  -0.0008508056, ... 
           -0.0009254647,  -0.0009692109,  -0.0009791350,  -0.0009532497, ... 
           -0.0008905754,  -0.0007914524,  -0.0006578532,  -0.0004934414, ... 
           -0.0003033230,  -0.0000936750,   0.0001285139,   0.0003555223, ... 
            0.0005789428,   0.0007899049,   0.0009795356,   0.0011395169, ... 
            0.0012625231,   0.0013424448,   0.0013744902,   0.0013553410, ... 
            0.0012834383,   0.0011592992,   0.0009856822,   0.0007674996, ... 
            0.0005115467,   0.0002262106,  -0.0000787379,  -0.0003923173, ... 
           -0.0007026157,  -0.0009972678,  -0.0012640713,  -0.0014915841, ... 
           -0.0016695766,  -0.0017893487,  -0.0018440240,  -0.0018289106, ... 
           -0.0017418983,  -0.0015837534,  -0.0013581914,  -0.0010717240, ... 
           -0.0007333920,  -0.0003544985,   0.0000516460,   0.0004700612, ... 
            0.0008846154,   0.0012787242,   0.0016361097,   0.0019414814, ... 
            0.0021810863,   0.0023431925,   0.0024185959,   0.0024011608, ... 
            0.0022882948,   0.0020812204,   0.0017849861,   0.0014082813, ... 
            0.0009631693,   0.0004647965,  -0.0000689785,  -0.0006181392, ... 
           -0.0011612922,  -0.0016765917,  -0.0021426619,  -0.0025394113, ... 
           -0.0028487525,  -0.0030553154,  -0.0031471976,  -0.0031166850, ... 
           -0.0029607933,  -0.0026815178,  -0.0022858045,  -0.0017853516, ... 
           -0.0011963381,  -0.0005390652,   0.0001625980,   0.0008820534, ... 
            0.0015910601,   0.0022609161,   0.0028635762,   0.0033726631, ... 
            0.0037644466,   0.0040188761,   0.0041206373,   0.0040600726, ... 
            0.0038337896,   0.0034448987,   0.0029029770,   0.0022238973, ... 
            0.0014295620,   0.0005474295,  -0.0003903146,  -0.0013479758, ... 
           -0.0022878093,  -0.0031714938,  -0.0039614967,  -0.0046223837, ... 
           -0.0051222149,  -0.0054340624,  -0.0055374889,  -0.0054197185, ... 
           -0.0050763325,  -0.0045115493,  -0.0037382906,  -0.0027781611, ... 
           -0.0016612431,  -0.0004254554,   0.0008846825,   0.0022197725, ... 
            0.0035274221,   0.0047540258,   0.0058464433,   0.0067538159, ... 
            0.0074297033,   0.0078344232,   0.0079371774,   0.0077175815, ... 
            0.0071665501,   0.0062868543,   0.0050936873,   0.0036152187, ... 
            0.0018927091,  -0.0000202865,  -0.0020596787,  -0.0041530801, ... 
           -0.0062218994,  -0.0081830997,  -0.0099510608,  -0.0114401805, ... 
           -0.0125683653,  -0.0132607519,  -0.0134526565,  -0.0130912693, ... 
           -0.0121366286,  -0.0105629658,  -0.0083609854,  -0.0055403555, ... 
           -0.0021308241,   0.0018190919,   0.0062451798,   0.0110702634, ... 
            0.0162048218,   0.0215459563,   0.0269775256,   0.0323744615, ... 
            0.0376113760,   0.0425714283,   0.0471494802,   0.0512463753, ... 
            0.0547577755,   0.0575670599,   0.0595523097,   0.0606106026, ... 
            0.0616788614 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM200.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM031.ok directFIRsymmetric_sdp_lowpass_test_hM031_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM031.ok"; fail; fi

diff -Bb test_hM200.ok directFIRsymmetric_sdp_lowpass_test_hM200_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM200.ok"; fail; fi

#
# this much worked
#
pass

