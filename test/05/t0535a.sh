#!/bin/sh

prog=directFIRsymmetric_sdp_lowpass_test.m

depends="directFIRsymmetric_sdp_lowpass_test.m test_common.m \
print_polynomial.m directFIRsymmetricA.m directFIRsymmetric_sdp_basis.m \
directFIRsymmetricEsqPW.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM200.ok << 'EOF'
hM200 = [  -0.0000059841,  -0.0000287453,  -0.0000737360,  -0.0001378532, ... 
           -0.0002123581,  -0.0002865259,  -0.0003509877,  -0.0003999344, ... 
           -0.0004318196,  -0.0004486726,  -0.0004544878,  -0.0004533319, ... 
           -0.0004477724,  -0.0004380422,  -0.0004220784,  -0.0003963051, ... 
           -0.0003568377,  -0.0003007145,  -0.0002268094,  -0.0001362163, ... 
           -0.0000320750,   0.0000810346,   0.0001979028,   0.0003134552, ... 
            0.0004232779,   0.0005238113,   0.0006122335,   0.0006861500, ... 
            0.0007432480,   0.0007810677,   0.0007969860,   0.0007884303, ... 
            0.0007532638,   0.0006902329,   0.0005993516,   0.0004821254, ... 
            0.0003415633,   0.0001819915,   0.0000087286,  -0.0001722913, ... 
           -0.0003548610,  -0.0005327532,  -0.0006998677,  -0.0008502997, ... 
           -0.0009783795,  -0.0010787451,  -0.0011464893,  -0.0011773943, ... 
           -0.0011682342,  -0.0011170927,  -0.0010236375,  -0.0008892932, ... 
           -0.0007172788,  -0.0005125051,  -0.0002813556,  -0.0000313930, ... 
            0.0002289610,   0.0004907338,   0.0007446806,   0.0009815346, ... 
            0.0011922487,   0.0013682534,   0.0015017504,   0.0015860445, ... 
            0.0016158985,   0.0015878762,   0.0015006302,   0.0013550946, ... 
            0.0011545525,   0.0009045701,   0.0006128065,   0.0002887282, ... 
           -0.0000567416,  -0.0004116059,  -0.0007631884,  -0.0010985338, ... 
           -0.0014048150,  -0.0016697571,  -0.0018820836,  -0.0020319787, ... 
           -0.0021115483,  -0.0021152489,  -0.0020402442,  -0.0018866548, ... 
           -0.0016576702,  -0.0013595130,  -0.0010012575,  -0.0005945237, ... 
           -0.0001530731,   0.0003076642,   0.0007711092,   0.0012200838, ... 
            0.0016373873,   0.0020063943,   0.0023116717,   0.0025396020, ... 
            0.0026789897,   0.0027216171,   0.0026627098,   0.0025012726, ... 
            0.0022402649,   0.0018865992,   0.0014509630,   0.0009474790, ... 
            0.0003932306,  -0.0001923194,  -0.0007879882,  -0.0013715909, ... 
           -0.0019207028,  -0.0024134556,  -0.0028293553,  -0.0031501027, ... 
           -0.0033603874,  -0.0034486159,  -0.0034075273,  -0.0032346519, ... 
           -0.0029325747,  -0.0025089830,  -0.0019764930,  -0.0013522689, ... 
           -0.0006574611,   0.0000835022,   0.0008437413,   0.0015948378, ... 
            0.0023078164,   0.0029541774,   0.0035069614,   0.0039418213, ... 
            0.0042380641,   0.0043796151,   0.0043558470,   0.0041622176, ... 
            0.0038006690,   0.0032797551,   0.0026144885,   0.0018259188, ... 
            0.0009404715,  -0.0000109149,  -0.0009938122,  -0.0019714534, ... 
           -0.0029059824,  -0.0037597840,  -0.0044968687,  -0.0050842851, ... 
           -0.0054935129,  -0.0057017770,  -0.0056932099,  -0.0054597847, ... 
           -0.0050019519,  -0.0043289300,  -0.0034586315,  -0.0024172315, ... 
           -0.0012384148,   0.0000376507,   0.0013655638,   0.0026961177, ... 
            0.0039778770,   0.0051588840,   0.0061884758,   0.0070191874, ... 
            0.0076086896,   0.0079216899,   0.0079316933,   0.0076225128, ... 
            0.0069894199,   0.0060398515,   0.0047936307,   0.0032827054, ... 
            0.0015504490,  -0.0003494031,  -0.0023541048,  -0.0043934797, ... 
           -0.0063917015,  -0.0082692753,  -0.0099452435,  -0.0113396265, ... 
           -0.0123760808,  -0.0129846960,  -0.0131047914,  -0.0126875202, ... 
           -0.0116980736,  -0.0101172987,  -0.0079426153,  -0.0051882191, ... 
           -0.0018846609,   0.0019220216,   0.0061714124,   0.0107898913, ... 
            0.0156917946,   0.0207806128,   0.0259504135,   0.0310877601, ... 
            0.0360744025,   0.0407909146,   0.0451212545,   0.0489579670, ... 
            0.0522074931,   0.0547948712,   0.0566670737,   0.0577943558, ... 
            0.0591694232 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM200.ok"; fail; fi

cat > test_hM201.ok << 'EOF'
hM201 = [   0.0000700323,   0.0000777937,   0.0000316990,  -0.0000469265, ... 
           -0.0001336279,  -0.0002093302,  -0.0002646887,  -0.0003000382, ... 
           -0.0003221146,  -0.0003394537,  -0.0003583497,  -0.0003806229, ... 
           -0.0004035509,  -0.0004214898,  -0.0004282305,  -0.0004190872, ... 
           -0.0003920291,  -0.0003476678,  -0.0002883773,  -0.0002170907, ... 
           -0.0001363271,  -0.0000477976,   0.0000473677,   0.0001479929, ... 
            0.0002521833,   0.0003569260,   0.0004581262,   0.0005510389, ... 
            0.0006309046,   0.0006935434,   0.0007357164,   0.0007551928, ... 
            0.0007505890,   0.0007211326,   0.0006665097,   0.0005868860, ... 
            0.0004830975,   0.0003569178,   0.0002112742,   0.0000503039, ... 
           -0.0001207877,  -0.0002960319,  -0.0004690748,  -0.0006335269, ... 
           -0.0007832183,  -0.0009123473,  -0.0010155644,  -0.0010880598, ... 
           -0.0011257094,  -0.0011252996,  -0.0010848001,  -0.0010036243, ... 
           -0.0008828069,  -0.0007250555,  -0.0005346660,  -0.0003173365, ... 
           -0.0000799270,   0.0001697850,   0.0004233315,   0.0006717689, ... 
            0.0009059093,   0.0011165996,   0.0012950617,   0.0014332857, ... 
            0.0015244344,   0.0015632140,   0.0015461645,   0.0014718471, ... 
            0.0013409278,   0.0011561793,   0.0009224218,   0.0006464228, ... 
            0.0003367524,   0.0000035824,  -0.0003415935,  -0.0006863280, ... 
           -0.0010176736,  -0.0013226955,  -0.0015890062,  -0.0018052815, ... 
           -0.0019617258,  -0.0020504714,  -0.0020659081,  -0.0020049487, ... 
           -0.0018672296,  -0.0016552411,  -0.0013743679,  -0.0010328190, ... 
           -0.0006414302,  -0.0002133354,   0.0002364797,   0.0006917161, ... 
            0.0011353571,   0.0015502936,   0.0019199534,   0.0022289237, ... 
            0.0024635546,   0.0026125334,   0.0026674076,   0.0026230293, ... 
            0.0024778867,   0.0022342952,   0.0018984296,   0.0014801926, ... 
            0.0009929331,   0.0004530322,  -0.0001206237,  -0.0007072661, ... 
           -0.0012849521,  -0.0018313458,  -0.0023245564,  -0.0027440052, ... 
           -0.0030712826,  -0.0032909486,  -0.0033912319,  -0.0033645911, ... 
           -0.0032081164,  -0.0029237632,  -0.0025184165,  -0.0020037893, ... 
           -0.0013961520,  -0.0007158867,   0.0000131358,   0.0007643528, ... 
            0.0015094593,   0.0022194697,   0.0028658403,   0.0034215950, ... 
            0.0038624016,   0.0041675611,   0.0043208830,   0.0043114304, ... 
            0.0041341155,   0.0037901195,   0.0032871044,   0.0026391786, ... 
            0.0018665915,   0.0009951486,   0.0000553705,  -0.0009185629, ... 
           -0.0018900227,  -0.0028212399,  -0.0036746651,  -0.0044143511, ... 
           -0.0050073327,  -0.0054249798,  -0.0056442821,  -0.0056490012, ... 
           -0.0054306141,  -0.0049889704,  -0.0043326079,  -0.0034787038, ... 
           -0.0024526787,  -0.0012874962,  -0.0000227093,   0.0012967089, ... 
            0.0026217327,   0.0039008516,   0.0050818374,   0.0061136872, ... 
            0.0069486728,   0.0075443888,   0.0078656640,   0.0078862108, ... 
            0.0075899249,   0.0069718064,   0.0060385236,   0.0048086657, ... 
            0.0033127163,   0.0015927379,  -0.0002982954,  -0.0022976018, ... 
           -0.0043342007,  -0.0063310263,  -0.0082074504,  -0.0098820322, ... 
           -0.0112752746,  -0.0123121970,  -0.0129246240,  -0.0130532078, ... 
           -0.0126492894,  -0.0116767161,  -0.0101136572,  -0.0079543152, ... 
           -0.0052102765,  -0.0019111680,   0.0018956684,   0.0061465891, ... 
            0.0107639812,   0.0156590880,   0.0207347653,   0.0258876807, ... 
            0.0310097551,   0.0359890758,   0.0407109156,   0.0450597132, ... 
            0.0489227600,   0.0521958714,   0.0547905960,   0.0566417459, ... 
            0.0577134930,   0.0590014876 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM201.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave-cli -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM200.ok directFIRsymmetric_sdp_lowpass_test_hM200_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM200.ok"; fail; fi

diff -Bb test_hM201.ok directFIRsymmetric_sdp_lowpass_test_hM201_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM201.ok"; fail; fi

#
# this much worked
#
pass

