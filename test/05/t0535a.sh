#!/bin/sh

prog=directFIRsymmetric_sdp_lowpass_test.m

depends="test/directFIRsymmetric_sdp_lowpass_test.m test_common.m \
print_polynomial.m directFIRsymmetricA.m directFIRsymmetric_sdp_basis.m \
directFIRsymmetricEsqPW.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM031.ok << 'EOF'
hM031 = [   0.0008386135,   0.0007539346,   0.0007782016,   0.0004908066, ... 
           -0.0001724292,  -0.0011685242,  -0.0023185338,  -0.0033155984, ... 
           -0.0037788644,  -0.0033499168,  -0.0018134440,   0.0007885458, ... 
            0.0040858449,   0.0073854690,   0.0097720452,   0.0102987541, ... 
            0.0082381800,   0.0033394370,  -0.0039743095,  -0.0125306945, ... 
           -0.0204977199,  -0.0256460893,  -0.0257509448,  -0.0190613593, ... 
           -0.0047404974,   0.0168250698,   0.0439291958,   0.0737048557, ... 
            0.1025261414,   0.1265876192,   0.1425528681,   0.1481441087 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM031.ok"; fail; fi

cat > test_hM200.ok << 'EOF'
hM200 = [   0.0001178028,   0.0002470698,   0.0002945602,   0.0002815614, ... 
            0.0002486217,   0.0002212546,   0.0002086052,   0.0002071484, ... 
            0.0002069944,   0.0001981292,   0.0001745774,   0.0001356796, ... 
            0.0000849048,   0.0000274158,  -0.0000322352,  -0.0000913293, ... 
           -0.0001488810,  -0.0002046250,  -0.0002578242,  -0.0003065545, ... 
           -0.0003477607,  -0.0003779451,  -0.0003940729,  -0.0003942446, ... 
           -0.0003778838,  -0.0003454687,  -0.0002980548,  -0.0002368934, ... 
           -0.0001633397,  -0.0000790504,   0.0000136939,   0.0001117640, ... 
            0.0002112088,   0.0003075481,   0.0003962112,   0.0004729498, ... 
            0.0005340922,   0.0005766089,   0.0005980652,   0.0005965798, ... 
            0.0005708856,   0.0005205101,   0.0004460065,   0.0003491309, ... 
            0.0002328764,   0.0001013399,  -0.0000405321,  -0.0001872329, ... 
           -0.0003329440,  -0.0004717144,  -0.0005975955,  -0.0007047928, ... 
           -0.0007878815,  -0.0008420982,  -0.0008636689,  -0.0008501056, ... 
           -0.0008004091,  -0.0007151482,  -0.0005964310,  -0.0004478083, ... 
           -0.0002741556,  -0.0000815506,   0.0001228648,   0.0003310738, ... 
            0.0005344560,   0.0007241480,   0.0008914674,   0.0010283509, ... 
            0.0011277552,   0.0011839864,   0.0011929521,   0.0011523505, ... 
            0.0010618159,   0.0009230269,   0.0007397626,   0.0005178790, ... 
            0.0002651729,  -0.0000088760,  -0.0002934765,  -0.0005769762, ... 
           -0.0008473497,  -0.0010926928,  -0.0013017022,  -0.0014641414, ... 
           -0.0015712919,  -0.0016163863,  -0.0015950017,  -0.0015053789, ... 
           -0.0013486301,  -0.0011288073,  -0.0008528223,  -0.0005302298, ... 
           -0.0001728970,   0.0002054159,   0.0005895471,   0.0009634915, ... 
            0.0013110201,   0.0016163547,   0.0018648726,   0.0020438042, ... 
            0.0021428757,   0.0021548519,   0.0020759468,   0.0019060865, ... 
            0.0016490255,   0.0013123206,   0.0009071663,   0.0004480873, ... 
           -0.0000475200,  -0.0005599999,  -0.0010681932,  -0.0015503050, ... 
           -0.0019848367,  -0.0023515276,  -0.0026322553,  -0.0028118576, ... 
           -0.0028788537,  -0.0028260492,  -0.0026510074,  -0.0023563626, ... 
           -0.0019499401,  -0.0014446520,  -0.0008581481,  -0.0002122274, ... 
            0.0004679607,   0.0011548772,   0.0018196644,   0.0024332840, ... 
            0.0029676900,   0.0033970142,   0.0036987344,   0.0038547825, ... 
            0.0038525281,   0.0036855681,   0.0033542556,   0.0028659307, ... 
            0.0022348458,   0.0014818050,   0.0006335499,  -0.0002780818, ... 
           -0.0012172162,  -0.0021452144,  -0.0030221482,  -0.0038084365, ... 
           -0.0044665717,  -0.0049628293,  -0.0052688554,  -0.0053630437, ... 
           -0.0052316545,  -0.0048696592,  -0.0042813114,  -0.0034804319, ... 
           -0.0024903690,  -0.0013435766,  -0.0000807573,   0.0012504404, ... 
            0.0025971226,   0.0039031436,   0.0051112635,   0.0061653550, ... 
            0.0070125936,   0.0076056077,   0.0079045840,   0.0078792906, ... 
            0.0075109259,   0.0067936398,   0.0057355631,   0.0043592243, ... 
            0.0027013307,   0.0008119849,  -0.0012465323,  -0.0034013001, ... 
           -0.0055705818,  -0.0076659856,  -0.0095950553,  -0.0112643271, ... 
           -0.0125827647,  -0.0134653287,  -0.0138363508,  -0.0136324196, ... 
           -0.0128046357,  -0.0113203051,  -0.0091642847,  -0.0063401896, ... 
           -0.0028714985,   0.0011976728,   0.0058025750,   0.0108590601, ... 
            0.0162662532,   0.0219104190,   0.0276693285,   0.0334162058, ... 
            0.0390224929,   0.0443592223,   0.0492975288,   0.0537094615, ... 
            0.0574704524,   0.0604643986,   0.0625914092,   0.0637771509, ... 
            0.0650940039 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM200.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM031.ok directFIRsymmetric_sdp_lowpass_test_hM031_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM031.ok"; fail; fi

diff -Bb test_hM200.ok directFIRsymmetric_sdp_lowpass_test_hM200_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM200.ok"; fail; fi

#
# this much worked
#
pass

