#!/bin/sh

prog=directFIRsymmetric_sdp_lowpass_test.m

depends="test/directFIRsymmetric_sdp_lowpass_test.m test_common.m \
print_polynomial.m directFIRsymmetricA.m directFIRsymmetric_sdp_basis.m \
directFIRsymmetricEsqPW.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test_hM200.ok << 'EOF'
hM200 = [  -0.0000058628,  -0.0000283338,  -0.0000729519,  -0.0001367129, ... 
           -0.0002109539,  -0.0002849833,  -0.0003494191,  -0.0003984048, ... 
           -0.0004303339,  -0.0004471839,  -0.0004529243,  -0.0004516296, ... 
           -0.0004459046,  -0.0004360362,  -0.0004200164,  -0.0003943093, ... 
           -0.0003550463,  -0.0002992556,  -0.0002257798,  -0.0001356713, ... 
           -0.0000320297,   0.0000805950,   0.0001970071,   0.0003121315, ... 
            0.0004215450,   0.0005216776,   0.0006097042,   0.0006832392, ... 
            0.0007399918,   0.0007775339,   0.0007932771,   0.0007846788, ... 
            0.0007496218,   0.0006868572,   0.0005963897,   0.0004797043, ... 
            0.0003397834,   0.0001809266,   0.0000084285,  -0.0001717953, ... 
           -0.0003535526,  -0.0005306304,  -0.0006969459,  -0.0008466175, ... 
           -0.0009740059,  -0.0010737846,  -0.0011410839,  -0.0011717204, ... 
           -0.0011624945,  -0.0011115048,  -0.0010184210,  -0.0008846568, ... 
           -0.0007134111,  -0.0005095675,  -0.0002794794,  -0.0000306779, ... 
            0.0002284471,   0.0004889567,   0.0007416420,   0.0009772768, ... 
            0.0011868589,   0.0013618673,   0.0014945528,   0.0015782660, ... 
            0.0016078079,   0.0015797687,   0.0014928137,   0.0013478748, ... 
            0.0011482190,   0.0008993847,   0.0006089946,   0.0002864718, ... 
           -0.0000573086,  -0.0004104017,  -0.0007601877,  -0.0010937717, ... 
           -0.0013983908,  -0.0016618370,  -0.0018729000,  -0.0020218260, ... 
           -0.0021007747,  -0.0021042432,  -0.0020294199,  -0.0018764319, ... 
           -0.0016484570,  -0.0013516890,  -0.0009951586,  -0.0005904302, ... 
           -0.0001512001,   0.0003071749,   0.0007681949,   0.0012147665, ... 
            0.0016297771,   0.0019966911,   0.0023001640,   0.0025266614, ... 
            0.0026650606,   0.0027072017,   0.0026483489,   0.0024875234, ... 
            0.0022276771,   0.0018756925,   0.0014422053,   0.0009412683, ... 
            0.0003898794,  -0.0001925959,  -0.0007850818,  -0.0013655070, ... 
           -0.0019115648,  -0.0024015060,  -0.0028149531,  -0.0031337164, ... 
           -0.0033425823,  -0.0034300360,  -0.0033888718,  -0.0032166474, ... 
           -0.0029159457,  -0.0024944213,  -0.0019646287,  -0.0013436442, ... 
           -0.0006525086,   0.0000844782,   0.0008405774,   0.0015875215, ... 
            0.0022964913,   0.0029391439,   0.0034886733,   0.0039208759, ... 
            0.0042151868,   0.0043556366,   0.0043316742,   0.0041387998, ... 
            0.0037789590,   0.0032606699,   0.0025988702,   0.0018144989, ... 
            0.0009338394,  -0.0000123376,  -0.0009897913,  -0.0019619553, ... 
           -0.0028911820,  -0.0037400656,  -0.0044728215,  -0.0050566905, ... 
           -0.0054633249,  -0.0056700939,  -0.0056612379,  -0.0054287941, ... 
           -0.0049732274,  -0.0043037182,  -0.0034380879,  -0.0024023704, ... 
           -0.0012300641,   0.0000388875,   0.0013593374,   0.0026823543, ... 
            0.0039567914,   0.0051309833,   0.0061545556,   0.0069803173, ... 
            0.0075661899,   0.0078770963,   0.0078867110,   0.0075789597, ... 
            0.0069491603,   0.0060047239,   0.0047653724,   0.0032628777, ... 
            0.0015403677,  -0.0003487298,  -0.0023420288,  -0.0043697545, ... 
           -0.0063565125,  -0.0082232600,  -0.0098894996,  -0.0112757091, ... 
           -0.0123059862,  -0.0129108315,  -0.0130299285,  -0.0126147326, ... 
           -0.0116306585,  -0.0100586852,  -0.0078962642,  -0.0051575180, ... 
           -0.0018728210,   0.0019120620,   0.0061370756,   0.0107290363, ... 
            0.0156027815,   0.0206623574,   0.0258024318,   0.0309102031, ... 
            0.0358680805,   0.0405573058,   0.0448624951,   0.0486768167, ... 
            0.0519072742,   0.0544793799,   0.0563404682,   0.0574610281, ... 
            0.0588338625 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM200.ok"; fail; fi

cat > test_hM201.ok << 'EOF'
hM201 = [   0.0000708627,   0.0000789239,   0.0000328481,  -0.0000458018, ... 
           -0.0001324182,  -0.0002078859,  -0.0002629126,  -0.0002979291, ... 
           -0.0003197584,  -0.0003369782,  -0.0003558709,  -0.0003782082, ... 
           -0.0004012120,  -0.0004192047,  -0.0004259811,  -0.0004168926, ... 
           -0.0003899616,  -0.0003458444,  -0.0002869327,  -0.0002161437, ... 
           -0.0001359544,  -0.0000480248,   0.0000465575,   0.0001466380, ... 
            0.0002503220,   0.0003545838,   0.0004553174,   0.0005477808, ... 
            0.0006272372,   0.0006895446,   0.0007315065,   0.0007509257, ... 
            0.0007464336,   0.0007172524,   0.0006630468,   0.0005839558, ... 
            0.0004807933,   0.0003553203,   0.0002104595,   0.0000503455, ... 
           -0.0001198264,  -0.0002941118,  -0.0004661959,  -0.0006297388, ... 
           -0.0007786213,  -0.0009070846,  -0.0010098083,  -0.0010819969, ... 
           -0.0011195304,  -0.0011191956,  -0.0010789641,  -0.0009982549, ... 
           -0.0008781086,  -0.0007212320,  -0.0005319082,  -0.0003158052, ... 
           -0.0000797374,   0.0001685740,   0.0004207201,   0.0006678122, ... 
            0.0009007091,   0.0011102958,   0.0012878281,   0.0014253285, ... 
            0.0015159943,   0.0015545666,   0.0015376157,   0.0014637215, ... 
            0.0013335525,   0.0011498633,   0.0009174384,   0.0006429956, ... 
            0.0003350489,   0.0000037120,  -0.0003395785,  -0.0006824328, ... 
           -0.0010119630,  -0.0013152994,  -0.0015801239,  -0.0017951832, ... 
           -0.0019507468,  -0.0020389995,  -0.0020543652,  -0.0019937688, ... 
           -0.0018568394,  -0.0016460436,  -0.0013667308,  -0.0010270664, ... 
           -0.0006378342,  -0.0002121067,   0.0002352045,   0.0006878877, ... 
            0.0011290252,   0.0015416125,   0.0019091803,   0.0022164083, ... 
            0.0024497231,   0.0025978690,   0.0026524319,   0.0026082852, ... 
            0.0024639242,   0.0022216570,   0.0018876343,   0.0014717152, ... 
            0.0009871816,   0.0004503239,  -0.0001200836,  -0.0007033983, ... 
           -0.0012778093,  -0.0018211102,  -0.0023115305,  -0.0027285997, ... 
           -0.0030540034,  -0.0032723836,  -0.0033720375,  -0.0033454753, ... 
           -0.0031898166,  -0.0029070174,  -0.0025039305,  -0.0019922021, ... 
           -0.0013880038,  -0.0007115938,   0.0000132982,   0.0007602601, ... 
            0.0015011406,   0.0022071086,   0.0028497737,   0.0034023102, ... 
            0.0038405292,   0.0041438610,   0.0042962215,   0.0042867474, ... 
            0.0041103844,   0.0037683045,   0.0032681185,   0.0026238473, ... 
            0.0018556223,   0.0009891071,   0.0000546592,  -0.0009137239, ... 
           -0.0018796133,  -0.0028054545,  -0.0036539207,  -0.0043892841, ... 
           -0.0049787822,  -0.0053939585,  -0.0056119356,  -0.0056165623, ... 
           -0.0053993555,  -0.0049601602,  -0.0043074669,  -0.0034583652, ... 
           -0.0024381463,  -0.0012796010,  -0.0000220644,   0.0012897496, ... 
            0.0026071077,   0.0038788107,   0.0050529443,   0.0060788040, ... 
            0.0069089314,   0.0075011538,   0.0078204907,   0.0078408013, ... 
            0.0075460812,   0.0069313773,   0.0060033422,   0.0047804773, ... 
            0.0032930989,   0.0015830214,  -0.0002971026,  -0.0022848713, ... 
           -0.0043097244,  -0.0062950382,  -0.0081606339,  -0.0098255189, ... 
           -0.0112106378,  -0.0122414400,  -0.0128501593,  -0.0129778202, ... 
           -0.0125760763,  -0.0116090046,  -0.0100549011,  -0.0079079813, ... 
           -0.0051797333,  -0.0018995866,   0.0018853963,   0.0061119175, ... 
            0.0107027697,   0.0155696627,   0.0206159882,   0.0257390232, ... 
            0.0308313662,   0.0357818269,   0.0404764042,   0.0448002161, ... 
            0.0486411381,   0.0518954419,   0.0544749980,   0.0563148283, ... 
            0.0573792441,   0.0586640069 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat test_hM201.ok"; fail; fi

#
# run and see if the results match
#
echo "Running $prog" 

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test_hM200.ok directFIRsymmetric_sdp_lowpass_test_hM200_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM200.ok"; fail; fi

diff -Bb test_hM201.ok directFIRsymmetric_sdp_lowpass_test_hM201_coef.m
if [ $? -ne 0 ]; then echo "Failed diff -Bb test_hM201.ok"; fail; fi

#
# this much worked
#
pass

