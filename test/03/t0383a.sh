#!/bin/sh

prog=x2zp_test.m

depends="test/x2zp_test.m test_common.m zp2x.m x2zp.m print_polynomial.m"

tmp=/tmp/$$
here=`pwd`
if [ $? -ne 0 ]; then echo "Failed pwd"; exit 1; fi

fail()
{
        echo FAILED ${0#$here"/"} $prog 1>&2
        cd $here
        rm -rf $tmp
        exit 1
}

pass()
{
        echo PASSED ${0#$here"/"} $prog
        cd $here
        rm -rf $tmp
        exit 0
}

trap "fail" 1 2 3 15
mkdir $tmp
if [ $? -ne 0 ]; then echo "Failed mkdir"; exit 1; fi
for file in $depends;do \
  cp -R src/$file $tmp; \
  if [ $? -ne 0 ]; then echo "Failed cp "$file; fail; fi \
done
cd $tmp
if [ $? -ne 0 ]; then echo "Failed cd"; fail; fi

#
# the output should look like this
#
cat > test.ok << 'EOF'
abs_p2 = [   0.9682103956,   0.9682103956,   0.9682103956,   0.9682103956 ]';
angle_p2 = [  -3.1089161351,  -0.0326765185,   0.0326765185,   3.1089161351 ]';
abs_p2 = [   0.9786930273,   0.9786930273,   0.9786930273,   0.9786930273, ... 
             0.9786930273,   0.9786930273 ]';
angle_p2 = [  -2.1161794480,   2.1161794480,  -2.0726107567,  -0.0217843457, ... 
               0.0217843457,   2.0726107567 ]';
abs_p2 = [   0.7138105137,   0.7138105137,   0.8594945501,   0.8594945501, ... 
             0.8594945501,   0.8594945501 ]';
angle_p2 = [  -1.5707963268,   1.5707963268,  -1.2899878712,   1.2899878712, ... 
              -1.8516047824,   1.8516047824 ]';
abs_p2 = [   0.7987090897,   0.7987090897,   0.7987090897,   0.9039867914, ... 
             0.9039867914,   0.9039867914,   0.9039867914,   0.9039867914, ... 
             0.9039867914 ]';
angle_p2 = [  -1.0471975512,   1.0471975512,   3.1415926536,  -2.9543870165, ... 
               2.9543870165,  -0.8599919142,   0.8599919142,  -1.2344031882, ... 
               1.2344031882 ]';
abs_p2 = [   0.7696783547,   0.7696783547,   0.8455064602,   0.8455064602, ... 
             0.8455064602,   0.8455064602,   0.9523963783,   0.9523963783, ... 
             0.9523963783,   0.9523963783 ]';
angle_p2 = [   0.0000000000,   3.1415926536,  -2.9806818296,  -0.1609108240, ... 
               0.1609108240,   2.9806818296,  -2.9451828124,   2.9451828124, ... 
              -0.1964098412,   0.1964098412 ]';
abs_p2 = [   0.8398586164,   0.8398586164,   0.8398586164,   0.8941518652, ... 
             0.8941518652,   0.8941518652,   0.8941518652,   0.8941518652, ... 
             0.8941518652,   0.9680069828,   0.9680069828,   0.9680069828, ... 
             0.9680069828,   0.9680069828,   0.9680069828 ]';
angle_p2 = [  -2.0943951024,   0.0000000000,   2.0943951024,  -2.2016689851, ... 
               2.2016689851,  -1.9871212197,  -0.1072738827,   0.1072738827, ... 
               1.9871212197,  -2.2253349965,   2.2253349965,  -1.9634552083, ... 
              -0.1309398941,   0.1309398941,   1.9634552083 ]';
EOF
if [ $? -ne 0 ]; then echo "Failed output cat"; fail; fi

#
# run and see if the results match
#
echo "Running $prog"

octave --no-gui -q $prog >test.out 2>&1
if [ $? -ne 0 ]; then echo "Failed running $prog"; fail; fi

diff -Bb test.ok test.out
if [ $? -ne 0 ]; then echo "Failed diff -Bb"; fail; fi


#
# this much worked
#
pass

